echo "üîç Running pre-push checks..."

cd apps/web || exit 1

# Type checking
echo "  ‚úì Type checking..."
if npm run typecheck; then
  TYPE_CHECK_EXIT=0
else
  TYPE_CHECK_EXIT=1
fi

# Linting (only fail on errors, not warnings)
echo "  ‚úì Linting (errors only)..."
LINT_OUTPUT=$(npm run lint --silent 2>&1 || true)
ERROR_COUNT=$(echo "$LINT_OUTPUT" | grep -oE "[0-9]+ errors" | grep -oE "[0-9]+" | head -1 || echo "0")
if [ "$ERROR_COUNT" -gt 0 ]; then
  echo "    ‚ùå ESLint found $ERROR_COUNT error(s)"
  echo "$LINT_OUTPUT" | grep "error"
  LINT_HAS_ERRORS=1
else
  echo "    ‚úì No ESLint errors (warnings allowed)"
  LINT_HAS_ERRORS=0
fi

# Return to root
cd ../..

# Fail if TypeScript errors or ESLint errors
if [ $TYPE_CHECK_EXIT -ne 0 ]; then
  echo "‚ùå TypeScript errors found. Please fix before pushing."
  exit 1
fi

if [ $LINT_HAS_ERRORS -eq 1 ]; then
  echo "‚ùå ESLint errors found. Please fix before pushing."
  exit 1
fi

echo "‚úÖ All pre-push checks passed!"

