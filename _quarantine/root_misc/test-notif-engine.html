<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notifications Engine</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            background: #f0f0f0;
        }
        
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .debug-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #ccc;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn:hover {
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <h1>Notifications Engine Test</h1>
    
    <div class="debug-info" id="debugInfo">
        Testing notifications engine...
    </div>
    
    <div class="test-card">
        <h2>Test Controls</h2>
        <button class="btn" onclick="testScan()">Run Manual Scan</button>
        <button class="btn" onclick="testToggle()">Toggle Notifications</button>
        <button class="btn" onclick="clearSeen()">Clear Seen Episodes</button>
        <button class="btn" onclick="addTestData()">Add Test Show Data</button>
    </div>
    
    <div class="test-card">
        <h2>Current Status</h2>
        <div id="statusInfo">
            Loading...
        </div>
    </div>
    
    <div class="test-card">
        <h2>Test Show Data</h2>
        <p>Add test data to simulate shows with upcoming episodes:</p>
        <div id="testDataInfo">
            No test data added yet.
        </div>
    </div>

    <script>
        // Mock the notification engine for testing
        const STORAGE_ON_KEY = 'flicklet:notif:on';
        const STORAGE_SEEN_KEY = 'flicklet:notif:seen';

        // Mock app data
        window.FlickletApp = {
            data: {
                tv: {
                    watching: []
                }
            }
        };

        // Mock notification function
        window.showNotification = function(msg, type) {
            console.log('ðŸ”” Notification:', msg, type);
            alert(`ðŸ”” ${msg}`);
        };

        // Test functions
        function testScan() {
            console.log('Running manual scan...');
            // This would trigger the actual scan in the real app
            updateStatus();
        }

        function testToggle() {
            const isOn = localStorage.getItem(STORAGE_ON_KEY) !== '0';
            const newValue = !isOn;
            localStorage.setItem(STORAGE_ON_KEY, newValue ? '1' : '0');
            updateStatus();
            console.log('Notifications toggled:', newValue);
        }

        function clearSeen() {
            localStorage.removeItem(STORAGE_SEEN_KEY);
            updateStatus();
            console.log('Cleared seen episodes');
        }

        function addTestData() {
            // Add a test show with an episode airing soon
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const testShow = {
                id: 12345,
                name: "Test Show",
                first_air_date: "2020-01-01",
                next_episode_to_air: {
                    id: 98765,
                    season_number: 2,
                    episode_number: 5,
                    air_date: tomorrowStr
                }
            };
            
            window.FlickletApp.data.tv.watching.push(testShow);
            updateStatus();
            console.log('Added test show:', testShow);
        }

        function updateStatus() {
            const isOn = localStorage.getItem(STORAGE_ON_KEY) !== '0';
            const seen = JSON.parse(localStorage.getItem(STORAGE_SEEN_KEY) || '{}');
            const watchingCount = window.FlickletApp.data.tv.watching.length;
            
            document.getElementById('statusInfo').innerHTML = 
                `Notifications: ${isOn ? 'ON' : 'OFF'}<br>` +
                `Seen episodes: ${Object.keys(seen).length}<br>` +
                `Watching shows: ${watchingCount}<br>` +
                `Storage keys: ${Object.keys(seen).join(', ') || 'none'}`;
                
            document.getElementById('testDataInfo').innerHTML = 
                watchingCount > 0 ? 
                `âœ… ${watchingCount} test show(s) added<br>` +
                `Next episode: ${window.FlickletApp.data.tv.watching[0]?.next_episode_to_air?.air_date || 'none'}` :
                'No test data added yet.';
        }

        // Initialize
        updateStatus();
        console.log('ðŸ”” Notifications Engine test initialized');
    </script>
</body>
</html>






