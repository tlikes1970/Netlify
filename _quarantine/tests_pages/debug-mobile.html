<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Debug - Flicklet</title>
    <link rel="stylesheet" href="styles/components.css?v=mp2.2">
    <link rel="stylesheet" href="styles/mobile.css?v=mp2.2">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .debug-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .force-mobile {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .show-card {
            display: grid;
            grid-template-columns: 64px auto 44px;
            gap: 8px;
            padding: 8px 12px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 10px 0;
            align-items: start;
        }
        .show-poster {
            width: 64px;
            height: 96px;
            background: #e9ecef;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 12px;
        }
        .show-details {
            min-width: 0;
        }
        .show-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 4px 0;
            line-height: 1.2;
        }
        .show-overview {
            font-size: 14px;
            color: #6c757d;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
            margin: 0;
        }
        .show-actions {
            width: 44px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .test-btn {
            width: 100%;
            height: 36px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h2>Mobile Debug Info</h2>
        <div id="viewport-info"></div>
        <div id="class-info"></div>
        <div id="css-info"></div>
        <button class="force-mobile" onclick="forceMobile()">Force Mobile-v1 Class</button>
        <button class="force-mobile" onclick="removeMobile()">Remove Mobile-v1 Class</button>
        <button class="force-mobile" onclick="triggerMobileGuard()">Trigger Mobile Guard</button>
        <button class="force-mobile" onclick="location.reload()">Reload Page</button>
    </div>

    <div class="test-card">
        <h3>Test Card (Should be 3-column grid on mobile)</h3>
        <div class="show-card">
            <div class="show-poster">64x96</div>
            <div class="show-details">
                <div class="show-title">Test Show Title</div>
                <div class="show-overview">This is a test overview that should be clamped to 2 lines on mobile. It should show the compact mobile layout with proper grid columns.</div>
            </div>
            <div class="show-actions">
                <button class="test-btn">‚òÖ</button>
                <button class="test-btn">üëç</button>
                <button class="test-btn">üëé</button>
            </div>
        </div>
    </div>

    <div class="test-card">
        <h3>Real Show Card (if any exist)</h3>
        <div id="real-cards"></div>
    </div>

    <script>
        function updateDebugInfo() {
            const viewportInfo = document.getElementById('viewport-info');
            const classInfo = document.getElementById('class-info');
            const cssInfo = document.getElementById('css-info');
            
            // Viewport info
            const isMobileDevice = /iPhone|iPad|iPod|Android|Mobile|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isMobileSize = window.innerWidth <= 768;
            const isMobileViewport = window.innerWidth <= 640;
            
            viewportInfo.innerHTML = `
                <strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}<br>
                <strong>Device Pixel Ratio:</strong> ${window.devicePixelRatio}<br>
                <strong>User Agent:</strong> ${navigator.userAgent.includes('iPhone') ? 'iPhone' : 'Not iPhone'}<br>
                <strong>Match Media (‚â§640px):</strong> ${window.matchMedia('(max-width: 640px)').matches}<br>
                <strong>Mobile Device Detection:</strong> ${isMobileDevice}<br>
                <strong>Mobile Size (‚â§768px):</strong> ${isMobileSize}<br>
                <strong>Mobile Viewport (‚â§640px):</strong> ${isMobileViewport}
            `;
            
            // Class info
            classInfo.innerHTML = `
                <strong>Body Classes:</strong> ${document.body.className}<br>
                <strong>Has mobile-v1:</strong> ${document.body.classList.contains('mobile-v1')}<br>
                <strong>FLAGS.mobilePolishGuard:</strong> ${window.FLAGS?.mobilePolishGuard || 'undefined'}<br>
                <strong>localStorage.forceMobileV1:</strong> ${localStorage.getItem('forceMobileV1') || 'null'}
            `;
            
            // CSS info
            const testCard = document.querySelector('.test-show-card');
            if (testCard) {
                const computedStyle = getComputedStyle(testCard);
                cssInfo.innerHTML = `
                    <strong>Display:</strong> ${computedStyle.display}<br>
                    <strong>Grid Template Columns:</strong> ${computedStyle.gridTemplateColumns}<br>
                    <strong>Gap:</strong> ${computedStyle.gap}<br>
                    <strong>Padding:</strong> ${computedStyle.padding}
                `;
            }
        }
        
        function forceMobile() {
            document.body.classList.add('mobile-v1');
            localStorage.setItem('forceMobileV1', '1');
            updateDebugInfo();
        }
        
        function triggerMobileGuard() {
            console.log('Triggering mobile guard...');
            console.log('window.mobilePolishGate:', window.mobilePolishGate);
            console.log('window.FLAGS:', window.FLAGS);
            
            if (window.mobilePolishGate) {
                window.mobilePolishGate();
                updateDebugInfo();
            } else {
                console.log('Mobile polish guard function not found');
                // Try to manually apply mobile class
                const viewportWidth = window.innerWidth;
                const isMobileDevice = /iPhone|iPad|iPod|Android|Mobile|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                const isMobileSize = viewportWidth <= 768;
                const isMobileViewport = viewportWidth <= 640;
                
                console.log('Manual check - viewport:', viewportWidth, 'mobile device:', isMobileDevice, 'mobile size:', isMobileSize);
                
                if (isMobileDevice && isMobileSize) {
                    document.body.classList.add('mobile-v1');
                    console.log('Manually applied mobile-v1 class');
                }
                updateDebugInfo();
            }
        }
        
        function removeMobile() {
            document.body.classList.remove('mobile-v1');
            localStorage.removeItem('forceMobileV1');
            updateDebugInfo();
        }
        
        // Check for real show cards
        function checkRealCards() {
            const realCards = document.querySelectorAll('.show-card');
            const realCardsDiv = document.getElementById('real-cards');
            
            if (realCards.length > 0) {
                realCardsDiv.innerHTML = `
                    <p>Found ${realCards.length} real show cards</p>
                    <p>First card classes: ${realCards[0].className}</p>
                    <p>First card display: ${getComputedStyle(realCards[0]).display}</p>
                    <p>First card grid: ${getComputedStyle(realCards[0]).gridTemplateColumns}</p>
                `;
            } else {
                realCardsDiv.innerHTML = '<p>No real show cards found on this page</p>';
            }
        }
        
        // Update debug info on load and resize
        updateDebugInfo();
        checkRealCards();
        
        // Auto-trigger mobile guard on debug page load
        setTimeout(() => {
            console.log('Auto-triggering mobile guard...');
            triggerMobileGuard();
        }, 500);
        
        window.addEventListener('resize', updateDebugInfo);
        window.addEventListener('orientationchange', () => {
            setTimeout(updateDebugInfo, 100);
        });
        
        // Check if mobile polish guard is working
        console.log('üîç Mobile Debug Page Loaded');
        console.log('Viewport:', window.innerWidth, 'x', window.innerHeight);
        console.log('Match Media (‚â§640px):', window.matchMedia('(max-width: 640px)').matches);
        console.log('Body classes:', document.body.className);
        console.log('FLAGS:', window.FLAGS);
        console.log('mobilePolishGate function:', window.mobilePolishGate);
        
        // Check if we can access the main app's functions
        setTimeout(() => {
            console.log('After 1 second - mobilePolishGate:', window.mobilePolishGate);
            console.log('After 1 second - FLAGS:', window.FLAGS);
        }, 1000);
    </script>
</body>
</html>
