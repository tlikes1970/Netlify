<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <title>TV Tracker - Your Personal TV & Movie Organizer</title>
  <meta name="title" content="TV Tracker - Your Personal TV & Movie Organizer">
  <meta name="description" content="Track your TV shows and movies with brutally honest commentary. Never lose track of your binge-watching again!">
  <meta name="keywords" content="tv tracker, movie tracker, streaming, watchlist, tv shows, movies, entertainment">
  <meta name="author" content="TV Tracker">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tv-movie-tracker.netlify.app/">
  <meta property="og:title" content="TV Tracker - Your Personal TV & Movie Organizer">
  <meta property="og:description" content="Track your TV shows and movies with brutally honest commentary. Never lose track of your binge-watching again!">
  <meta property="og:image" content="https://tv-movie-tracker.netlify.app/icons/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://tv-movie-tracker.netlify.app/">
  <meta property="twitter:title" content="TV Tracker - Your Personal TV & Movie Organizer">
  <meta property="twitter:description" content="Track your TV shows and movies with brutally honest commentary. Never lose track of your binge-watching again!">
  <meta property="twitter:image" content="https://tv-movie-tracker.netlify.app/icons/og-image.png">
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="TV Tracker">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="TV Tracker">
  <meta name="msapplication-TileColor" content="#667eea">
  <meta name="theme-color" content="#ff6b6b">
  
  <!-- Favicons and Icons -->
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://api.themoviedb.org">
  <link rel="preconnect" href="https://image.tmdb.org">
  
  <style>
    :root {
      --bg: #fff; --text: #000; --primary: #ff6b6b; --card: #f9f9f9; --border: #ddd;
      --success: #51cf66; --warning: #ffd43b; --danger: #ff6b6b; --purple: #845ec2;
    }
    
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text); margin: 0; padding: 20px; min-height: 100vh;
    }
    
    .dark-mode { 
      --bg: #1a1a1a; --text: #f5f5f5; --card: #2d2d2d; --border: #444;
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
    }
    
    .main-container {
      max-width: 1200px; margin: 0 auto; background: var(--bg); 
      border-radius: 20px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .header { 
      display: flex; justify-content: space-between; align-items: center; 
      padding: 20px 0; border-bottom: 3px dashed var(--primary); margin-bottom: 30px;
      position: relative;
    }
    
    .header::after {
      content: "üõãÔ∏è"; position: absolute; right: 130px; top: 15px; 
      font-size: 32px; animation: couch-bounce 3s ease-in-out infinite;
    }
    
    @keyframes couch-bounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(-5deg); }
    }
    
    .title { 
      font-size: 2.5em; font-weight: bold; color: var(--primary); 
      margin: 0; cursor: pointer;
    }
    
    .user-section {
      display: flex; align-items: center; gap: 15px; flex-wrap: wrap;
    }
    
    .name-container {
      display: flex; flex-direction: column; align-items: flex-end;
      transition: all 0.3s ease;
    }
    
    .name-instruction {
      font-size: 12px; color: var(--primary); font-weight: bold;
      margin-bottom: 5px;
    }
    
    .name-input {
      padding: 12px; border: 2px solid var(--primary); border-radius: 25px;
      background: var(--card); color: var(--text); font-weight: bold;
    }
    
    .name-container.hidden {
      opacity: 0; transform: scale(0.8); pointer-events: none;
    }
    
    .tab-container { 
      display: flex; background: var(--card); border-radius: 15px; 
      padding: 8px; margin: 30px 0;
    }
    
    .tab { 
      flex: 1; padding: 18px 30px; border: none; background: transparent; 
      color: var(--text); cursor: pointer; border-radius: 10px; font-weight: bold;
      transition: all 0.3s ease; font-size: 16px; text-align: center;
    }
    
    .tab.active { 
      background: linear-gradient(45deg, var(--primary), var(--purple)); 
      color: white; transform: scale(1.05);
    }
    
    .tab-badge {
      background: rgba(255,255,255,0.9); color: var(--primary);
      padding: 4px 10px; border-radius: 12px; font-size: 12px;
      margin-left: 8px; font-weight: bold;
    }
    
    .tab.active .tab-badge {
      background: rgba(255,255,255,1); color: var(--primary);
    }
    
    button { 
      margin: 8px; padding: 12px 20px; border: none; border-radius: 25px; 
      background: linear-gradient(45deg, var(--primary), var(--purple)); 
      color: white; cursor: pointer; font-weight: bold; font-size: 14px;
      transition: all 0.3s ease;
    }
    
    button:hover { 
      transform: translateY(-3px) scale(1.05); 
    }
    
    button:disabled { 
      background: #666; cursor: not-allowed; transform: none; opacity: 0.6;
    }
    
    button.danger { background: linear-gradient(45deg, #ff4757, #ff3742); }
    button.success { background: linear-gradient(45deg, #2ed573, #1dd1a1); }
    button.secondary { background: linear-gradient(45deg, #747d8c, #57606f); }
    
    .search-container { 
      background: var(--card); padding: 25px; border-radius: 20px; 
      margin: 30px 0; border: 2px solid var(--primary);
    }
    
    .search-row {
      display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;
    }
    
    .search-input {
      flex: 1; min-width: 250px; padding: 12px 15px;
      border: 2px solid var(--border); border-radius: 15px;
      background: var(--bg); color: var(--text); font-size: 16px;
    }
    
    .search-help {
      font-size: 12px; color: #666; margin-top: 5px; font-style: italic;
    }
    
    input, select { 
      padding: 12px 15px; margin: 5px; border: 2px solid var(--border); 
      border-radius: 15px; background: var(--bg); color: var(--text);
    }
    
    .section { margin: 40px 0; }
    
    .section-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; cursor: pointer; padding: 10px 0;
    }
    
    .section h3 { 
      color: var(--primary); margin: 0; font-size: 1.8em;
    }
    
    .section-subtitle {
      font-size: 14px; color: #666; font-style: italic;
      margin-top: 5px; font-weight: normal;
    }
    
    .count { 
      background: linear-gradient(45deg, var(--primary), var(--purple)); 
      color: white; padding: 8px 15px; border-radius: 20px; 
      font-size: 16px; font-weight: bold; cursor: pointer;
    }
    
    .list-container { 
      background: var(--card); border-radius: 15px; padding: 20px; 
      min-height: 80px; border: 3px dashed var(--border);
    }
    
    .show-card { 
      display: flex; border: 2px solid var(--border); 
      border-radius: 15px; padding: 20px; margin: 15px 0; 
      background: var(--bg);
    }
    
    .show-poster { 
      width: 90px; height: 135px; border-radius: 10px; 
      object-fit: cover; margin-right: 20px; flex-shrink: 0;
    }
    
    .poster-placeholder { 
      width: 90px; height: 135px; background: #f0f0f0; 
      border-radius: 10px; display: flex; align-items: center; justify-content: center; 
      margin-right: 20px; color: #999; font-size: 12px; font-weight: bold; flex-shrink: 0;
    }
    
    .show-details { flex: 1; display: flex; flex-direction: column; }
    
    .show-title { 
      font-size: 20px; font-weight: bold; margin: 0 0 10px 0; 
      cursor: pointer;
    }
    
    .show-meta { 
      color: #666; font-size: 14px; margin-bottom: 12px;
    }
    
    .show-overview { 
      font-size: 14px; line-height: 1.6; margin-bottom: 15px; 
      max-height: 60px; overflow: hidden; cursor: pointer;
    }
    
    .show-overview.expanded { max-height: none; }
    
    .rating-container {
      display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
    }
    
    .star-rating {
      display: flex; gap: 2px;
    }
    
    .star {
      font-size: 20px; cursor: pointer; transition: all 0.2s ease;
      color: #ddd;
    }
    
    .star:hover, .star.active { 
      color: #ffd700; transform: scale(1.2);
    }
    
    .notes-container {
      margin-bottom: 15px;
    }
    
    .notes-field {
      width: 100%; min-height: 60px; padding: 10px;
      border: 2px dashed var(--border); border-radius: 10px;
      background: var(--card); color: var(--text); resize: vertical;
      font-family: inherit; font-size: 14px;
    }
    
    .char-count {
      font-size: 11px; color: #999; text-align: right; margin-top: 5px;
    }
    
    .char-count.warning { color: var(--warning); }
    .char-count.danger { color: var(--danger); }
    
    .show-actions { 
      display: flex; gap: 12px; flex-wrap: wrap; align-items: center; 
      margin-top: 15px;
    }
    
    .show-actions button { padding: 8px 15px; font-size: 12px; margin: 2px; }
    
    .show-actions input { 
      max-width: 140px; padding: 8px 12px; font-size: 12px; margin: 2px;
    }
    
    .favorite.active { 
      background: linear-gradient(45deg, #ffd700, #ffed4e); 
      color: #000;
    }
    
    .empty-state { 
      text-align: center; color: #666; padding: 40px 20px; 
      font-style: italic; font-size: 18px;
    }
    
    .sassy-empty { 
      font-weight: bold; color: var(--primary);
    }
    
    .stats { 
      display: flex; gap: 20px; margin: 30px 0; flex-wrap: wrap;
    }
    
    .stat { 
      background: var(--card); padding: 25px; border-radius: 15px; 
      text-align: center; flex: 1; min-width: 140px; 
      border: 2px solid var(--primary); cursor: pointer;
    }
    
    .stat:hover { 
      transform: translateY(-5px); 
    }
    
    .stat-num { 
      font-size: 2.5em; font-weight: bold; color: var(--primary); 
    }
    
    .stat-label { 
      font-size: 12px; color: #666; font-weight: bold; 
      text-transform: uppercase;
    }
    
    .notification {
      position: fixed; top: 20px; right: 20px; z-index: 1000;
      padding: 15px 25px; border-radius: 10px; color: white;
      font-weight: bold; animation: slide-in 0.5s ease, slide-out 0.5s ease 2.5s forwards;
    }
    
    @keyframes slide-in {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slide-out {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    
    .notification.success { background: var(--success); }
    .notification.error { background: var(--danger); }
    .notification.warning { background: var(--warning); color: #000; }
    .notification.info { background: var(--purple); }
    
    .loading-container {
      text-align: center; padding: 40px;
    }
    
    .loading-spinner {
      width: 50px; height: 50px; border: 5px solid var(--border);
      border-top: 5px solid var(--primary); border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto 20px;
    }
    
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-weight: bold; color: var(--primary); font-size: 16px;
    }
    
    .easter-egg {
      position: fixed; bottom: 20px; right: 20px; 
      background: var(--purple); color: white; padding: 12px; 
      border-radius: 50%; cursor: pointer; z-index: 1000;
      font-size: 18px; width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
    }
    
    .feedback-button {
      position: fixed; bottom: 90px; right: 20px; 
      background: var(--primary); color: white; padding: 15px; 
      border-radius: 50%; cursor: pointer; z-index: 1001;
      font-size: 20px; width: 60px; height: 60px;
      display: flex; align-items: center; justify-content: center;
    }
    
    .admin-button {
      position: fixed; bottom: 160px; right: 20px; 
      background: #ffd700; color: #000; padding: 12px; 
      border-radius: 50%; cursor: pointer; z-index: 1001;
      font-size: 20px; width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
    }
    
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; 
      background: rgba(0,0,0,0.8); z-index: 2000; 
      display: flex; align-items: center; justify-content: center;
    }
    
    .modal-content {
      background: var(--bg); border-radius: 20px; 
      max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;
      border: 2px solid var(--primary);
    }
    
    .modal-header {
      padding: 25px 25px 0; display: flex; justify-content: space-between; 
      align-items: center; border-bottom: 2px dashed var(--primary); margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0; color: var(--primary); font-size: 1.5em;
    }
    
    .close-btn {
      background: none; border: none; font-size: 24px; 
      cursor: pointer; color: var(--text); padding: 5px; margin: 0;
    }
    
    .modal-body {
      padding: 0 25px 25px;
    }
    
    .tip-bubble {
      position: fixed; bottom: 80px; right: 20px; z-index: 1000;
      background: var(--purple); color: white; padding: 15px 20px;
      border-radius: 20px; max-width: 250px; font-size: 14px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
      animation: bubble-bounce 0.5s ease;
    }
    
    @keyframes bubble-bounce {
      0% { transform: scale(0) translateY(20px); opacity: 0; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }
    
    @media (max-width: 768px) {
      .main-container { padding: 15px; margin: 10px; }
      .header { flex-direction: column; gap: 15px; }
      .header::after { display: none; }
      .title { font-size: 2em; }
      .show-card { flex-direction: column; padding: 15px; }
      .show-poster, .poster-placeholder { 
        width: 70px; height: 105px; margin: 0 auto 15px auto; 
      }
      .stats { gap: 10px; }
      .stat { min-width: 100px; padding: 15px; }
      .search-row { flex-direction: column; }
      .search-input { min-width: auto; }
      .show-actions { justify-content: center; }
      .show-actions button, .show-actions input { margin: 8px; }
      button { margin: 10px 5px; }
      .tab { padding: 15px 20px; }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="header">
      <h1 class="title" id="welcomeText">TV Tracker</h1>
      <div class="user-section">
        <div class="name-container" id="nameContainer">
          <div class="name-instruction">üëÜ Add your name for a personal touch!</div>
          <input type="text" id="displayNameInput" class="name-input" placeholder="Your name here...">
        </div>
        <button id="darkModeToggle">üåô Go Dark</button>
      </div>
    </div>

    <div class="tab-container">
      <button id="homeTab" class="tab active">
        üè† Home
        <span class="tab-badge">Overview</span>
      </button>
      <button id="watchingTab" class="tab">
        ‚ñ∂Ô∏è Currently Watching
        <span class="tab-badge" id="watchingBadge">0</span>
      </button>
      <button id="wishlistTab" class="tab">
        üîñ Want to Watch
        <span class="tab-badge" id="wishlistBadge">0</span>
      </button>
    </div>

    <!-- HOME TAB -->
    <div id="homeSection" class="tab-section">
      <div class="search-container">
        <div class="search-row">
          <input type="text" id="searchInput" class="search-input" placeholder="Search for shows or movies...">
          <select id="genreFilter"><option value="">All Genres</option></select>
          <button id="searchBtn">üîç Search</button>
          <button id="clearSearchBtn" class="secondary" style="display: none;">‚úñÔ∏è Clear</button>
        </div>
        <div class="search-help">
          üí° <strong>Wildcards:</strong> "star*" = shows starting with "star" | 
          "*wars" = shows ending with "wars" | 
          "*trek*" = shows containing "trek"
        </div>
        <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
          <button id="prevPageBtn" disabled>‚Üê Previous</button>
          <span id="pageInfo" style="font-weight: bold; color: var(--primary);">Page 1</span>
          <button id="nextPageBtn" disabled>Next ‚Üí</button>
        </div>
      </div>

      <div id="searchResults" class="section" style="display: none;">
        <h3>üéØ Search Results <span class="count" id="resultsCount">0</span></h3>
        <div id="searchResultsList" class="list-container"></div>
      </div>

      <div class="stats">
        <div class="stat" onclick="switchToTab('watching')">
          <div class="stat-num" id="totalWatchingCount">0</div>
          <div class="stat-label">Currently Watching</div>
        </div>
        <div class="stat" onclick="switchToTab('wishlist')">
          <div class="stat-num" id="totalWishlistCount">0</div>
          <div class="stat-label">Want to Watch</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="totalCount">0</div>
          <div class="stat-label">Total Shows & Movies</div>
        </div>
      </div>

      <div style="background: var(--card); padding: 25px; border-radius: 20px; margin: 30px 0; border: 2px solid var(--primary);">
        <h3 style="color: var(--primary); margin-top: 0;">üíæ Backup Your Questionable Taste</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
          <input type="file" id="importFile" accept=".json" style="max-width: 200px;">
          <button id="exportBtn" class="success">üì§ Export My Shame</button>
          <button id="clearAllBtn" class="danger">üóëÔ∏è Nuclear Option</button>
        </div>
      </div>
    </div>

    <!-- CURRENTLY WATCHING TAB -->
    <div id="watchingSection" class="tab-section" style="display: none;">
      <div class="section">
        <div class="section-header">
          <div>
            <h3>‚ñ∂Ô∏è Currently Watching <span class="count" id="watchingCount">0</span></h3>
            <div class="section-subtitle">Shows and movies you're actually committed to... for now</div>
          </div>
        </div>
        <div id="watchingList" class="list-container">
          <div class="empty-state sassy-empty">No shows yet? What are you, productive or something? üôÑ</div>
        </div>
      </div>
    </div>

    <!-- WANT TO WATCH TAB -->
    <div id="wishlistSection" class="tab-section" style="display: none;">
      <div class="section">
        <div class="section-header">
          <div>
            <h3>üîñ Want to Watch <span class="count" id="wishlistCount">0</span></h3>
            <div class="section-subtitle">Your digital hoarding collection of "I'll definitely watch this someday"</div>
          </div>
        </div>
        <div id="wishlistList" class="list-container">
          <div class="empty-state sassy-empty">Your wishlist is emptier than a Netflix comedy special üíÄ</div>
        </div>
      </div>
    </div>
  </div>

  <div class="easter-egg" id="easterEgg">üé≠</div>
  <div class="feedback-button" id="feedbackBtn">üí¨</div>
  <div class="admin-button" id="adminBtn" style="display: none;">üëë</div>

  <!-- Feedback Modal -->
  <div class="modal" id="feedbackModal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>üéØ Your Brutally Honest Feedback</h3>
        <button class="close-btn" id="closeFeedback">‚úï</button>
      </div>
      <div class="modal-body">
        <p><strong>Help make this app less terrible!</strong> üòà</p>
        <textarea id="feedbackText" placeholder="What confused you? What's missing? Be brutally honest..." style="width: 100%; height: 120px; padding: 15px; border: 2px solid var(--border); border-radius: 10px; background: var(--card); color: var(--text); resize: vertical; font-family: inherit; font-size: 14px;"></textarea>
        <div style="margin: 20px 0;">
          <p><strong>Overall experience:</strong></p>
          <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px;" id="ratingButtons">
            <button class="rating-btn" data-rating="1">üò§ Terrible</button>
            <button class="rating-btn" data-rating="2">üòï Meh</button>
            <button class="rating-btn" data-rating="3">üôÇ Decent</button>
            <button class="rating-btn" data-rating="4">üòç Love it</button>
            <button class="rating-btn" data-rating="5">ü§Ø Mind blown</button>
          </div>
        </div>
        <button id="submitFeedback" style="width: 100%; margin: 15px 0; padding: 15px; font-size: 16px; font-weight: bold;">üì§ Submit Feedback</button>
      </div>
    </div>
  </div>

  <!-- Admin Modal -->
  <div class="modal" id="adminModal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3>üëë Secret Admin Panel</h3>
        <button class="close-btn" id="closeAdmin">‚úï</button>
      </div>
      <div class="modal-body">
        <div style="display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;">
          <div style="background: var(--card); padding: 20px; border-radius: 15px; text-align: center; flex: 1; min-width: 120px; border: 2px solid #ffd700;">
            <strong id="totalFeedback" style="display: block; font-size: 2em; color: #ffd700; margin-bottom: 5px;">0</strong>
            <span style="font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 1px;">Avg Rating</span>
          </div>
          <div style="background: var(--card); padding: 20px; border-radius: 15px; text-align: center; flex: 1; min-width: 120px; border: 2px solid #ffd700;">
            <strong id="latestFeedback" style="display: block; font-size: 2em; color: #ffd700; margin-bottom: 5px;">Never</strong>
            <span style="font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 1px;">Latest Submission</span>
          </div>
        </div>
        
        <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
          <button id="exportFeedback" class="success" style="flex: 1; padding: 15px; font-size: 16px; font-weight: bold;">üì§ Export All Feedback</button>
          <button id="clearFeedback" class="danger" style="flex: 1; padding: 15px; font-size: 16px; font-weight: bold;">üóëÔ∏è Clear All Feedback</button>
        </div>
        
        <div style="max-height: 400px; overflow-y: auto;">
          <h4 style="color: var(--primary); margin-bottom: 15px; font-size: 1.3em;">Recent Feedback:</h4>
          <div id="feedbackItems"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', async () => {
        try {
          const registration = await navigator.serviceWorker.register('/sw.js');
          console.log('Service Worker registered successfully:', registration.scope);
        } catch (error) {
          console.log('Service Worker registration failed:', error);
        }
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });
    
    function showInstallButton() {
      if (!document.getElementById('installBtn')) {
        const installBtn = document.createElement('button');
        installBtn.id = 'installBtn';
        installBtn.innerHTML = 'üì± Install App';
        installBtn.style.cssText = `
          position: fixed; bottom: 230px; right: 20px;
          background: linear-gradient(45deg, #2ed573, #1dd1a1);
          color: white; border: none; padding: 15px 20px;
          border-radius: 50px; font-weight: bold; cursor: pointer;
          z-index: 1001; box-shadow: 0 4px 20px rgba(45, 213, 115, 0.4);
          animation: install-pulse 3s ease-in-out infinite;
        `;
        
        installBtn.onclick = async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
              showNotification('Thanks for installing TV Tracker! üéâ', 'success');
            }
            
            deferredPrompt = null;
            installBtn.remove();
          }
        };
        
        document.body.appendChild(installBtn);
        
        setTimeout(() => {
          if (installBtn.parentNode) {
            installBtn.style.opacity = '0.7';
            setTimeout(() => {
              if (installBtn.parentNode) installBtn.remove();
            }, 2000);
          }
        }, 10000);
      }
    }

    // Main Application Logic
    const TMDB_IMG_BASE = 'https://image.tmdb.org/t/p/w200';
    const API_BASE = '/.netlify/functions/tmdb';
    
    let currentPage = 1, searchCache = [], currentActiveTab = 'home';
    
    const appData = {
      tv: { watching: [], wishlist: [] },
      movies: { watching: [], wishlist: [] },
      settings: { theme: 'light', displayName: '' }
    };

    const loadingMessages = [
      "Finding shows you'll probably abandon after 2 episodes...",
      "Searching the depths of entertainment mediocrity...",
      "Loading... (This is taking longer than your last relationship)",
      "Fetching content that'll judge your life choices...",
      "Retrieving shows you'll add but never watch..."
    ];

    const sassyTitles = [
      "Chaos", "Digital Hoarding", "Commitment Issues", "Questionable Taste", 
      "Binge Empire", "Streaming Madness", "Watch List Anarchy", "Media Obsession"
    ];

    const tips = [
      "Pro tip: Having 500 items in your wishlist doesn't count as productivity! üéØ",
      "Fun fact: 'I'll watch it later' is the most common lie in streaming! ü§•",
      "Reality check: You have more shows bookmarked than days in the year! üìÖ",
      "Hot take: Your 'Currently Watching' list is more fiction than fantasy movies! üìö",
      "Reminder: Netflix doesn't pay you to collect shows like Pok√©mon cards! üÉè"
    ];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadAppData();
      setupEventListeners();
      loadGenres();
      updateUI();
      setupEasterEgg();
      setupSecretAdmin();
    });

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    function getRandomLoadingMessage() {
      return loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
    }

    function createLoadingElement() {
      return `<div class="loading-container"><div class="loading-spinner"></div><div class="loading-text">${getRandomLoadingMessage()}</div></div>`;
    }

    function loadAppData() {
      const saved = localStorage.getItem('tvMovieTrackerData');
      if (saved) {
        try {
          Object.assign(appData, JSON.parse(saved));
        } catch (e) {
          console.error('Error loading data:', e);
          showNotification("Failed to load your data. Starting fresh! üî•", 'warning');
        }
      }
      
      if (appData.settings.theme === 'dark') {
        document.body.classList.add('dark-mode');
      }
      
      if (appData.settings.displayName) {
        document.getElementById('displayNameInput').value = appData.settings.displayName;
        updateWelcomeText();
        hideNameContainer();
      }
    }

    function updateWelcomeText() {
      const name = appData.settings.displayName;
      if (name) {
        const randomSass = sassyTitles[Math.floor(Math.random() * sassyTitles.length)];
        document.getElementById('welcomeText').textContent = `${name}'s ${randomSass}`;
      } else {
        document.getElementById('welcomeText').textContent = 'TV Tracker';
      }
    }

    function hideNameContainer() {
      const container = document.getElementById('nameContainer');
      if (appData.settings.displayName && container) {
        container.classList.add('hidden');
      }
    }

    function saveAppData() {
      localStorage.setItem('tvMovieTrackerData', JSON.stringify(appData));
    }

    function setupEventListeners() {
      document.getElementById('darkModeToggle').onclick = () => {
        document.body.classList.toggle('dark-mode');
        appData.settings.theme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
        const isDark = document.body.classList.contains('dark-mode');
        document.getElementById('darkModeToggle').textContent = isDark ? '‚òÄÔ∏è Go Light' : 'üåô Go Dark';
        saveAppData();
        showNotification(isDark ? "Welcome to the dark side üòà" : "Returning to the light! ‚òÄÔ∏è", 'success');
      };
      
      document.getElementById('displayNameInput').oninput = (e) => {
        appData.settings.displayName = e.target.value;
        updateWelcomeText();
        saveAppData();
        
        if (e.target.value.trim()) {
          setTimeout(() => hideNameContainer(), 1000);
        }
      };
      
      // Tab navigation
      document.getElementById('homeTab').onclick = () => switchToTab('home');
      document.getElementById('watchingTab').onclick = () => switchToTab('watching');
      document.getElementById('wishlistTab').onclick = () => switchToTab('wishlist');
      
      // Search functionality
      document.getElementById('searchBtn').onclick = performSearch;
      document.getElementById('searchInput').onkeydown = (e) => {
        if (e.key === 'Enter') performSearch();
      };
      
      // Clear search
      document.getElementById('clearSearchBtn').onclick = clearSearch;
      document.getElementById('searchInput').oninput = () => {
        const hasContent = document.getElementById('searchInput').value.trim() || 
                          document.getElementById('genreFilter').value;
        document.getElementById('clearSearchBtn').style.display = hasContent ? 'inline-block' : 'none';
      };
      document.getElementById('genreFilter').onchange = () => {
        const hasContent = document.getElementById('searchInput').value.trim() || 
                          document.getElementById('genreFilter').value;
        document.getElementById('clearSearchBtn').style.display = hasContent ? 'inline-block' : 'none';
      };
      
      // Pagination
      document.getElementById('prevPageBtn').onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          performSearch();
        }
      };
      
      document.getElementById('nextPageBtn').onclick = () => {
        currentPage++;
        performSearch();
      };
      
      // Data management
      document.getElementById('exportBtn').onclick = exportData;
      document.getElementById('importFile').onchange = importData;
      document.getElementById('clearAllBtn').onclick = () => {
        if (confirm('Are you SURE you want to delete everything? This nuclear option cannot be undone! üí•')) {
          appData.tv = { watching: [], wishlist: [] };
          appData.movies = { watching: [], wishlist: [] };
          saveAppData();
          updateUI();
          showNotification("Boom! Everything deleted. Hope you're happy! üíÄ", 'error');
        }
      };
    }

    function switchToTab(tab) {
      currentActiveTab = tab;
      
      // Update tab buttons
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tab + 'Tab').classList.add('active');
      
      // Show/hide sections
      document.querySelectorAll('.tab-section').forEach(s => s.style.display = 'none');
      document.getElementById(tab + 'Section').style.display = 'block';
      
      // Clear search when switching tabs
      if (tab !== 'home') {
        document.getElementById('searchResults').style.display = 'none';
      }
      
      const tabNames = { home: 'Home', watching: 'Currently Watching', wishlist: 'Want to Watch' };
      showNotification(`Switched to ${tabNames[tab]}! üì∫`, 'success');
    }

    async function performSearch() {
      const query = document.getElementById('searchInput').value.trim();
      const genre = document.getElementById('genreFilter').value;
      
      if (!query && !genre) {
        showNotification('Please enter a search term or select a genre, genius! ü§î', 'warning');
        return;
      }
      
      const container = document.getElementById('searchResultsList');
      container.innerHTML = createLoadingElement();
      document.getElementById('searchResults').style.display = 'block';
      
      try {
        // Wildcard search logic
        let processedQuery = query;
        let isWildcardSearch = false;
        
        if (query.includes('*')) {
          isWildcardSearch = true;
          processedQuery = query.replace(/\*/g, '');
          showNotification(`üîç Wildcard search: Finding shows with "${processedQuery}"`, 'info');
        }
        
        const results = await fetchShowData(processedQuery, currentPage, genre);
        
        // Filter results for wildcard searches
        let filteredResults = results;
        if (isWildcardSearch) {
          const searchTerm = processedQuery.toLowerCase();
          filteredResults = results.filter(item => {
            const title = (item.name || item.title || '').toLowerCase();
            
            if (query.startsWith('*') && query.endsWith('*')) {
              return title.includes(searchTerm);
            } else if (query.startsWith('*')) {
              return title.endsWith(searchTerm);
            } else if (query.endsWith('*')) {
              return title.startsWith(searchTerm);
            }
            
            return title.includes(searchTerm);
          });
          
          if (filteredResults.length !== results.length) {
            showNotification(`Filtered to ${filteredResults.length} shows matching "${query}" üéØ`, 'success');
          }
        }
        
        searchCache = filteredResults;
        displaySearchResults(filteredResults);
        updatePagination();
        
        if (filteredResults.length === 0) {
          showNotification('No results found. Try lowering your standards! üìâ', 'warning');
        } else if (!isWildcardSearch) {
          showNotification(`Found ${filteredResults.length} options for your viewing pleasure! üéØ`, 'success');
        }
      } catch (error) {
        container.innerHTML = `<div style="color: red; text-align: center; padding: 40px; font-weight: bold;">Search failed: ${error.message}<br><br>Maybe try turning it off and on again? ü§∑‚Äç‚ôÇÔ∏è</div>`;
        showNotification('Search failed. The internet is judging you! üåê', 'error');
      }
    }

    async function fetchShowData(query, page = 1, genreFilter = '') {
      const type = 'multi'; // Search both TV and movies
      let endpoint = `search/${type}`;
      let params = `endpoint=${endpoint}&page=${page}`;
      
      if (query) params += `&query=${encodeURIComponent(query)}`;
      if (genreFilter && !query) {
        endpoint = `discover/tv`; // Default to TV for genre browsing
        params = `endpoint=${endpoint}&page=${page}&genre=${genreFilter}`;
      }
      
      try {
        const response = await fetch(`${API_BASE}?${params}`);
        
        if (!response.ok) {
          throw new Error(`Search service unavailable (${response.status}). Please try again later.`);
        }
        
        const data = await response.json();
        return data.results || [];
      } catch (error) {
        console.error('Fetch error:', error);
        throw new Error('Search temporarily unavailable. Our servers are probably binge-watching something! üì∫');
      }
    }

    async function loadGenres() {
      try {
        const response = await fetch(`${API_BASE}?endpoint=genre/tv/list`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        const select = document.getElementById('genreFilter');
        select.innerHTML = '<option value="">All Genres</option>';
        
        if (data.genres && data.genres.length > 0) {
          data.genres.forEach(genre => {
            select.innerHTML += `<option value="${genre.id}">${genre.name}</option>`;
          });
        }
      } catch (error) {
        console.error('Error loading genres:', error);
        const select = document.getElementById('genreFilter');
        const fallbackGenres = [
          {id: 10759, name: 'Action & Adventure'}, {id: 16, name: 'Animation'}, 
          {id: 35, name: 'Comedy'}, {id: 80, name: 'Crime'}, 
          {id: 99, name: 'Documentary'}, {id: 18, name: 'Drama'}, 
          {id: 10765, name: 'Sci-Fi & Fantasy'}
        ];
        
        select.innerHTML = '<option value="">All Genres</option>';
        fallbackGenres.forEach(genre => {
          select.innerHTML += `<option value="${genre.id}">${genre.name}</option>`;
        });
      }
    }

    function displaySearchResults(results) {
      const container = document.getElementById('searchResultsList');
      document.getElementById('resultsCount').textContent = results.length;
      
      if (results.length === 0) {
        container.innerHTML = '<div class="empty-state sassy-empty">No results found. Maybe try something that actually exists? ü§®</div>';
        return;
      }
      
      container.innerHTML = '';
      results.forEach(item => {
        const card = createShowCard(item, true);
        container.appendChild(card);
      });
    }

    function createShowCard(item, isSearchResult = false) {
      const card = document.createElement('div');
      card.className = 'show-card';
      
      const title = item.name || item.title || 'Unknown Title';
      const date = item.first_air_date || item.release_date || '';
      const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
      const overview = item.overview || 'No description available.';
      const mediaType = item.media_type || (item.first_air_date ? 'tv' : 'movie');
      
      const category = mediaType === 'tv' ? 'tv' : 'movies';
      const isInWatching = appData[category].watching.some(show => show.id === item.id);
      const isInWishlist = appData[category].wishlist.some(show => show.id === item.id);
      
      const posterHtml = item.poster_path ? 
        `<img src="${TMDB_IMG_BASE}${item.poster_path}" alt="${title}" class="show-poster">` : 
        `<div class="poster-placeholder">No Image<br>Available üì∑</div>`;
      
      let actionsHtml = '';
      
      if (isSearchResult) {
        actionsHtml = `
          <button onclick="addToList(${JSON.stringify(item).replace(/"/g, '&quot;')}, 'watching')" ${isInWatching ? 'disabled' : ''}>
            ${isInWatching ? '‚úì Already Watching' : '‚ñ∂Ô∏è Start Watching'}
          </button>
          <button onclick="addToList(${JSON.stringify(item).replace(/"/g, '&quot;')}, 'wishlist')" ${isInWishlist ? 'disabled' : ''}>
            ${isInWishlist ? '‚úì In Wishlist' : 'üîñ Want to Watch'}
          </button>
        `;
      } else {
        // Full card for watching/wishlist sections
        const userRating = item.userRating || 0;
        const notes = item.notes || '';
        
        actionsHtml = `
          <div class="rating-container">
            <span>Your Rating:</span>
            <div class="star-rating">
              ${[1,2,3,4,5].map(star => 
                `<span class="star ${star <= userRating ? 'active' : ''}" onclick="setRating(${item.id}, ${star})">‚≠ê</span>`
              ).join('')}
            </div>
          </div>
          <div class="notes-container">
            <textarea class="notes-field" placeholder="What I loved about this (250 chars)..." maxlength="250" onchange="updateNotes(${item.id}, this.value)">${notes}</textarea>
            <div class="char-count ${notes.length > 200 ? 'warning' : ''} ${notes.length > 240 ? 'danger' : ''}">${notes.length}/250</div>
          </div>
          <div class="show-actions">
            <button onclick="moveItem(${item.id}, 'watching')" ${isInWatching ? 'disabled' : ''}>‚Üí Currently Watching</button>
            <button onclick="moveItem(${item.id}, 'wishlist')" ${isInWishlist ? 'disabled' : ''}>‚Üí Want to Watch</button>
            <button class="favorite ${item.favorite ? 'active' : ''}" onclick="toggleFavorite(${item.id})">‚≠ê ${item.favorite ? 'Favorited' : 'Favorite'}</button>
            <button class="danger" onclick="removeItem(${item.id})">üóëÔ∏è Remove</button>
            <input type="text" placeholder="Progress notes..." value="${item.progress || ''}" onchange="updateProgress(${item.id}, this.value)">
          </div>
        `;
      }
      
      card.innerHTML = `
        ${posterHtml}
        <div class="show-details">
          <h4 class="show-title">${title}</h4>
          <div class="show-meta">‚≠ê ${rating} ${date ? `‚Ä¢ ${date.split('-')[0]}` : ''} ‚Ä¢ ${mediaType.toUpperCase()}</div>
          <div class="show-overview" onclick="this.classList.toggle('expanded')">${overview}</div>
          ${actionsHtml}
        </div>
      `;
      
      return card;
    }

    function addToList(item, listType) {
      const mediaType = item.media_type || (item.first_air_date ? 'tv' : 'movie');
      const category = mediaType === 'tv' ? 'tv' : 'movies';
      
      const newItem = {
        id: item.id,
        title: item.name || item.title,
        overview: item.overview,
        poster_path: item.poster_path,
        date: item.first_air_date || item.release_date,
        rating: item.vote_average,
        media_type: mediaType,
        date_added: new Date().toISOString(),
        progress: '',
        favorite: false,
        userRating: 0,
        notes: ''
      };
      
      if (!appData[category][listType].some(show => show.id === item.id)) {
        appData[category][listType].push(newItem);
        saveAppData();
        updateUI();
        performSearch();
        
        const listName = listType === 'watching' ? 'Currently Watching' : 'Want to Watch';
        showNotification(`Added "${newItem.title}" to ${listName}! üéâ`, 'success');
      } else {
        showNotification('Already on your list, genius! üôÑ', 'warning');
      }
    }

    function moveItem(itemId, newListType) {
      let item = null;
      let fromList = null;
      let category = null;
      
      // Find the item in both categories
      ['tv', 'movies'].forEach(cat => {
        ['watching', 'wishlist'].forEach(list => {
          const found = appData[cat][list].find(s => s.id === itemId);
          if (found) {
            item = found;
            fromList = list;
            category = cat;
          }
        });
      });
      
      if (item && fromList !== newListType) {
        appData[category][fromList] = appData[category][fromList].filter(s => s.id !== itemId);
        appData[category][newListType].push(item);
        saveAppData();
        updateUI();
        
        const fromName = fromList === 'watching' ? 'Currently Watching' : 'Want to Watch';
        const toName = newListType === 'watching' ? 'Currently Watching' : 'Want to Watch';
        showNotification(`Moved "${item.title}" from ${fromName} to ${toName}! üì¶`, 'success');
      }
    }

    function removeItem(itemId) {
      if (confirm('Remove this item? It\'s probably for the best... üóëÔ∏è')) {
        let item = null;
        
        ['tv', 'movies'].forEach(category => {
          ['watching', 'wishlist'].forEach(list => {
            const found = appData[category][list].find(s => s.id === itemId);
            if (found) item = found;
            appData[category][list] = appData[category][list].filter(s => s.id !== itemId);
          });
        });
        
        saveAppData();
        updateUI();
        
        showNotification(`"${item?.title || 'Item'}" has been yeeted into the void! üöÄ`, 'success');
      }
    }

    function toggleFavorite(itemId) {
      let item = null;
      
      ['tv', 'movies'].forEach(category => {
        ['watching', 'wishlist'].forEach(list => {
          const found = appData[category][list].find(s => s.id === itemId);
          if (found) item = found;
        });
      });
      
      if (item) {
        item.favorite = !item.favorite;
        saveAppData();
        updateUI();
        
        const action = item.favorite ? 'favorited' : 'unfavorited';
        showNotification(`${item.title} ${action}! ${item.favorite ? '‚≠ê' : 'üíî'}`, 'success');
      }
    }

    function setRating(itemId, rating) {
      let item = null;
      
      ['tv', 'movies'].forEach(category => {
        ['watching', 'wishlist'].forEach(list => {
          const found = appData[category][list].find(s => s.id === itemId);
          if (found) item = found;
        });
      });
      
      if (item) {
        item.userRating = rating;
        saveAppData();
        updateUI();
        showNotification(`Rated "${item.title}" ${rating} stars! ‚≠ê`, 'success');
      }
    }

    function updateNotes(itemId, notes) {
      let item = null;
      
      ['tv', 'movies'].forEach(category => {
        ['watching', 'wishlist'].forEach(list => {
          const found = appData[category][list].find(s => s.id === itemId);
          if (found) item = found;
        });
      });
      
      if (item) {
        item.notes = notes;
        saveAppData();
      }
    }

    function updateProgress(itemId, progress) {
      let item = null;
      
      ['tv', 'movies'].forEach(category => {
        ['watching', 'wishlist'].forEach(list => {
          const found = appData[category][list].find(s => s.id === itemId);
          if (found) item = found;
        });
      });
      
      if (item) {
        item.progress = progress;
        saveAppData();
      }
    }

    function updateUI() {
      const totalWatching = appData.tv.watching.length + appData.movies.watching.length;
      const totalWishlist = appData.tv.wishlist.length + appData.movies.wishlist.length;
      
      // Update tab badges
      document.getElementById('watchingBadge').textContent = totalWatching;
      document.getElementById('wishlistBadge').textContent = totalWishlist;
      
      // Update stats
      document.getElementById('totalWatchingCount').textContent = totalWatching;
      document.getElementById('totalWishlistCount').textContent = totalWishlist;
      document.getElementById('totalCount').textContent = totalWatching + totalWishlist;
      
      // Update section counts
      document.getElementById('watchingCount').textContent = totalWatching;
      document.getElementById('wishlistCount').textContent = totalWishlist;
      
      // Update lists
      updateList('watchingList', [...appData.tv.watching, ...appData.movies.watching]);
      updateList('wishlistList', [...appData.tv.wishlist, ...appData.movies.wishlist]);
    }

    function updateList(containerId, items) {
      const container = document.getElementById(containerId);
      
      if (items.length === 0) {
        const emptyMessages = {
          watchingList: 'No shows yet? What are you, productive or something? üôÑ',
          wishlistList: 'Your wishlist is emptier than a Netflix comedy special üíÄ'
        };
        container.innerHTML = `<div class="empty-state sassy-empty">${emptyMessages[containerId]}</div>`;
      } else {
        container.innerHTML = '';
        items.forEach(item => {
          container.appendChild(createShowCard(item, false));
        });
      }
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      document.getElementById('genreFilter').value = '';
      document.getElementById('clearSearchBtn').style.display = 'none';
      document.getElementById('searchResults').style.display = 'none';
      currentPage = 1;
      document.getElementById('pageInfo').textContent = 'Page 1';
      document.getElementById('prevPageBtn').disabled = true;
      document.getElementById('nextPageBtn').disabled = true;
      searchCache = [];
      showNotification('Search cleared! Back to square one! üîÑ', 'success');
    }

    function updatePagination() {
      document.getElementById('pageInfo').textContent = `Page ${currentPage}`;
      document.getElementById('prevPageBtn').disabled = currentPage === 1;
      document.getElementById('nextPageBtn').disabled = searchCache.length < 20;
    }

    function exportData() {
      const blob = new Blob([JSON.stringify(appData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tv-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Your questionable taste has been exported! üì§', 'success');
    }

    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const imported = JSON.parse(event.target.result);
          if (confirm('Import data? This will overwrite your current collection of digital hoarding! üíæ')) {
            Object.assign(appData, imported);
            saveAppData();
            updateUI();
            showNotification('Data imported! Your taste is still questionable! üéâ', 'success');
          }
        } catch (error) {
          showNotification('Invalid file format. Even your backups are broken! üí•', 'error');
        }
      };
      reader.readAsText(file);
    }

    function setupEasterEgg() {
      let clickCount = 0;
      document.getElementById('easterEgg').onclick = () => {
        clickCount++;
        if (clickCount % 3 === 0) {
          showRandomTip();
        }
      };
      
      // Feedback modal functionality
      const feedbackBtn = document.getElementById('feedbackBtn');
      const feedbackModal = document.getElementById('feedbackModal');
      const closeFeedback = document.getElementById('closeFeedback');
      const submitFeedback = document.getElementById('submitFeedback');
      const ratingBtns = document.querySelectorAll('.rating-btn');
      
      let selectedRating = 0;
      
      feedbackBtn.onclick = () => {
        feedbackModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      };
      
      closeFeedback.onclick = () => {
        feedbackModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      };
      
      // Close on background click
      feedbackModal.onclick = (e) => {
        if (e.target === feedbackModal) {
          feedbackModal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      };
      
      // Rating selection
      ratingBtns.forEach(btn => {
        btn.onclick = () => {
          ratingBtns.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedRating = parseInt(btn.dataset.rating);
        };
      });
      
      // Submit feedback
      submitFeedback.onclick = () => {
        const feedbackText = document.getElementById('feedbackText').value.trim();
        
        if (!feedbackText && selectedRating === 0) {
          showNotification('Come on, give us SOMETHING to work with! üôÑ', 'warning');
          return;
        }
        
        // Store feedback locally
        const feedback = {
          text: feedbackText,
          rating: selectedRating,
          timestamp: new Date().toISOString(),
          url: window.location.href
        };
        
        // Save to localStorage
        const existingFeedback = JSON.parse(localStorage.getItem('userFeedback') || '[]');
        existingFeedback.push(feedback);
        localStorage.setItem('userFeedback', JSON.stringify(existingFeedback));
        
        // Show success and close modal
        showNotification('Feedback submitted! We\'ll try not to disappoint you further! üéØ', 'success');
        feedbackModal.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Clear form
        document.getElementById('feedbackText').value = '';
        ratingBtns.forEach(b => b.classList.remove('selected'));
        selectedRating = 0;
      };
    }

    function setupSecretAdmin() {
      const title = document.getElementById('welcomeText');
      const adminBtn = document.getElementById('adminBtn');
      const adminModal = document.getElementById('adminModal');
      const closeAdmin = document.getElementById('closeAdmin');
      
      let clickCount = 0;
      let clickTimer = null;
      let adminActive = false;
      
      // Triple-click title to toggle admin button
      title.onclick = () => {
        clickCount++;
        clearTimeout(clickTimer);
        
        if (clickCount === 3) {
          adminActive = !adminActive;
          adminBtn.style.display = adminActive ? 'flex' : 'none';
          
          const message = adminActive ? 
            'üëë Admin mode activated!' : 
            'üëë Admin mode deactivated!';
          showNotification(message, 'success');
          clickCount = 0;
        } else {
          clickTimer = setTimeout(() => { clickCount = 0; }, 1000);
        }
      };
      
      // Admin button click
      adminBtn.onclick = () => {
        loadAdminData();
        adminModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      };
      
      // Close admin modal
      closeAdmin.onclick = () => {
        adminModal.style.display = 'none';
        document.body.style.overflow = 'auto';
      };
      
      adminModal.onclick = (e) => {
        if (e.target === adminModal) {
          adminModal.style.display = 'none';
          document.body.style.overflow = 'auto';
        }
      };
      
      // Admin actions
      document.getElementById('exportFeedback').onclick = exportAllFeedback;
      document.getElementById('clearFeedback').onclick = () => {
        if (confirm('üö® DELETE ALL FEEDBACK? This cannot be undone!')) {
          localStorage.removeItem('userFeedback');
          loadAdminData();
          showNotification('All feedback deleted! üíÄ', 'success');
        }
      };
    }
    
    function loadAdminData() {
      const feedback = JSON.parse(localStorage.getItem('userFeedback') || '[]');
      
      // Update stats
      document.getElementById('totalFeedback').textContent = feedback.length;
      
      if (feedback.length > 0) {
        const ratings = feedback.filter(f => f.rating > 0).map(f => f.rating);
        const avgRating = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : 'N/A';
        document.getElementById('avgRating').textContent = avgRating;
        
        const latest = new Date(feedback[feedback.length - 1].timestamp);
        document.getElementById('latestFeedback').textContent = latest.toLocaleDateString() + ' ' + latest.toLocaleTimeString();
      } else {
        document.getElementById('avgRating').textContent = 'N/A';
        document.getElementById('latestFeedback').textContent = 'Never';
      }
      
      // Load feedback items (most recent first)
      const feedbackContainer = document.getElementById('feedbackItems');
      if (feedback.length === 0) {
        feedbackContainer.innerHTML = '<p style="text-align: center; color: #666; font-style: italic;">No feedback yet. Get those Reddit posts going! üöÄ</p>';
        return;
      }
      
      feedbackContainer.innerHTML = '';
      feedback.slice().reverse().slice(0, 10).forEach(item => {
        const feedbackItem = document.createElement('div');
        feedbackItem.style.cssText = 'background: var(--card); padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid var(--primary);';
        
        const ratingText = item.rating > 0 ? getRatingText(item.rating) : 'No rating';
        const timestamp = new Date(item.timestamp).toLocaleDateString() + ' ' + new Date(item.timestamp).toLocaleTimeString();
        
        feedbackItem.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-size: 12px; color: #666;">
            <span style="font-size: 14px; font-weight: bold; color: ${getRatingColor(item.rating)};">${ratingText}</span>
            <span>${timestamp}</span>
          </div>
          <div style="color: var(--text); line-height: 1.5; font-style: italic;">${item.text || '<em>No text provided</em>'}</div>
        `;
        
        feedbackContainer.appendChild(feedbackItem);
      });
      
      if (feedback.length > 10) {
        const moreItem = document.createElement('p');
        moreItem.style.cssText = 'text-align: center; color: #666; font-style: italic;';
        moreItem.textContent = `... and ${feedback.length - 10} more entries`;
        feedbackContainer.appendChild(moreItem);
      }
    }
    
    function getRatingText(rating) {
      const ratingTexts = {
        1: 'üò§ Terrible',
        2: 'üòï Meh', 
        3: 'üôÇ Decent',
        4: 'üòç Love it',
        5: 'ü§Ø Mind blown'
      };
      return ratingTexts[rating] || 'Unknown';
    }
    
    function getRatingColor(rating) {
      const colors = {
        1: '#ff4757',
        2: '#ff6b6b', 
        3: '#ffa502',
        4: '#2ed573',
        5: '#1dd1a1'
      };
      return colors[rating] || '#666';
    }
    
    function exportAllFeedback() {
      const feedback = JSON.parse(localStorage.getItem('userFeedback') || '[]');
      
      if (feedback.length === 0) {
        showNotification('No feedback to export! üì≠', 'warning');
        return;
      }
      
      // Create CSV format
      const headers = ['Timestamp', 'Rating', 'Feedback Text', 'URL'];
      const csvContent = [
        headers.join(','),
        ...feedback.map(item => [
          item.timestamp,
          item.rating || 'N/A',
          `"${(item.text || '').replace(/"/g, '""')}"`, // Escape quotes for CSV
          item.url || ''
        ].join(','))
      ].join('\n');
      
      // Download CSV
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `feedback-export-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification(`Exported ${feedback.length} feedback entries! üìä`, 'success');
    }

    function showRandomTip() {
      const tip = tips[Math.floor(Math.random() * tips.length)];
      const bubble = document.createElement('div');
      bubble.className = 'tip-bubble';
      bubble.textContent = tip;
      document.body.appendChild(bubble);
      
      setTimeout(() => {
        if (bubble.parentNode) bubble.parentNode.removeChild(bubble);
      }, 4000);
    }

    // Handle PWA installation success
    window.addEventListener('appinstalled', () => {
      console.log('PWA was installed');
      showNotification('TV Tracker installed successfully! üöÄ', 'success');
      
      // Remove install button if still visible
      const installBtn = document.getElementById('installBtn');
      if (installBtn) installBtn.remove();
    });

    // Add install pulse animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes install-pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); box-shadow: 0 6px 25px rgba(45, 213, 115, 0.6); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>Total Feedback</span>
          </div>
          <div style="background: var(--card); padding: 20px; border-radius: 15px; text-align: center; flex: 1; min-width: 120px; border: 2px solid #ffd700;">
            <strong id="avgRating" style="display: block; font-size: 2em; color: #ffd700; margin-bottom: 5px;">0</strong>
            <span style="font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 1px;">