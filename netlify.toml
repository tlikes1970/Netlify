# =========================
# Netlify config (repo root)
# =========================

[build]
  base    = "apps/web"          # Monorepo app root
  publish = "dist"
  command = "npm run build"

# For builds (CI/prod), this path is **relative to [build].base**
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  external_node_modules = ["@sendgrid/mail"]

# For local dev, be explicit. Netlify CLI does NOT inherit [build].base here.
[dev]
  framework  = "#custom"
  command    = "npm run dev -- --port 4173 --strictPort"  # Vite dev
  targetPort = 4173                                       # where Vite actually runs
  port       = 8888                                       # Netlify proxy port
  functions  = "apps/web/netlify/functions"               # <-- absolute from repo root
  autoLaunch = false

# Redirects are optional since youâ€™re calling /.netlify/functions directly,
# but keeping this is fine if your client ever uses /api/tmdb-proxy.
[[redirects]]
  from = "/api/tmdb-proxy"
  to   = "/.netlify/functions/tmdb-proxy"
  status = 200

[[redirects]]
  from = "/emails"
  to   = "/404.html"
  status = 404
  force = true
