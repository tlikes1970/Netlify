# =========================
# Netlify config (repo root)
# =========================

[build]
  base    = "apps/web"          # Monorepo app root
  publish = "dist"
  command = "npm run build"

[build.environment]
  NODE_VERSION = "20"
  # Note: VITE_FIREBASE_* variables must be set in Netlify Dashboard
  # Go to Site Settings > Environment Variables and add:
  # VITE_FIREBASE_API_KEY
  # VITE_FIREBASE_AUTH_DOMAIN
  # VITE_FIREBASE_PROJECT_ID
  # VITE_FIREBASE_STORAGE_BUCKET
  # VITE_FIREBASE_MESSAGING_SENDER_ID
  # VITE_FIREBASE_APP_ID
  # VITE_FIREBASE_MEASUREMENT_ID

# Functions directory: relative to build base (apps/web)
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  external_node_modules = ["@sendgrid/mail"]

# Local dev: Netlify CLI does NOT inherit [build].base
[dev]
  framework  = "#custom"
  command    = "npm run dev --prefix apps/web -- --port 4173 --strictPort"
  targetPort = 4173
  port       = 8888
  functions  = "netlify/functions"
  autoLaunch = false

# Function alias (optional convenience)
[[redirects]]
  from = "/api/tmdb-proxy"
  to   = "/.netlify/functions/tmdb-proxy"
  status = 200

# Lock down a path you don't want exposed
[[redirects]]
  from = "/emails"
  to   = "/404.html"
  status = 404
  force = true

# SPA fallback so client routes don't 404
[[redirects]]
  from = "/*"
  to   = "/index.html"
  status = 200
