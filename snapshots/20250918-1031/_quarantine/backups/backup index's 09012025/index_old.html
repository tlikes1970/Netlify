<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flicklet — TV & Movie Tracker</title>
  <meta name="description" content="Search, track, and rate shows & films fast." />

  <!-- PWA / Icons -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" href="icons/icon-512.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- CSS -->
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="stylesheet" href="styles/mobile.css" />
  <link rel="stylesheet" href="styles/components.css" />
</head>
<body>
  <div class="main-container" id="appRoot">
    <!-- Header -->
    <header class="header" role="banner">
      <!-- Left: username + snark -->
      <div id="usernameSnarkContainer" style="text-align:left;min-width:200px;">
        <div id="dynamicUsername" style="font-size:18px;font-weight:700;">Welcome!</div>
        <div id="dynamicSnark" style="font-size:14px;opacity:.8;">Ready to track your shows</div>
      </div>

      <!-- Center: title -->
      <div>
        <h1 id="welcomeText" class="title" data-i18n="app_title">Flicklet</h1>
        <div id="snarkySubtitle" class="subtitle" data-i18n="subtitle">TV & Movie Tracker</div>
        <div id="bingeBanner" class="binge-banner" aria-live="polite"></div>
      </div>

      <!-- Right: controls -->
      <div class="user-section">
        <div id="networkStatus" class="network-status" title="Network Status"><span id="networkIcon">🌐</span></div>
        <button id="darkModeToggle" class="btn theme-toggle" title="Toggle Dark/Light Mode"><span id="themeIcon">🌙</span></button>
        <button id="mardiToggle" class="btn secondary" title="Mardi Gras mode">🎭</button>
        <button id="settingsTab" class="btn secondary" title="Settings">⚙️</button>
        <div style="display:flex;align-items:center;gap:12px;">
          <button id="accountBtn" class="btn secondary" title="Sign in / Account" onclick="handleAccountClick()">👤 <span data-i18n="sign_in_account">Sign In</span></button>
          <select id="langToggle" aria-label="Language" title="Language" onchange="changeLanguage(this.value)">
            <option value="en">EN</option>
            <option value="es">ES</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Sticky Top Search -->
    <div class="top-search">
      <div id="welcomeMessage" class="welcome-message" style="display:none;">
        <small>👋 <span data-i18n="welcome_message">Welcome to Flicklet! Start by searching for a show or movie you love.</span></small>
      </div>

      <div class="search-help">
        <small>💡 <span data-i18n="search_tips">Search tips: Use * for wildcards (e.g., "marvel*" for Marvel shows)</span></small>
      </div>

      <div class="search-row">
        <input id="searchInput" class="search-input" data-i18n-placeholder="search_placeholder" />
        <select id="genreFilter" class="genre-filter"><option value="" data-i18n="gen">Gen</option></select>
        <button id="searchBtn" class="btn search-btn" title="Search">
          <span class="btn-content">🔍</span>
          <span class="btn-loading" style="display:none;">⏳</span>
        </button>
        <button id="clearSearchBtn" class="btn secondary clear-search-btn">✖️ <span data-i18n="clear">Clear</span></button>
        <button id="advancedSearchBtn" class="btn secondary advanced-search-btn" onclick="toggleAdvancedSearch()" title="Advanced Search Options">⚙️</button>
      </div>

      <!-- Advanced Search -->
      <div id="advancedSearchOptions" class="advanced-search-options" style="display:none;">
        <div class="advanced-search-grid">
          <div class="search-filter-group">
            <label for="searchType" class="filter-label">Search Type</label>
            <select id="searchType" class="search-type-filter">
              <option value="title">Title & Overview</option>
              <option value="actor">Actor/Actress</option>
              <option value="director">Director</option>
              <option value="genre">Genre</option>
              <option value="keyword">Keywords</option>
            </select>
          </div>
          <div class="search-filter-group">
            <label class="filter-label">Year Range</label>
            <div class="year-range">
              <input type="number" id="yearFrom" class="year-input" placeholder="From" min="1900" max="2030">
              <span class="year-separator">-</span>
              <input type="number" id="yearTo" class="year-input" placeholder="To" min="1900" max="2030">
            </div>
          </div>
          <div class="search-filter-group">
            <label for="ratingFilter" class="filter-label">Minimum Rating</label>
            <select id="ratingFilter" class="rating-filter">
              <option value="">Any Rating</option>
              <option value="9">9+ (Excellent)</option>
              <option value="8">8+ (Very Good)</option>
              <option value="7">7+ (Good)</option>
              <option value="6">6+ (Fair)</option>
              <option value="5">5+ (Average)</option>
            </select>
          </div>
          <div class="search-filter-group">
            <label for="mediaTypeFilter" class="filter-label">Media Type</label>
            <select id="mediaTypeFilter" class="media-type-filter">
              <option value="">All Types</option>
              <option value="movie">Movies Only</option>
              <option value="tv">TV Shows Only</option>
            </select>
          </div>
          <div class="search-filter-group">
            <label for="sortByFilter" class="filter-label">Sort By</label>
            <select id="sortByFilter" class="sort-by-filter">
              <option value="relevance">Relevance</option>
              <option value="title">Title A–Z</option>
              <option value="year">Year (Newest First)</option>
              <option value="rating">Rating (Highest First)</option>
              <option value="popularity">Popularity</option>
            </select>
          </div>
          <div class="search-filter-group">
            <label for="languageFilter" class="filter-label">Language</label>
            <select id="languageFilter" class="language-filter">
              <option value="">Any Language</option>
              <option value="en">English</option>
              <option value="es">Spanish</option>
              <option value="fr">French</option>
              <option value="de">German</option>
              <option value="it">Italian</option>
              <option value="pt">Portuguese</option>
              <option value="ru">Russian</option>
              <option value="ja">Japanese</option>
              <option value="ko">Korean</option>
              <option value="zh">Chinese</option>
            </select>
          </div>
        </div>

        <div class="advanced-search-actions">
          <button id="applyFiltersBtn" class="btn primary" onclick="applyAdvancedFilters()">✅ Apply Filters</button>
          <button id="resetFiltersBtn" class="btn secondary" onclick="resetAdvancedFilters()">🔄 Reset All</button>
        </div>
      </div>

      <div id="tagFilterRow" class="tag-filters" aria-label="Tag filters"></div>
      
      <!-- Search Results Container -->
      <div id="searchResults" class="search-results" style="display:none;"></div>
    </div>

    <!-- Tabs -->
    <div class="tab-container">
      <button id="homeTab" class="tab active" title="Overview">🏠 <span data-i18n="home">Home</span></button>
      <button id="watchingTab" class="tab" title="Currently watching">▶️ <span data-i18n="currently_watching">Currently Watching</span><span class="tab-badge" id="watchingBadge">0</span></button>
      <button id="wishlistTab" class="tab" title="Want to watch">📖 <span data-i18n="want_to_watch">Want to Watch</span><span class="tab-badge" id="wishlistBadge">0</span></button>
      <button id="watchedTab" class="tab" title="Already watched">✅ <span data-i18n="already_watched">Already Watched</span><span class="tab-badge" id="watchedBadge">0</span></button>
      <button id="discoverTab" class="tab" title="Discover">✨ <span data-i18n="discover">Discover</span></button>
    </div>

    <!-- Home -->
    <div id="homeSection" class="tab-section">
      <div class="stats">
        <div class="stat" id="bingeMeter"></div>
      </div>
      
      <!-- FlickWord and Quotes Row -->
      <div class="flickword-quotes-row">
        <!-- FlickWord Game Card -->
        <div class="flickword-card">
          <div class="flickword-header">
            <h3 class="flickword-title">🎮 Daily Word Challenge</h3>
            <div id="flickwordCountdown" class="flickword-countdown">Loading...</div>
          </div>
          
          <div class="flickword-stats">
            <div class="stat-item">
              <span class="stat-label">🔥 STREAK</span>
              <span class="stat-value" id="todayScore">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">🏆 BEST</span>
              <span class="stat-value" id="bestStreak">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">🎮 PLAYED</span>
              <span class="stat-value" id="gamesPlayed">0</span>
            </div>
          </div>
          
          <div class="flickword-actions">
            <button class="btn primary" onclick="startFlickWordGame()">Play Today's Word</button>
            <div class="flickword-hint" id="flickwordHint">Hint: Today's word starts with 'M'</div>
          </div>
        </div>
        
        <!-- Quote Card -->
        <div class="quote-card">
          <div class="quote-content">
            <p id="dailyQuote">I fear no man, but I fear finales.</p>
          </div>
        </div>
      </div>
      
      <!-- Streaming Horoscope -->
      <div class="horoscope-card">
        <div class="horoscope-header">
          <h3 class="horoscope-title">🔮 Streaming Horoscope</h3>
        </div>
        <div class="horoscope-content">
          <p class="horoscope-text" id="horoscopeText">You hoard tabs and storylines with equal skill.</p>
        </div>
      </div>
      
      <!-- Share Your Thoughts -->
      <div class="feedback-section">
        <h3>💭 Share Your Thoughts</h3>
        <p class="feedback-description">Share your thoughts! Give us app feedback, tell us what's working (or not), share a quote for our rotation, make a confession, or just vent. We're listening!</p>
        <div class="feedback-options">
          <span class="feedback-option">App feedback</span>
          <span class="feedback-option">Random thoughts</span>
          <span class="feedback-option">Quote submissions</span>
          <span class="feedback-option">Anonymous confessions</span>
          <span class="feedback-option">Venting welcome</span>
        </div>
        <textarea id="feedbackText" placeholder="Share your thoughts, feedback, quotes, confessions, or just vent here..." rows="3"></textarea>
        <button class="btn primary" onclick="submitFeedback()">Share It!</button>
      </div>
    </div>

    <main id="main" role="main">

      <!-- Watching -->
      <div id="watchingSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ▶️ <span data-i18n="currently_watching">Currently Watching</span>
              <span class="count" id="watchingCount">0</span>
            </h3>
          </div>
          <div id="watchingList" class="list-container"></div>
        </div>
      </div>

      <!-- Wishlist -->
      <div id="wishlistSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              📖 <span data-i18n="want_to_watch">Want to Watch</span>
              <span class="count" id="wishlistCount">0</span>
            </h3>
          </div>
          <div id="wishlistList" class="list-container"></div>
        </div>
      </div>

      <!-- Watched -->
      <div id="watchedSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ✅ <span data-i18n="already_watched">Already Watched</span>
              <span class="count" id="watchedCount">0</span>
            </h3>
          </div>
          <div id="watchedList" class="list-container"></div>
        </div>
      </div>

      <!-- Discover -->
      <div id="discoverSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ✨ <span data-i18n="discover">Discover</span>
            </h3>
          </div>
          <div id="discoverList" class="list-container"></div>
        </div>
      </div>

      <!-- Settings -->
      <div id="settingsSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ⚙️ <span data-i18n="settings">Settings</span>
            </h3>
          </div>
          <div id="settingsList" class="list-container"></div>
        </div>
      </div>

    </main>
  </div>

  <!-- Sign In Modal -->
  <div id="signInModal" class="modal-backdrop" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>🔐 Sign In to Sync</h2>
        <button class="modal-close" onclick="closeSignInModal()">×</button>
      </div>
      <div class="modal-body">
        <p>Sign in to back up your lists and sync across devices.</p>
        <div class="auth-buttons">
          <button class="btn primary" onclick="signInWithGoogle()">
            🔗 Continue with Google
          </button>
          <button class="btn primary apple-btn" onclick="signInWithApple()">
            🍎 Continue with Apple
          </button>
          <button class="btn secondary" onclick="signInWithEmail()">
            📧 Email Sign-In
          </button>
        </div>
        <div class="auth-note">
          <small>Your data stays private and secure. We only sync your watchlists.</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Modal -->
  <div id="accountModal" class="modal-backdrop" style="display:none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>👤 Account</h2>
        <button class="modal-close" onclick="closeAccountModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="account-info">
          <p>Signed in as: <strong id="accountEmail">user@example.com</strong></p>
          <p>Account type: <span id="accountType">Free</span></p>
        </div>
        <div class="account-actions">
          <button class="btn secondary" onclick="exportData()">📤 Export Data</button>
          <button class="btn secondary" onclick="importData()">📥 Import Data</button>
          <button class="btn danger" onclick="signOut()">🚪 Sign Out</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(err => console.warn('[SW] registration failed:', err));
      });
    }
  </script>

  <!-- Load order matters: TMDB config must come first -->
  <script src="/tmdb-config.js"></script>

  <!-- App scripts (no inline JS anywhere) -->
  <!-- Cleaned core files (in correct order) -->
  <script src="js/utils.js"></script>
  <script src="js/i18n.js"></script>
  <script src="js/functions.js"></script>
  <script src="js/app.js"></script>
  <script src="js/bootstrap.js"></script>
  
  <!-- Legacy files commented out (replace with cleaned versions above) -->
  <!-- <script src="js/functions.js"></script> -->
  <!-- <script src="js/app.js"></script> -->
  <!-- <script src="js/bootstrap.js"></script> -->

  <!-- Firebase Compat (no module specifier errors) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="firebase-config.js"></script>
</body>
</html>
