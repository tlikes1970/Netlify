<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Modal Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .test-button:disabled { background: #ccc; cursor: not-allowed; }
        .status { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <h1>üîê Login Modal Fix Test</h1>
    <p>This test verifies that the login modal fixes are working correctly.</p>

    <div class="test-section">
        <h2>Test 1: Modal Button Type Attributes</h2>
        <p>All buttons in modals should have <code>type="button"</code> to prevent form submission.</p>
        <button class="test-button" onclick="testButtonTypes()">Test Button Types</button>
        <div id="buttonTestResult" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Modal Protection</h2>
        <p>Modals should prevent accidental closure and form submission issues.</p>
        <button class="test-button" onclick="testModalProtection()">Test Modal Protection</button>
        <div id="modalTestResult" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Firebase Configuration Check</h2>
        <p>Should show clear error if Firebase is not configured.</p>
        <button class="test-button" onclick="testFirebaseConfig()">Test Firebase Config</button>
        <div id="firebaseTestResult" class="status"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Auth Helpers Availability</h2>
        <p>Enhanced auth helpers should be available globally.</p>
        <button class="test-button" onclick="testAuthHelpers()">Test Auth Helpers</button>
        <div id="authTestResult" class="status"></div>
    </div>

    <script>
        function showStatus(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function testButtonTypes() {
            try {
                // Create a test modal with buttons
                const modal = document.createElement('div');
                modal.className = 'modal-backdrop';
                modal.innerHTML = `
                    <div class="modal">
                        <h3>Test Modal</h3>
                        <div class="modal-body">
                            <button id="testBtn1">Button 1</button>
                            <button id="testBtn2" type="submit">Button 2</button>
                            <button id="testBtn3" type="button">Button 3</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                // Check button types
                const btn1 = document.getElementById('testBtn1');
                const btn2 = document.getElementById('testBtn2');
                const btn3 = document.getElementById('testBtn3');

                // Simulate the protection logic
                if (btn1 && !btn1.type) {
                    btn1.setAttribute('type', 'button');
                }

                const results = {
                    btn1: btn1 ? btn1.type : 'not found',
                    btn2: btn2 ? btn2.type : 'not found',
                    btn3: btn3 ? btn3.type : 'not found'
                };

                // Clean up
                document.body.removeChild(modal);

                showStatus('buttonTestResult', 
                    `Button types: ${JSON.stringify(results)}`, 
                    'success');
            } catch (error) {
                showStatus('buttonTestResult', `Error: ${error.message}`, 'error');
            }
        }

        function testModalProtection() {
            try {
                // Test if the protection logic would work
                const testElement = document.createElement('div');
                testElement.className = 'modal-backdrop';
                testElement.innerHTML = `
                    <div class="modal">
                        <h3>Test Modal</h3>
                        <form>
                            <input type="text" placeholder="Test input">
                            <button type="submit">Submit</button>
                        </form>
                    </div>
                `;

                // Simulate the protection
                let clickPrevented = false;
                let submitPrevented = false;

                testElement.addEventListener('click', (e) => {
                    const t = e.target;
                    if (t.matches('button, [role="button"]')) {
                        e.preventDefault();
                        e.stopPropagation();
                        clickPrevented = true;
                    }
                });

                testElement.querySelectorAll('form').forEach(f => {
                    f.addEventListener('submit', (e) => { 
                        e.preventDefault(); 
                        e.stopPropagation(); 
                        submitPrevented = true;
                    });
                });

                // Test the protection
                const button = testElement.querySelector('button');
                const form = testElement.querySelector('form');
                
                button.click();
                form.dispatchEvent(new Event('submit'));

                showStatus('modalTestResult', 
                    `Click prevented: ${clickPrevented}, Submit prevented: ${submitPrevented}`, 
                    'success');
            } catch (error) {
                showStatus('modalTestResult', `Error: ${error.message}`, 'error');
            }
        }

        function testFirebaseConfig() {
            try {
                // Check if Firebase is available
                const hasFirebase = !!(window.firebase && (firebase.apps?.length || window.firebaseConfig));
                
                if (hasFirebase) {
                    showStatus('firebaseTestResult', 'Firebase is configured', 'success');
                } else {
                    showStatus('firebaseTestResult', 'Firebase not configured - this is expected in test environment', 'warning');
                }
            } catch (error) {
                showStatus('firebaseTestResult', `Error: ${error.message}`, 'error');
            }
        }

        function testAuthHelpers() {
            try {
                // Check if auth helpers are available
                if (window.authHelpers) {
                    const helpers = Object.keys(window.authHelpers);
                    showStatus('authTestResult', 
                        `Auth helpers available: ${helpers.join(', ')}`, 
                        'success');
                } else {
                    showStatus('authTestResult', 
                        'Auth helpers not available - this is expected if auth.js is not loaded', 
                        'warning');
                }
            } catch (error) {
                showStatus('authTestResult', `Error: ${error.message}`, 'error');
            }
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            console.log('üîê Login Modal Fix Test loaded');
            console.log('Available functions:', {
                testButtonTypes: typeof testButtonTypes,
                testModalProtection: typeof testModalProtection,
                testFirebaseConfig: typeof testFirebaseConfig,
                testAuthHelpers: typeof testAuthHelpers
            });
        });
    </script>
</body>
</html>
