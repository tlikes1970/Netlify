<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Copy/Paste Detector Report</title><link href="styles/tailwind.css" rel="stylesheet"><link href="styles/prism.css" rel="stylesheet"></head><body class="bg-gray-100"><header class="bg-white shadow py-4"><div class="container mx-auto px-4"><h1 class="text-3xl font-semibold text-gray-800">jscpd - copy/paste report</h1></div></header><main class="container mx-auto my-8 p-4 bg-white shadow rounded"><section class="mb-8" id="dashboard"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Dashboard</h2><div class="grid grid-cols-4 gap-4"><div class="bg-blue-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-blue-800 mb-2">Total Files</h3><span class="text-4xl font-bold text-blue-800">108</span></div><div class="bg-green-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-green-800 mb-2">Total Lines of Code</h3><span class="text-4xl font-bold text-green-800">22619</span></div><div class="bg-yellow-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-yellow-800 mb-2">Number of Clones</h3><span class="text-4xl font-bold text-yellow-800">56</span></div><div class="bg-red-200 p-4 rounded text-center"><h3 class="text-lg font-semibold text-red-800 mb-2">Duplicated Lines</h3><span class="text-4xl font-bold text-red-800">1463 (6.47%)</span></div></div></section><section class="mb-8" id="formats"><h2 class="text-2xl font-semibold text-gray-700 mb-4">Formats with Duplications</h2><table class="w-full table-auto"><thead><tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal"><th class="py-3 px-6 text-left">Format</th><th class="py-3 px-6 text-left">Files</th><th class="py-3 px-6 text-left">Lines</th><th class="py-3 px-6 text-left">Clones</th><th class="py-3 px-6 text-left">Duplicated Lines</th><th class="py-3 px-6 text-left">Duplicated Tokens</th></tr></thead><tbody><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#css-clones">css</a></td><td class="py-3 px-6">7</td><td class="py-3 px-6">1402</td><td class="py-3 px-6">3</td><td class="py-3 px-6">45</td><td class="py-3 px-6">391</td></tr><tr class="bg-white border-b border-gray-200 text-gray-800 text-sm"><td class="py-3 px-6"><a class="text-blue-600 hover:underline" href="#javascript-clones">javascript</a></td><td class="py-3 px-6">101</td><td class="py-3 px-6">21217</td><td class="py-3 px-6">53</td><td class="py-3 px-6">1418</td><td class="py-3 px-6">13190</td></tr></tbody></table></section><section class="mb-8" id="txt-clones"><a name="css-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">css</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">www\styles\mobile.css (Line 96:2 - Line 112:54), www\styles\mobile.css (Line 68:2 - Line 84:46)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn26" onclick="toggleCodeBlock('cloneGroup26', 'expandBtn26', 'collapseBtn26')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup26"><code class="language-css text-sm text-gray-800">{
    position: relative !important;
    top: auto !important;
    left: auto !important;
    font-size: 0.75rem !important;
    line-height: 1.1 !important;
    margin: 0 !important;
    padding: 2px 4px !important;
    background: rgba(0,0,0,0.1) !important;
    border-radius: 4px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 100% !important;
  }
  
  .mobile-v1 .search-help span[data-i18n=&quot;search_tips&quot;]</code></pre></div><div class="py-4"><p class="text-gray-600">www\styles\mobile.css (Line 467:2 - Line 484:37), www\styles\mobile.css (Line 449:2 - Line 466:52)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn27" onclick="toggleCodeBlock('cloneGroup27', 'expandBtn27', 'collapseBtn27')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup27"><code class="language-css text-sm text-gray-800">{
    display: grid !important;
    grid-template-columns: var(--poster-w-mobile) 1fr !important;
    gap: var(--card-gap-mobile) !important;
    padding: var(--card-pad-y-mobile) var(--card-pad-x-mobile) !important;
    background: var(--card-bg);
    border: var(--card-border);
    width: 100% !important;
    max-width: 100% !important;
    border-radius: var(--card-radius);
    align-items: start;
    margin: 0 0 16px !important;
    box-sizing: border-box !important;
    box-shadow: var(--card-shadow);
    min-height: var(--poster-h-mobile);
  }
  
  /* UNIFIED: Mobile details layout */</code></pre></div><div class="py-4"><p class="text-gray-600">www\styles\action-bar.css (Line 276:2 - Line 288:54), www\styles\action-bar.css (Line 250:2 - Line 262:43)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn28" onclick="toggleCodeBlock('cloneGroup28', 'expandBtn28', 'collapseBtn28')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup28"><code class="language-css text-sm text-gray-800">{
  position: fixed;
  top: auto;
  bottom: 0;
  left: 0;
  right: 0;
  margin: 0;
  border-radius: 16px 16px 0 0;
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
  transform: translateY(100%);
}

.mobile-v1 .action-overflow-menu[aria-hidden=&quot;false&quot;]</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div><a name="javascript-clones"></a><h2 class="text-2xl font-semibold text-gray-700 mb-4">javascript</h2><div class="divide-y divide-gray-200 border-b-2"><div class="py-4"><p class="text-gray-600">www\scripts\components\Card.js (Line 135:7 - Line 144:11), www\scripts\components\Card.js (Line 110:7 - Line 122:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn0" onclick="toggleCodeBlock('cloneGroup0', 'expandBtn0', 'collapseBtn0')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup0"><code class="language-javascript text-sm text-gray-800">card.innerHTML = `
        &lt;div class=&quot;card__poster&quot; role=&quot;button&quot; tabindex=&quot;0&quot; aria-label=&quot;${title}&quot;&gt;
          ${posterUrl ? 
            `&lt;img src=&quot;${posterUrl}&quot; ${srcset ? `srcset=&quot;${srcset}&quot;` : ''} sizes=&quot;(max-width: 480px) 148px, 200px&quot; alt=&quot;${title} poster&quot; loading=&quot;lazy&quot; onerror=&quot;this.style.display='none'; this.nextElementSibling.style.display='flex';&quot;&gt;` :
            ''
          }
          &lt;div class=&quot;card__poster-placeholder&quot; style=&quot;display: ${posterUrl ? 'none' : 'flex'};&quot;&gt;
            🎬
          &lt;/div&gt;
          </code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\components\ActionBar.js (Line 147:22 - Line 159:31), www\scripts\components\ActionBar.js (Line 131:22 - Line 143:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn1" onclick="toggleCodeBlock('cloneGroup1', 'expandBtn1', 'collapseBtn1')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup1"><code class="language-javascript text-sm text-gray-800">${action.action}&quot; 
        data-id=&quot;${itemId}&quot; 
        data-list=&quot;${action.list || ''}&quot;
        data-media-type=&quot;${mediaType}&quot;
        aria-label=&quot;${action.label}&quot;
        title=&quot;${action.label}&quot;
      &gt;
        ${action.icon ? `&lt;span class=&quot;action-icon&quot; aria-hidden=&quot;true&quot;&gt;${action.icon}&lt;/span&gt;` : ''}
        &lt;span class=&quot;action-label&quot;&gt;${action.label}&lt;/span&gt;
      &lt;/button&gt;
    `).join('');

    // Generate overflow menu HTML</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\community\games.js (Line 9:38 - Line 26:31), www\scripts\modals\games-teaser.js (Line 9:31 - Line 26:38)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn2" onclick="toggleCodeBlock('cloneGroup2', 'expandBtn2', 'collapseBtn2')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup2"><code class="language-javascript text-sm text-gray-800">);

  // Helper function to get translation
  function t(key) {
    // Handle nested i18n keys
    const keys = key.split('.');
    let value = window.i18n;
    for (let i = 0; i &lt; keys.length; i++) {
      if (value &amp;&amp; typeof value === 'object' &amp;&amp; keys[i] in value) {
        value = value[keys[i]];
      } else {
        return key; // Return key if not found
      }
    }
    return value;
  }

  // Helper function to navigate</code></pre></div><div class="py-4"><p class="text-gray-600">www\netlify\functions\tmdb.js (Line 186:5 - Line 200:43), www\netlify\functions\tmdb.js (Line 9:5 - Line 23:4)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn3" onclick="toggleCodeBlock('cloneGroup3', 'expandBtn3', 'collapseBtn3')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup3"><code class="language-javascript text-sm text-gray-800">'http://localhost:3000',
    'http://127.0.0.1:3000',
    'http://localhost:8000',
    'http://127.0.0.1:8000',
    'http://localhost:8888', // Netlify dev
    'http://127.0.0.1:8888'
  ];
  
  const origin = event.headers.origin || event.headers.referer || '';
  const isAllowedOrigin = allowedOrigins.some(allowed =&gt; 
    origin.startsWith(allowed)
  ) || !origin; // Allow if no origin (direct access)
  
  const headers = {
    'Access-Control-Allow-Origin': isAllowedOrigin ? (origin || '*') : 'https://zippy-meerkat-329c02.netlify.app'</code></pre></div><div class="py-4"><p class="text-gray-600">www\netlify\functions\tmdb.js (Line 200:43 - Line 299:2), www\netlify\functions\tmdb.js (Line 23:4 - Line 123:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn4" onclick="toggleCodeBlock('cloneGroup4', 'expandBtn4', 'collapseBtn4')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup4"><code class="language-javascript text-sm text-gray-800">,
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'GET, OPTIONS',
    'Content-Type': 'application/json',
    'Cache-Control': 'public, max-age=300' // 5 minute cache
  };

  // Handle preflight CORS requests
  if (event.httpMethod === 'OPTIONS') {
    console.log('Handling OPTIONS request');
    return { 
      statusCode: 200, 
      headers, 
      body: '' 
    };
  }

  // Only allow GET requests
  if (event.httpMethod !== 'GET') {
    console.log('Method not allowed:', event.httpMethod);
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed. Only GET requests are supported.' })
    };
  }

  try {
    // Get API key from environment variable
    const API_KEY = process.env.TMDB_API_KEY;
    
    if (!API_KEY) {
      console.error('TMDB_API_KEY environment variable is not set');
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({ 
          error: 'Server configuration error',
          message: 'API key not configured'
        })
      };
    }

    console.log('API key found, length:', API_KEY.length);

    // Extract query parameters
    const { endpoint, query, page = '1', genre } = event.queryStringParameters || {};

    if (!endpoint) {
      console.log('Missing endpoint parameter');
      return {
        statusCode: 400,
        headers,
        body: JSON.stringify({ 
          error: 'Missing required parameter',
          message: 'endpoint parameter is required'
        })
      };
    }

    console.log('Processing request for endpoint:', endpoint);

    // Rate limiting - log IP for monitoring
    const userIP = event.headers['client-ip'] || 
                   event.headers['x-forwarded-for'] || 
                   event.headers['x-real-ip'] || 
                   'unknown';
    
    console.log(`Request from IP: ${userIP} for endpoint: ${endpoint}`);

    // Build the TMDB API URL
    let tmdbUrl = `https://api.themoviedb.org/3/${endpoint}?api_key=${API_KEY}`;
    
    // Add optional parameters
    if (query) {
      tmdbUrl += `&amp;query=${encodeURIComponent(query)}`;
      console.log('Added query parameter:', query);
    }
    
    if (page &amp;&amp; page !== '1') {
      tmdbUrl += `&amp;page=${encodeURIComponent(page)}`;
      console.log('Added page parameter:', page);
    }
    
    if (genre) {
      tmdbUrl += `&amp;with_genres=${encodeURIComponent(genre)}`;
      console.log('Added genre parameter:', genre);
    }

    // Log the URL (without API key for security)
    const logUrl = tmdbUrl.replace(API_KEY, '[REDACTED]');
    console.log('Making request to TMDB:', logUrl);

    // Make the request to TMDB API
    const response = await fetch(tmdbUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'User-Agent': 'TV-Movie-Tracker/1.0'
      },</code></pre></div><div class="py-4"><p class="text-gray-600">www\netlify\functions\tmdb.js (Line 301:5 - Line 357:2), www\netlify\functions\tmdb.js (Line 123:5 - Line 179:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn5" onclick="toggleCodeBlock('cloneGroup5', 'expandBtn5', 'collapseBtn5')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup5"><code class="language-javascript text-sm text-gray-800">});

    console.log('TMDB response status:', response.status, response.statusText);

    if (!response.ok) {
      const errorText = await response.text();
      console.error('TMDB API error:', response.status, errorText);
      
      return {
        statusCode: response.status &gt;= 500 ? 502 : response.status,
        headers,
        body: JSON.stringify({ 
          error: 'External API error',
          message: `TMDB API returned ${response.status}: ${response.statusText}`,
          details: response.status === 401 ? 'Invalid API key' : 'Service temporarily unavailable'
        })
      };
    }

    // Parse the JSON response
    const data = await response.json();
    console.log('Successfully fetched data, results count:', data.results ? data.results.length : 'N/A');

    // Return successful response
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify(data)
    };

  } catch (error) {
    console.error('Function error:', error.name, error.message);
    console.error('Stack trace:', error.stack);
    
    // Handle different types of errors
    let errorMessage = 'Internal server error';
    let statusCode = 500;
    
    if (error.name === 'TypeError' &amp;&amp; error.message.includes('fetch')) {
      errorMessage = 'Network error connecting to TMDB API';
      statusCode = 502;
    } else if (error.name === 'AbortError' || error.message.includes('timeout')) {
      errorMessage = 'Request timeout - TMDB API is slow';
      statusCode = 504;
    }
    
    return {
      statusCode: statusCode,
      headers,
      body: JSON.stringify({ 
        error: errorMessage,
        message: process.env.NODE_ENV === 'development' ? error.message : 'Something went wrong',
        timestamp: new Date().toISOString()
      })
    };
  }
};</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 16:1 - Line 25:3), www\tools\simple-audit.mjs (Line 21:2 - Line 30:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn6" onclick="toggleCodeBlock('cloneGroup6', 'expandBtn6', 'collapseBtn6')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup6"><code class="language-javascript text-sm text-gray-800">function ensureDirectories() {
  const dirs = [
    path.join(reportsDir, 'lighthouse'),
    path.join(reportsDir, 'axe'),
    path.join(reportsDir, 'jscpd'),
    path.join(reportsDir, 'bundle')
  ];
  
  for (const dir of dirs) {
    if</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 37:12 - Line 46:8), www\tools\simple-audit.mjs (Line 40:8 - Line 49:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn7" onclick="toggleCodeBlock('cloneGroup7', 'expandBtn7', 'collapseBtn7')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup7"><code class="language-javascript text-sm text-gray-800">(currentDir, { withFileTypes: true });
      
      for (const entry of entries) {
        const fullPath = path.join(currentDir, entry.name);
        
        if (entry.isDirectory()) {
          // Skip excluded directories
          const skipDirs = ['node_modules', 'dist', 'build', 'out', '.next', '.cache', 'coverage'];
          if (!skipDirs.some(skip =&gt; entry.name.includes(skip))) {
            scanDir</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 85:9 - Line 103:3), www\tools\simple-audit.mjs (Line 88:5 - Line 106:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn8" onclick="toggleCodeBlock('cloneGroup8', 'expandBtn8', 'collapseBtn8')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup8"><code class="language-javascript text-sm text-gray-800">(file);
        cssTotalMB += stats.size / (1024 * 1024);
      } catch (error) {
        // Skip files that can't be read
      }
    }
    
    // Create bundle report
    const bundleReport = {
      jsFiles: jsFiles.length,
      cssFiles: cssFiles.length,
      jsTotalMB: Math.round(jsTotalMB * 100) / 100,
      cssTotalMB: Math.round(cssTotalMB * 100) / 100,
      totalMB: Math.round((jsTotalMB + cssTotalMB) * 100) / 100,
      jsFilesList: jsFiles.map(f =&gt; path.relative(wwwDir, f)),
      cssFilesList: cssFiles.map(f =&gt; path.relative(wwwDir, f))
    };
    
    fs</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 103:14 - Line 117:9), www\tools\simple-audit.mjs (Line 106:10 - Line 120:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn9" onclick="toggleCodeBlock('cloneGroup9', 'expandBtn9', 'collapseBtn9')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup9"><code class="language-javascript text-sm text-gray-800">(
      path.join(reportsDir, 'bundle', 'bundle.json'),
      JSON.stringify(bundleReport, null, 2)
    );
    
    console.log('✅ Bundle analysis complete');
    return { jsTotalMB, cssTotalMB };
  } catch (error) {
    console.error('❌ Bundle analysis failed:', error.message);
    return { jsTotalMB: 0, cssTotalMB: 0 };
  }
}

// Run basic security scan
function</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 117:1 - Line 136:10), www\tools\simple-audit.mjs (Line 120:2 - Line 139:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn10" onclick="toggleCodeBlock('cloneGroup10', 'expandBtn10', 'collapseBtn10')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup10"><code class="language-javascript text-sm text-gray-800">function runSecurityScan() {
  console.log('🔒 Running security scan...');
  
  try {
    const securityPatterns = [
      'innerHTML',
      'insertAdjacentHTML',
      'dangerouslySetInnerHTML',
      'eval\\(',
      'new Function\\(',
      'javascript:',
      'onerror=',
      'onload='
    ];
    
    let totalMatches = 0;
    const results = [];
    
    // Find all JS and HTML files
    const jsFiles = findFiles</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 142:13 - Line 157:3), www\tools\simple-audit.mjs (Line 145:9 - Line 160:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn11" onclick="toggleCodeBlock('cloneGroup11', 'expandBtn11', 'collapseBtn11')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup11"><code class="language-javascript text-sm text-gray-800">(file, 'utf8');
        
        for (const pattern of securityPatterns) {
          const regex = new RegExp(pattern, 'gi');
          const matches = content.match(regex);
          if (matches) {
            totalMatches += matches.length;
            results.push(`${file}:${pattern} (${matches.length} matches)`);
          }
        }
      } catch (error) {
        // Skip files that can't be read
      }
    }
    
    fs</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 157:14 - Line 168:9), www\tools\simple-audit.mjs (Line 160:10 - Line 171:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn12" onclick="toggleCodeBlock('cloneGroup12', 'expandBtn12', 'collapseBtn12')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup12"><code class="language-javascript text-sm text-gray-800">(path.join(reportsDir, 'security-scan.txt'), results.join('\n'));
    console.log('✅ Security scan complete');
    
    return totalMatches;
  } catch (error) {
    console.error('❌ Security scan failed:', error.message);
    return 0;
  }
}

// Generate summary report
function</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\run-audit.js (Line 168:1 - Line 189:9), www\tools\simple-audit.mjs (Line 171:2 - Line 192:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn13" onclick="toggleCodeBlock('cloneGroup13', 'expandBtn13', 'collapseBtn13')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup13"><code class="language-javascript text-sm text-gray-800">function generateSummary(bundleData, securityMatches) {
  console.log('\n' + '='.repeat(80));
  console.log('📊 BASELINE AUDIT SUMMARY');
  console.log('='.repeat(80));
  
  // Bundle analysis
  console.log(`\n📦 BUNDLE ANALYSIS:`);
  console.log(`   JavaScript: ${bundleData.jsTotalMB} MB`);
  console.log(`   CSS: ${bundleData.cssTotalMB} MB`);
  console.log(`   Total: ${(bundleData.jsTotalMB + bundleData.cssTotalMB).toFixed(2)} MB`);
  
  // Security scan
  console.log(`\n🔒 SECURITY SCAN:`);
  console.log(`   Potential Issues: ${securityMatches} matches`);
  
  console.log('\n' + '='.repeat(80));
  console.log('✅ Baseline audit complete! Reports generated in /reports/');
  console.log('='.repeat(80));
}

// Main execution
function</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 43:2 - Line 71:29), www\tools\console-summary.js (Line 37:2 - Line 65:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn14" onclick="toggleCodeBlock('cloneGroup14', 'expandBtn14', 'collapseBtn14')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup14"><code class="language-javascript text-sm text-gray-800">readJSON(path.join(reportsDir, 'lighthouse', 'desktop.json'));
    if (desktopLighthouse &amp;&amp; desktopLighthouse.categories) {
      console.log(`   Performance: ${Math.round(desktopLighthouse.categories.performance.score * 100)}`);
      console.log(`   Accessibility: ${Math.round(desktopLighthouse.categories.accessibility.score * 100)}`);
      console.log(`   Best Practices: ${Math.round(desktopLighthouse.categories['best-practices'].score * 100)}`);
      console.log(`   SEO: ${Math.round(desktopLighthouse.categories.seo.score * 100)}`);
      
      // Key metrics
      const audits = desktopLighthouse.audits;
      if (audits['first-contentful-paint']) {
        console.log(`   First Contentful Paint: ${Math.round(audits['first-contentful-paint'].numericValue)}ms`);
      }
      if (audits['largest-contentful-paint']) {
        console.log(`   Largest Contentful Paint: ${Math.round(audits['largest-contentful-paint'].numericValue)}ms`);
      }
      if (audits['cumulative-layout-shift']) {
        console.log(`   Cumulative Layout Shift: ${audits['cumulative-layout-shift'].numericValue}`);
      }
      if (audits['total-blocking-time']) {
        console.log(`   Total Blocking Time: ${Math.round(audits['total-blocking-time'].numericValue)}ms`);
      }
    } else {
      console.log('   ❌ Desktop Lighthouse results not available');
    }
  } catch (error) {
    console.log('   ❌ Desktop Lighthouse results not available');
  }
  
  // Lighthouse Mobile Results</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 82:17 - Line 92:2), www\tools\console-summary.js (Line 45:18 - Line 55:3)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn15" onclick="toggleCodeBlock('cloneGroup15', 'expandBtn15', 'collapseBtn15')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup15"><code class="language-javascript text-sm text-gray-800">.audits;
      if (audits['first-contentful-paint']) {
        console.log(`   First Contentful Paint: ${Math.round(audits['first-contentful-paint'].numericValue)}ms`);
      }
      if (audits['largest-contentful-paint']) {
        console.log(`   Largest Contentful Paint: ${Math.round(audits['largest-contentful-paint'].numericValue)}ms`);
      }
      if (audits['cumulative-layout-shift']) {
        console.log(`   Cumulative Layout Shift: ${audits['cumulative-layout-shift'].numericValue}`);
      }
    }</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 102:2 - Line 126:6), www\tools\console-summary.js (Line 68:2 - Line 92:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn16" onclick="toggleCodeBlock('cloneGroup16', 'expandBtn16', 'collapseBtn16')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup16"><code class="language-javascript text-sm text-gray-800">readJSON(path.join(reportsDir, 'axe', 'axe.json'));
    if (axeResults &amp;&amp; Array.isArray(axeResults) &amp;&amp; axeResults.length &gt; 0) {
      const result = axeResults[0];
      const violations = result.violations || [];
      const serious = violations.filter(v =&gt; v.impact === 'serious').length;
      const critical = violations.filter(v =&gt; v.impact === 'critical').length;
      const moderate = violations.filter(v =&gt; v.impact === 'moderate').length;
      const minor = violations.filter(v =&gt; v.impact === 'minor').length;
      
      console.log(`   Total Violations: ${violations.length}`);
      console.log(`   Critical: ${critical}`);
      console.log(`   Serious: ${serious}`);
      console.log(`   Moderate: ${moderate}`);
      console.log(`   Minor: ${minor}`);
    } else {
      console.log('   ✅ No accessibility violations found');
    }
  } catch (error) {
    console.log('   ❌ Axe results not available');
  }
  
  // Bundle Analysis
  console.log('\n📦 BUNDLE ANALYSIS:');
  try {
    const bundleData = await</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 126:2 - Line 143:6), www\tools\console-summary.js (Line 92:2 - Line 109:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn17" onclick="toggleCodeBlock('cloneGroup17', 'expandBtn17', 'collapseBtn17')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup17"><code class="language-javascript text-sm text-gray-800">readJSON(path.join(reportsDir, 'bundle', 'bundle.json'));
    if (bundleData) {
      console.log(`   JavaScript Files: ${bundleData.jsFiles}`);
      console.log(`   CSS Files: ${bundleData.cssFiles}`);
      console.log(`   JavaScript Size: ${bundleData.jsTotalMB} MB`);
      console.log(`   CSS Size: ${bundleData.cssTotalMB} MB`);
      console.log(`   Total Bundle Size: ${bundleData.totalMB} MB`);
    } else {
      console.log('   ❌ Bundle analysis not available');
    }
  } catch (error) {
    console.log('   ❌ Bundle analysis not available');
  }
  
  // Duplication Analysis
  console.log('\n🔄 DUPLICATION ANALYSIS:');
  try {
    const jscpdData = await</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 143:2 - Line 161:6), www\tools\console-summary.js (Line 109:2 - Line 127:9)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn18" onclick="toggleCodeBlock('cloneGroup18', 'expandBtn18', 'collapseBtn18')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup18"><code class="language-javascript text-sm text-gray-800">readJSON(path.join(reportsDir, 'jscpd', 'jscpd-report.json'));
    if (jscpdData &amp;&amp; jscpdData.statistics &amp;&amp; jscpdData.statistics.total) {
      const total = jscpdData.statistics.total;
      const duplicationPercentage = Math.round((total.duplicatedLines / total.lines) * 100);
      console.log(`   Total Lines: ${total.lines.toLocaleString()}`);
      console.log(`   Duplicated Lines: ${total.duplicatedLines.toLocaleString()}`);
      console.log(`   Duplication Percentage: ${duplicationPercentage}%`);
      console.log(`   Clones Found: ${total.clones.toLocaleString()}`);
    } else {
      console.log('   ❌ Duplication analysis not available');
    }
  } catch (error) {
    console.log('   ❌ Duplication analysis not available');
  }
  
  // Dependency Analysis
  console.log('\n📋 DEPENDENCY ANALYSIS:');
  try {
    const depcheckData = await</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 161:2 - Line 171:3), www\tools\console-summary.js (Line 127:2 - Line 136:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn19" onclick="toggleCodeBlock('cloneGroup19', 'expandBtn19', 'collapseBtn19')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup19"><code class="language-javascript text-sm text-gray-800">readJSON(path.join(reportsDir, 'depcheck.json'));
    if (depcheckData) {
      const unusedDeps = Object.keys(depcheckData.dependencies || {}).length;
      const unusedDevDeps = Object.keys(depcheckData.devDependencies || {}).length;
      const missing = Object.keys(depcheckData.missing || {}).length;
      
      console.log(`   Unused Dependencies: ${unusedDeps}`);
      console.log(`   Unused Dev Dependencies: ${unusedDevDeps}`);
      console.log(`   Missing Dependencies: ${missing}`);
      
      if</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 210:2 - Line 215:3), www\tools\console-summary.js (Line 146:2 - Line 150:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn20" onclick="toggleCodeBlock('cloneGroup20', 'expandBtn20', 'collapseBtn20')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup20"><code class="language-javascript text-sm text-gray-800">readText(path.join(reportsDir, 'security-scan.txt'));
    if (securityOutput) {
      const lines = securityOutput.split('\n').filter(line =&gt; line.trim());
      console.log(`   Potential Security Issues: ${lines.length}`);
      
      if</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-summary.mjs (Line 224:5 - Line 233:2), www\tools\console-summary.js (Line 150:3 - Line 159:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn21" onclick="toggleCodeBlock('cloneGroup21', 'expandBtn21', 'collapseBtn21')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup21"><code class="language-javascript text-sm text-gray-800">} else {
      console.log('   ✅ No security issues found');
    }
  } catch (error) {
    console.log('   ❌ Security scan not available');
  }
  
  console.log('\n' + '='.repeat(80));
  console.log('✅ Baseline audit summary complete!');
  console.log('='.repeat(80));</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-audit.mjs (Line 18:2 - Line 38:24), www\tools\simple-audit.mjs (Line 13:6 - Line 34:26)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn22" onclick="toggleCodeBlock('cloneGroup22', 'expandBtn22', 'collapseBtn22')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup22"><code class="language-javascript text-sm text-gray-800">;
const __dirname = path.dirname(fileURLToPath(import.meta.url));
const projectRoot = path.resolve(__dirname, '..');
const wwwDir = path.join(projectRoot, 'www');
const reportsDir = path.join(projectRoot, 'reports');

// Ensure reports directories exist
async function ensureDirectories() {
  const dirs = [
    path.join(reportsDir, 'lighthouse'),
    path.join(reportsDir, 'axe'),
    path.join(reportsDir, 'jscpd'),
    path.join(reportsDir, 'bundle')
  ];
  
  for (const dir of dirs) {
    await fs.mkdir(dir, { recursive: true });
  }
}

// Run Lighthouse audit</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-audit.mjs (Line 115:7 - Line 121:2), www\tools\simple-audit.mjs (Line 96:5 - Line 101:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn23" onclick="toggleCodeBlock('cloneGroup23', 'expandBtn23', 'collapseBtn23')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup23"><code class="language-javascript text-sm text-gray-800">const bundleReport = {
        jsFiles: jsFiles.length,
        cssFiles: cssFiles.length,
        jsTotalMB: Math.round(jsTotalMB * 100) / 100,
        cssTotalMB: Math.round(cssTotalMB * 100) / 100,
        totalMB: Math.round((jsTotalMB + cssTotalMB) * 100) / 100
      }</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-audit.mjs (Line 300:7 - Line 313:2), www\tools\simple-audit.mjs (Line 157:7 - Line 170:27)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn24" onclick="toggleCodeBlock('cloneGroup24', 'expandBtn24', 'collapseBtn24')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup24"><code class="language-javascript text-sm text-gray-800">}
    }
    
    await fs.writeFile(path.join(reportsDir, 'security-scan.txt'), results.join('\n'));
    console.log('✅ Security scan complete');
    
    return totalMatches;
  } catch (error) {
    console.error('❌ Security scan failed:', error.message);
    return 0;
  }
}

/</code></pre></div><div class="py-4"><p class="text-gray-600">www\tools\baseline-audit.mjs (Line 325:9 - Line 335:6), www\tools\simple-audit.mjs (Line 47:11 - Line 55:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn25" onclick="toggleCodeBlock('cloneGroup25', 'expandBtn25', 'collapseBtn25')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup25"><code class="language-javascript text-sm text-gray-800">const skipDirs = ['node_modules', 'dist', 'build', 'out', '.next', '.cache', 'coverage'];
        if (!skipDirs.some(skip =&gt; entry.name.includes(skip))) {
          await scanDir(fullPath);
        }
      } else if (entry.name.endsWith(extension)) {
        files.push(fullPath);
      }
    }
  }
  
  await</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\quotes-enhanced.js (Line 261:2 - Line 277:25), www\scripts\quotes-enhanced.js (Line 215:2 - Line 231:31)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn29" onclick="toggleCodeBlock('cloneGroup29', 'expandBtn29', 'collapseBtn29')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup29"><code class="language-javascript text-sm text-gray-800">next || ENHANCED_QUOTES[0];
    
    // Save remaining deck
    try {
      if (deck.length &gt; 0) {
        localStorage.setItem('flicklet:quote:deck', JSON.stringify(deck));
      } else {
        localStorage.removeItem('flicklet:quote:deck');
      }
    } catch (error) {
      console.warn('💬 Failed to save quote deck:', error);
    }
    
    return quote;
  }
  
  // Quote rotation system</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 268:11 - Line 276:11), www\scripts\inline-script-03.js (Line 253:11 - Line 261:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn30" onclick="toggleCodeBlock('cloneGroup30', 'expandBtn30', 'collapseBtn30')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup30"><code class="language-javascript text-sm text-gray-800">const card = btn.closest('.show-card');
          if (card) {
            const moreBtn = card.querySelector('.card-more-btn');
            const moreDropdown = card.querySelector('.card-more-dropdown');
            if (moreBtn &amp;&amp; moreDropdown) {
              moreBtn.setAttribute('aria-expanded', 'false');
              moreDropdown.setAttribute('aria-hidden', 'true');
            }
            const extrasSlot</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 283:11 - Line 291:11), www\scripts\inline-script-03.js (Line 253:11 - Line 261:14)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn31" onclick="toggleCodeBlock('cloneGroup31', 'expandBtn31', 'collapseBtn31')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup31"><code class="language-javascript text-sm text-gray-800">const card = btn.closest('.show-card');
          if (card) {
            const moreBtn = card.querySelector('.card-more-btn');
            const moreDropdown = card.querySelector('.card-more-dropdown');
            if (moreBtn &amp;&amp; moreDropdown) {
              moreBtn.setAttribute('aria-expanded', 'false');
              moreDropdown.setAttribute('aria-hidden', 'true');
            }
            const triviaSlot</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 340:2 - Line 395:74), www\split_exact\scripts\inline-script-03.js (Line 18:2 - Line 73:78)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn32" onclick="toggleCodeBlock('cloneGroup32', 'expandBtn32', 'collapseBtn32')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup32"><code class="language-javascript text-sm text-gray-800">();
        
        // 3. Load genres
        loadGenres?.();
        
        // 4. Restore theme from localStorage
        const savedTheme = localStorage.getItem(&quot;flicklet-theme&quot;);
        if (savedTheme === &quot;dark&quot;) {
          document.body.classList.add(&quot;dark-mode&quot;);
        }
        
        // 5. Ensure language dropdown is properly initialized
        const ensureLanguageDropdown = () =&gt; {
          const langToggle = document.getElementById(&quot;langToggle&quot;);
          if (langToggle &amp;&amp; langToggle.children.length &lt; 2) {
            langToggle.innerHTML = `
              &lt;option value=&quot;en&quot;&gt;EN&lt;/option&gt;
              &lt;option value=&quot;es&quot;&gt;ES&lt;/option&gt;
            `;
            // Set the current language
            if (appData?.settings?.lang) {
              langToggle.value = appData.settings.lang;
            }
          }
        };
        
        // Call it immediately and also after a delay to catch any late modifications
        ensureLanguageDropdown();
        setTimeout(ensureLanguageDropdown, 100);
        
        // 6. Show home tab by default
        switchToTab(&quot;home&quot;);
        
        // 7. Update UI (which will call ensureBlocks)
        updateUI?.();
        
        // 8. Check upcoming episodes
        checkUpcomingEpisodes?.();
        
        // 9. Apply translations to the initial tab content
        setTimeout(() =&gt; {
          if (typeof applyTranslations === &quot;function&quot;) {
            applyTranslations();
          }
        }, 200);
        
        // 10. Request notification permissions
        requestNotificationPermission?.();
        
        // 11. Initialize file label
        const importFileInput = document.getElementById(&quot;importFile&quot;);
        if (importFileInput) {
          updateFileLabel(importFileInput);
        }
        
        // 12. Account button is now handled by FlickletApp.updateAccountButton()</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 429:9 - Line 457:8), www\split_exact\scripts\inline-script-03.js (Line 165:9 - Line 193:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn33" onclick="toggleCodeBlock('cloneGroup33', 'expandBtn33', 'collapseBtn33')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup33"><code class="language-javascript text-sm text-gray-800">// --- mardi toggle
        const root = document.getElementById(&quot;appRoot&quot;);
        bind(&quot;mardiToggle&quot;, () =&gt; root &amp;&amp; root.classList.toggle(&quot;mardi&quot;));
        bind(&quot;mardiOnBtn&quot;, () =&gt; root &amp;&amp; root.classList.toggle(&quot;mardi&quot;));

        // --- language switch (will be set up after data loads)

        // --- Name prompt moved to post-authentication flow for security best practices
        // No more name prompt on app boot - this was causing the name persistence issue

        // --- Account / Auth entry point (modal) - handled by FlickletApp.setupEventListeners()

        // --- Save name button
        bind(&quot;saveNameBtn&quot;, () =&gt; {
          const val = (document.getElementById(&quot;displayNameInput&quot;)?.value || &quot;&quot;).trim();
          if (!val) return showNotification?.(t(&quot;enter_name_first&quot;), &quot;warning&quot;);
          if (appData?.settings) {
            appData.settings.displayName = val;
            saveAppData?.();
            // updateWelcomeText?.(); // DISABLED - conflicts with dynamic header system
            showNotification?.(t(&quot;name_saved&quot;), &quot;success&quot;);
          }
        });
        


        // --- feedback handled by Netlify Forms
        function handleFeedbackSubmit(event) {
          console</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 464:11 - Line 474:47), www\split_exact\scripts\inline-script-03.js (Line 195:9 - Line 205:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn34" onclick="toggleCodeBlock('cloneGroup34', 'expandBtn34', 'collapseBtn34')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup34"><code class="language-javascript text-sm text-gray-800">// Store current theme before form submission
          const currentTheme = document.body.classList.contains(&quot;dark-mode&quot;) ? &quot;dark&quot; : &quot;light&quot;;
          const themeInput = document.getElementById(&quot;feedbackThemeInput&quot;);
          if (themeInput) {
            themeInput.value = currentTheme;
          }
          
          // Store theme in localStorage as backup
          localStorage.setItem(&quot;flicklet-theme&quot;, currentTheme);
          
          // For local development, show success message</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 529:9 - Line 544:67), www\split_exact\scripts\inline-script-03.js (Line 250:9 - Line 265:6)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn35" onclick="toggleCodeBlock('cloneGroup35', 'expandBtn35', 'collapseBtn35')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup35"><code class="language-javascript text-sm text-gray-800">// --- search controls (REMOVED - duplicate code that was breaking search functionality)

        // --- backup / import / clear / share
        bind(&quot;exportBtn&quot;, () =&gt; {
          const blob = new Blob([JSON.stringify(appData, null, 2)], {
            type: &quot;application/json&quot;,
          });
          const a = document.createElement(&quot;a&quot;);
          a.href = URL.createObjectURL(blob);
          a.download = &quot;flicklet-backup.json&quot;;
          document.body.appendChild(a);
          a.click();
          a.remove();
        });

        // Import handler moved to functions.js with robust implementation</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\inline-script-03.js (Line 549:9 - Line 606:2), www\split_exact\scripts\inline-script-03.js (Line 297:9 - Line 354:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn36" onclick="toggleCodeBlock('cloneGroup36', 'expandBtn36', 'collapseBtn36')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup36"><code class="language-javascript text-sm text-gray-800">// Share button bindings moved to runGlobalInitialization

        // --- notification toggles
        const ep = document.getElementById(&quot;notifEpisodes&quot;);
        const dp = document.getElementById(&quot;notifDiscover&quot;);
        const md = document.getElementById(&quot;notifDigest&quot;);
        if (ep)
          ep.addEventListener(&quot;change&quot;, (e) =&gt; {
            if (appData?.settings?.notif) {
              appData.settings.notif.episodes = !!e.target.checked;
              saveAppData?.();
            }
          });
        if (dp)
          dp.addEventListener(&quot;change&quot;, (e) =&gt; {
            if (appData?.settings?.notif) {
              appData.settings.notif.discover = !!e.target.checked;
              saveAppData?.();
            }
          });
        if (md)
          md.addEventListener(&quot;change&quot;, (e) =&gt; {
            if (appData?.settings?.notif) {
              appData.settings.notif.digest = !!e.target.checked;
              saveAppData?.();
            }
          });

        // --- pro toggle
        const proToggle = document.getElementById(&quot;proToggle&quot;);
        if (proToggle) {
          proToggle.checked = !!appData?.settings?.pro;
          proToggle.addEventListener(&quot;change&quot;, (e) =&gt; {
            if (appData?.settings) {
              appData.settings.pro = !!e.target.checked;
              saveAppData?.();
              rebuildStats?.();
              
              // Show/hide Pro features explanation
              const proFeatures = document.getElementById(&quot;proFeatures&quot;);
              if (proFeatures) {
                proFeatures.style.display = e.target.checked ? &quot;block&quot; : &quot;none&quot;;
              }
            }
          });
          
          // Show Pro features if already enabled
          const proFeatures = document.getElementById(&quot;proFeatures&quot;);
          if (proFeatures &amp;&amp; proToggle.checked) {
            proFeatures.style.display = &quot;block&quot;;
          }
        }

        console.debug(&quot;[Flicklet] Boot OK&quot;);

        // FlickletApp.init() already called at the beginning if available

      });</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\home.js (Line 250:2 - Line 273:2), www\scripts\theaters-near-me.js (Line 185:7 - Line 209:29)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn37" onclick="toggleCodeBlock('cloneGroup37', 'expandBtn37', 'collapseBtn37')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup37"><code class="language-javascript text-sm text-gray-800">);
        } catch (error) {
          console.error('Failed to refresh theaters:', error);
        }
      });
    }

    // Find showtimes button
    const showtimesBtn = document.getElementById('findShowtimesBtn');
    if (showtimesBtn) {
      showtimesBtn.addEventListener('click', () =&gt; {
        // Open Fandango in new tab
        window.open('https://www.fandango.com/', '_blank');
      });
    }

    // Update location button
    const locationBtn = document.getElementById('refreshLocationBtn');
    if (locationBtn) {
      locationBtn.addEventListener('click', () =&gt; {
        updateUserLocation();
      });
    }
  }</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\home.js (Line 327:2 - Line 342:52), www\scripts\theaters-near-me.js (Line 133:2 - Line 148:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn38" onclick="toggleCodeBlock('cloneGroup38', 'expandBtn38', 'collapseBtn38')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup38"><code class="language-javascript text-sm text-gray-800">{
      const theatersList = document.getElementById('theatersList');
      const movieCount = document.getElementById('movieCount');
      
      if (!theatersList) {
        console.warn('🎬 Theaters list not found');
        return;
      }

      if (!movies || movies.length === 0) {
        theatersList.innerHTML = '&lt;div class=&quot;no-movies&quot;&gt;&lt;p&gt;Unable to load current movies. Please try again later.&lt;/p&gt;&lt;/div&gt;';
        if (movieCount) movieCount.textContent = '0 Movies';
        return;
      }

      // Render movies with error handling for each movie</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\home.js (Line 394:3 - Line 420:26), www\scripts\theaters-near-me.js (Line 211:3 - Line 238:19)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn39" onclick="toggleCodeBlock('cloneGroup39', 'expandBtn39', 'collapseBtn39')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup39"><code class="language-javascript text-sm text-gray-800">}

  function updateUserLocation() {
    const locationEl = document.getElementById('userLocation');
    if (!locationEl) return;

    locationEl.textContent = '📍 Getting your location...';

    if (!navigator.geolocation) {
      locationEl.textContent = '📍 Location not supported';
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) =&gt; {
        const { latitude, longitude } = position.coords;
        // You could reverse geocode here to get city name
        locationEl.textContent = `📍 ${latitude.toFixed(2)}, ${longitude.toFixed(2)}`;
      },
      (error) =&gt; {
        console.warn('Location error:', error);
        locationEl.textContent = '📍 Location unavailable';
      }
    );
  }

  function getFallbackTheaterContent</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\home.js (Line 420:26 - Line 440:55), www\scripts\theaters-near-me.js (Line 238:19 - Line 258:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn40" onclick="toggleCodeBlock('cloneGroup40', 'expandBtn40', 'collapseBtn40')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup40"><code class="language-javascript text-sm text-gray-800">() {
    return [
      {
        title: &quot;Sample Movie&quot;,
        overview: &quot;This is a sample movie description for when the API is unavailable.&quot;,
        vote_average: 7.5,
        release_date: new Date().toISOString().split('T')[0],
        poster_path: null
      }
    ];
  }

  // Utility function to escape HTML
  function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  // Feedback link is now handled by inline-script-02.js</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\export-csv.js (Line 108:3 - Line 118:7), www\scripts\export-csv.js (Line 84:2 - Line 94:17)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn41" onclick="toggleCodeBlock('cloneGroup41', 'expandBtn41', 'collapseBtn41')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup41"><code class="language-javascript text-sm text-gray-800">,
          added_date: item.added_date || '',
          user_rating: item.user_rating || '',
          like_status: item.like_status || '',
          notes: item.notes || '',
          tags: (item.tags || []).join('; ')
        });
      });
    });
    
    return</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\export-csv.js (Line 228:2 - Line 234:2), www\scripts\export-csv.js (Line 108:2 - Line 90:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn42" onclick="toggleCodeBlock('cloneGroup42', 'expandBtn42', 'collapseBtn42')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup42"><code class="language-javascript text-sm text-gray-800">|| '',
      added_date: item.added_date || '',
      user_rating: item.user_rating || '',
      like_status: item.like_status || '',
      notes: item.notes || '',
      tags: (item.tags || []).join('; ')
    }))</code></pre></div><div class="py-4"><p class="text-gray-600">www\scripts\curated-lists.js (Line 99:5 - Line 105:6), www\scripts\curated-rows.js (Line 109:3 - Line 115:41)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn43" onclick="toggleCodeBlock('cloneGroup43', 'expandBtn43', 'collapseBtn43')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup43"><code class="language-javascript text-sm text-gray-800">const TMDB_IMG = (p, size='w342') =&gt; {
      if (!p) return '';
      const s = String(p);
      return s.startsWith('http') ? s : `https://image.tmdb.org/t/p/${size}${s.startsWith('/')?'':'/'}${s}`;
    };
    
    const</code></pre></div><div class="py-4"><p class="text-gray-600">www\js\utils.js (Line 7:5 - Line 24:2), www\scripts\card-actions.js (Line 27:2 - Line 31:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn44" onclick="toggleCodeBlock('cloneGroup44', 'expandBtn44', 'collapseBtn44')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup44"><code class="language-javascript text-sm text-gray-800">lang: 'en',
    theme: 'light',
    pro: false,
    notif: {}
  },
  tv: {
    watching: [],
    wishlist: [],
    watched: []
  },
  movies: {
    watching: [],
    wishlist: [],
    watched: []
  },
  searchCache: [],
  activeTagFilters: new Set()
}</code></pre></div><div class="py-4"><p class="text-gray-600">www\functions\tmdb.js (Line 1:1 - Line 357:2), www\netlify\functions\tmdb.js (Line 1:1 - Line 179:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn45" onclick="toggleCodeBlock('cloneGroup45', 'expandBtn45', 'collapseBtn45')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup45"><code class="language-javascript text-sm text-gray-800">// netlify/functions/tmdb.js
exports.handler = async (event, context) =&gt; {
  console.log('Function called with:', event.httpMethod, event.queryStringParameters);
  
  // Domain restrictions - allow your actual domain and localhost
  const allowedOrigins = [
    'https://flicklet.netlify.app', // Your actual domain
    'https://zippy-meerkat-329c02.netlify.app', // Old domain (temporary)
    'http://localhost:3000',
    'http://127.0.0.1:3000',
    'http://localhost:8000',
    'http://127.0.0.1:8000',
    'http://localhost:8888', // Netlify dev
    'http://127.0.0.1:8888'
  ];
  
  const origin = event.headers.origin || event.headers.referer || '';
  const isAllowedOrigin = allowedOrigins.some(allowed =&gt; 
    origin.startsWith(allowed)
  ) || !origin; // Allow if no origin (direct access)
  
  const headers = {
    'Access-Control-Allow-Origin': isAllowedOrigin ? (origin || '*') : '*',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'GET, OPTIONS',
    'Content-Type': 'application/json',
    'Cache-Control': 'public, max-age=300' // 5 minute cache
  };

  // Handle preflight CORS requests
  if (event.httpMethod === 'OPTIONS') {
    console.log('Handling OPTIONS request');
    return { 
      statusCode: 200, 
      headers, 
      body: '' 
    };
  }

  // Only allow GET requests
  if (event.httpMethod !== 'GET') {
    console.log('Method not allowed:', event.httpMethod);
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed. Only GET requests are supported.' })
    };
  }

  try {
    // Get API key from environment variable
    const API_KEY = process.env.TMDB_API_KEY;
    
    if (!API_KEY) {
      console.error('TMDB_API_KEY environment variable is not set');
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({ 
          error: 'Server configuration error',
          message: 'API key not configured'
        })
      };
    }

    console.log('API key found, length:', API_KEY.length);

    // Extract query parameters
    const { endpoint, query, page = '1', genre } = event.queryStringParameters || {};

    if (!endpoint) {
      console.log('Missing endpoint parameter');
      return {
        statusCode: 400,
        headers,
        body: JSON.stringify({ 
          error: 'Missing required parameter',
          message: 'endpoint parameter is required'
        })
      };
    }

    console.log('Processing request for endpoint:', endpoint);

    // Rate limiting - log IP for monitoring
    const userIP = event.headers['client-ip'] || 
                   event.headers['x-forwarded-for'] || 
                   event.headers['x-real-ip'] || 
                   'unknown';
    
    console.log(`Request from IP: ${userIP} for endpoint: ${endpoint}`);

    // Build the TMDB API URL
    let tmdbUrl = `https://api.themoviedb.org/3/${endpoint}?api_key=${API_KEY}`;
    
    // Add optional parameters
    if (query) {
      tmdbUrl += `&amp;query=${encodeURIComponent(query)}`;
      console.log('Added query parameter:', query);
    }
    
    if (page &amp;&amp; page !== '1') {
      tmdbUrl += `&amp;page=${encodeURIComponent(page)}`;
      console.log('Added page parameter:', page);
    }
    
    if (genre) {
      tmdbUrl += `&amp;with_genres=${encodeURIComponent(genre)}`;
      console.log('Added genre parameter:', genre);
    }

    // Log the URL (without API key for security)
    const logUrl = tmdbUrl.replace(API_KEY, '[REDACTED]');
    console.log('Making request to TMDB:', logUrl);

    // Make the request to TMDB API
    const response = await fetch(tmdbUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'User-Agent': 'TV-Movie-Tracker/1.0'
      }
    });

    console.log('TMDB response status:', response.status, response.statusText);

    if (!response.ok) {
      const errorText = await response.text();
      console.error('TMDB API error:', response.status, errorText);
      
      return {
        statusCode: response.status &gt;= 500 ? 502 : response.status,
        headers,
        body: JSON.stringify({ 
          error: 'External API error',
          message: `TMDB API returned ${response.status}: ${response.statusText}`,
          details: response.status === 401 ? 'Invalid API key' : 'Service temporarily unavailable'
        })
      };
    }

    // Parse the JSON response
    const data = await response.json();
    console.log('Successfully fetched data, results count:', data.results ? data.results.length : 'N/A');

    // Return successful response
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify(data)
    };

  } catch (error) {
    console.error('Function error:', error.name, error.message);
    console.error('Stack trace:', error.stack);
    
    // Handle different types of errors
    let errorMessage = 'Internal server error';
    let statusCode = 500;
    
    if (error.name === 'TypeError' &amp;&amp; error.message.includes('fetch')) {
      errorMessage = 'Network error connecting to TMDB API';
      statusCode = 502;
    } else if (error.name === 'AbortError' || error.message.includes('timeout')) {
      errorMessage = 'Request timeout - TMDB API is slow';
      statusCode = 504;
    }
    
    return {
      statusCode: statusCode,
      headers,
      body: JSON.stringify({ 
        error: errorMessage,
        message: process.env.NODE_ENV === 'development' ? error.message : 'Something went wrong',
        timestamp: new Date().toISOString()
      })
    };
  }
};// netlify/functions/tmdb.js
exports.handler = async (event, context) =&gt; {
  console.log('Function called with:', event.httpMethod, event.queryStringParameters);
  
  // Domain restrictions - only allow requests from your domain and localhost
  const allowedOrigins = [
    'https://zippy-meerkat-329c02.netlify.app',
    'http://localhost:3000',
    'http://127.0.0.1:3000',
    'http://localhost:8000',
    'http://127.0.0.1:8000',
    'http://localhost:8888', // Netlify dev
    'http://127.0.0.1:8888'
  ];
  
  const origin = event.headers.origin || event.headers.referer || '';
  const isAllowedOrigin = allowedOrigins.some(allowed =&gt; 
    origin.startsWith(allowed)
  ) || !origin; // Allow if no origin (direct access)
  
  const headers = {
    'Access-Control-Allow-Origin': isAllowedOrigin ? (origin || '*') : 'https://zippy-meerkat-329c02.netlify.app',
    'Access-Control-Allow-Headers': 'Content-Type',
    'Access-Control-Allow-Methods': 'GET, OPTIONS',
    'Content-Type': 'application/json',
    'Cache-Control': 'public, max-age=300' // 5 minute cache
  };

  // Handle preflight CORS requests
  if (event.httpMethod === 'OPTIONS') {
    console.log('Handling OPTIONS request');
    return { 
      statusCode: 200, 
      headers, 
      body: '' 
    };
  }

  // Only allow GET requests
  if (event.httpMethod !== 'GET') {
    console.log('Method not allowed:', event.httpMethod);
    return {
      statusCode: 405,
      headers,
      body: JSON.stringify({ error: 'Method not allowed. Only GET requests are supported.' })
    };
  }

  try {
    // Get API key from environment variable
    const API_KEY = process.env.TMDB_API_KEY;
    
    if (!API_KEY) {
      console.error('TMDB_API_KEY environment variable is not set');
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({ 
          error: 'Server configuration error',
          message: 'API key not configured'
        })
      };
    }

    console.log('API key found, length:', API_KEY.length);

    // Extract query parameters
    const { endpoint, query, page = '1', genre } = event.queryStringParameters || {};

    if (!endpoint) {
      console.log('Missing endpoint parameter');
      return {
        statusCode: 400,
        headers,
        body: JSON.stringify({ 
          error: 'Missing required parameter',
          message: 'endpoint parameter is required'
        })
      };
    }

    console.log('Processing request for endpoint:', endpoint);

    // Rate limiting - log IP for monitoring
    const userIP = event.headers['client-ip'] || 
                   event.headers['x-forwarded-for'] || 
                   event.headers['x-real-ip'] || 
                   'unknown';
    
    console.log(`Request from IP: ${userIP} for endpoint: ${endpoint}`);

    // Build the TMDB API URL
    let tmdbUrl = `https://api.themoviedb.org/3/${endpoint}?api_key=${API_KEY}`;
    
    // Add optional parameters
    if (query) {
      tmdbUrl += `&amp;query=${encodeURIComponent(query)}`;
      console.log('Added query parameter:', query);
    }
    
    if (page &amp;&amp; page !== '1') {
      tmdbUrl += `&amp;page=${encodeURIComponent(page)}`;
      console.log('Added page parameter:', page);
    }
    
    if (genre) {
      tmdbUrl += `&amp;with_genres=${encodeURIComponent(genre)}`;
      console.log('Added genre parameter:', genre);
    }

    // Log the URL (without API key for security)
    const logUrl = tmdbUrl.replace(API_KEY, '[REDACTED]');
    console.log('Making request to TMDB:', logUrl);

    // Make the request to TMDB API
    const response = await fetch(tmdbUrl, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'User-Agent': 'TV-Movie-Tracker/1.0'
      },
      timeout: 10000 // 10 second timeout
    });

    console.log('TMDB response status:', response.status, response.statusText);

    if (!response.ok) {
      const errorText = await response.text();
      console.error('TMDB API error:', response.status, errorText);
      
      return {
        statusCode: response.status &gt;= 500 ? 502 : response.status,
        headers,
        body: JSON.stringify({ 
          error: 'External API error',
          message: `TMDB API returned ${response.status}: ${response.statusText}`,
          details: response.status === 401 ? 'Invalid API key' : 'Service temporarily unavailable'
        })
      };
    }

    // Parse the JSON response
    const data = await response.json();
    console.log('Successfully fetched data, results count:', data.results ? data.results.length : 'N/A');

    // Return successful response
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify(data)
    };

  } catch (error) {
    console.error('Function error:', error.name, error.message);
    console.error('Stack trace:', error.stack);
    
    // Handle different types of errors
    let errorMessage = 'Internal server error';
    let statusCode = 500;
    
    if (error.name === 'TypeError' &amp;&amp; error.message.includes('fetch')) {
      errorMessage = 'Network error connecting to TMDB API';
      statusCode = 502;
    } else if (error.name === 'AbortError' || error.message.includes('timeout')) {
      errorMessage = 'Request timeout - TMDB API is slow';
      statusCode = 504;
    }
    
    return {
      statusCode: statusCode,
      headers,
      body: JSON.stringify({ 
        error: errorMessage,
        message: process.env.NODE_ENV === 'development' ? error.message : 'Something went wrong',
        timestamp: new Date().toISOString()
      })
    };
  }
};</code></pre></div><div class="py-4"><p class="text-gray-600">www\functions\feedback.js (Line 1:1 - Line 122:2), www\netlify\functions\feedback.js (Line 1:1 - Line 122:2)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn46" onclick="toggleCodeBlock('cloneGroup46', 'expandBtn46', 'collapseBtn46')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup46"><code class="language-javascript text-sm text-gray-800">exports.handler = async (event, context) =&gt; {
  // Enhanced CORS headers
  const headers = {
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Headers': 'Content-Type, Accept',
    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
    'Access-Control-Max-Age': '86400',
    'Content-Type': 'application/json'
  };

  // Debug logging
  console.log('=== FUNCTION CALLED ===');
  console.log('Method:', event.httpMethod);
  console.log('Headers:', event.headers);
  console.log('Body:', event.body);
  console.log('=====================');

  // Handle preflight OPTIONS request
  if (event.httpMethod === 'OPTIONS') {
    console.log('Handling OPTIONS preflight request');
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({ message: 'CORS preflight successful' })
    };
  }

  // Handle GET request (for testing)
  if (event.httpMethod === 'GET') {
    console.log('Handling GET request');
    return {
      statusCode: 200,
      headers,
      body: JSON.stringify({ 
        message: 'Feedback function is working!',
        endpoint: 'Use POST to submit feedback',
        timestamp: new Date().toISOString()
      })
    };
  }

  // Handle POST request (actual feedback)
  if (event.httpMethod === 'POST') {
    try {
      console.log('Processing POST request with feedback data');
      
      // Parse the feedback data
      let feedback;
      try {
        feedback = JSON.parse(event.body);
      } catch (parseError) {
        console.error('JSON parse error:', parseError);
        return {
          statusCode: 400,
          headers,
          body: JSON.stringify({ 
            error: 'Invalid JSON in request body',
            details: parseError.message 
          })
        };
      }
      
      // Add server-side metadata
      const enhancedFeedback = {
        ...feedback,
        serverTimestamp: new Date().toISOString(),
        ip: event.headers['x-forwarded-for'] || event.headers['client-ip'] || 'unknown',
        userAgent: event.headers['user-agent'] || 'unknown',
        netlifyId: context.awsRequestId || 'unknown'
      };

      // Log the feedback prominently
      console.log('=== FEEDBACK RECEIVED ===');
      console.log(JSON.stringify(enhancedFeedback, null, 2));
      console.log('📺 SHOW:', feedback.show || 'Unknown');
      console.log('⭐ RATING:', feedback.rating || 'N/A', '/5');
      console.log('💭 COMMENT:', feedback.comment || 'No comment');
      console.log('🌍 IP:', enhancedFeedback.ip);
      console.log('📱 DEVICE:', enhancedFeedback.userAgent?.slice(0, 50) + '...');
      console.log('========================');

      return {
        statusCode: 200,
        headers,
        body: JSON.stringify({ 
          success: true, 
          id: enhancedFeedback.id || 'unknown',
          message: 'Feedback received and logged successfully!',
          timestamp: enhancedFeedback.serverTimestamp
        })
      };
      
    } catch (error) {
      console.error('=== FUNCTION ERROR ===');
      console.error('Error processing feedback:', error);
      console.error('Stack:', error.stack);
      console.error('====================');
      
      return {
        statusCode: 500,
        headers,
        body: JSON.stringify({ 
          error: 'Internal server error',
          message: 'Failed to process feedback',
          timestamp: new Date().toISOString()
        })
      };
    }
  }

  // If we get here, it's an unsupported method
  console.log('Unsupported method:', event.httpMethod);
  return {
    statusCode: 405,
    headers,
    body: JSON.stringify({ 
      error: 'Method not allowed',
      allowedMethods: ['GET', 'POST', 'OPTIONS'],
      receivedMethod: event.httpMethod
    })
  };
};</code></pre></div><div class="py-4"><p class="text-gray-600">www\features\trivia-safe.js (Line 13:3 - Line 19:42), www\scripts\trivia.js (Line 9:3 - Line 15:72)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn47" onclick="toggleCodeBlock('cloneGroup47', 'expandBtn47', 'collapseBtn47')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup47"><code class="language-javascript text-sm text-gray-800">const qEl = document.getElementById('triviaQuestion');
  const cEl = document.getElementById('triviaChoices');
  const fEl = document.getElementById('triviaFeedback');
  const nBtn = document.getElementById('triviaNextBtn');
  const statsEl = el.querySelector('.trivia-stats');

  // Safety check for all required elements</code></pre></div><div class="py-4"><p class="text-gray-600">www\features\trivia-safe.js (Line 28:7 - Line 61:25), www\scripts\trivia.js (Line 27:2 - Line 60:35)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn48" onclick="toggleCodeBlock('cloneGroup48', 'expandBtn48', 'collapseBtn48')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup48"><code class="language-javascript text-sm text-gray-800">;
  }

  const KEYS = {
    streak: 'flicklet:trivia:v1:streak',
    last  : 'flicklet:trivia:v1:lastDate',
    lock  : 'flicklet:trivia:v1:lockDate'
  };

  const today = isoDay(new Date()); // YYYY-MM-DD

  // External trivia API integration
  const TRIVIA_API_BASE = 'https://opentdb.com/api.php';
  
  // Fallback pool for when API fails
  const FALLBACK_POOL = [
    { id: 'q1', q: 'Which network originally aired &quot;Archer&quot;?', choices: ['HBO','FX','AMC','Paramount+'], correct: 1 },
    { id: 'q2', q: '&quot;Alien: Earth&quot; is a spin-off in which franchise?', choices: ['Predator','Alien','Star Trek','The Expanse'], correct: 1 },
    { id: 'q3', q: 'Sherlock (2010) starred Benedict Cumberbatch and…', choices: ['Tom Hiddleston','Martin Freeman','David Tennant','Matt Smith'], correct: 1 },
    { id: 'q4', q: '&quot;House of the Dragon&quot; streams primarily on…', choices: ['HBO Max','Netflix','Hulu','Apple TV+'], correct: 0 },
    { id: 'q5', q: 'Which streaming service is known for &quot;The Mandalorian&quot;?', choices: ['Netflix','Disney+','HBO Max','Amazon Prime'], correct: 1 },
    { id: 'q6', q: 'What year did &quot;Breaking Bad&quot; first air?', choices: ['2007','2008','2009','2010'], correct: 1 },
    { id: 'q7', q: 'Who created &quot;Stranger Things&quot;?', choices: ['Ryan Murphy','The Duffer Brothers','Shonda Rhimes','David Fincher'], correct: 1 },
    { id: 'q8', q: 'Which show features the character Walter White?', choices: ['Better Call Saul','Breaking Bad','The Walking Dead','Ozark'], correct: 1 },
  ];
  
  // Cache for trivia questions
  let triviaCache = null;
  let lastFetchDate = null;
  
  // Current question data (accessible to choose function)
  let currentQuestion = null;

  // Safe helper functions</code></pre></div><div class="py-4"><p class="text-gray-600">www\features\trivia-safe.js (Line 124:13 - Line 139:9), www\scripts\trivia.js (Line 388:11 - Line 403:11)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn49" onclick="toggleCodeBlock('cloneGroup49', 'expandBtn49', 'collapseBtn49')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup49"><code class="language-javascript text-sm text-gray-800">() {
    const last = localStorage.getItem(KEYS.last);
    const streak = Number(localStorage.getItem(KEYS.streak) || 0);

    if (last === prevDay(today)) {
      localStorage.setItem(KEYS.streak, String(streak + 1));
    } else if (last === today) {
      // already counted today; no change
    } else {
      // missed a day or first time
      localStorage.setItem(KEYS.streak, '1');
    }
    localStorage.setItem(KEYS.last, today);
  }

  function</code></pre></div><div class="py-4"><p class="text-gray-600">www\critical-translations.js (Line 29:9 - Line 42:41), www\simple-translation-scanner.js (Line 12:57 - Line 26:53)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn50" onclick="toggleCodeBlock('cloneGroup50', 'expandBtn50', 'collapseBtn50')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup50"><code class="language-javascript text-sm text-gray-800">);
    elements.forEach(el =&gt; {
      // Skip if already has data-i18n
      if (el.hasAttribute('data-i18n')) return;
      
      // Skip if no text or just whitespace
      const text = el.textContent?.trim();
      if (!text) return;
      
      // Skip if it's just numbers or symbols
      if (/^[\d\s\-\.]+$/.test(text)) return;
      if (text.length &lt;= 2) return;
      
      // Skip common non-translatable elements</code></pre></div><div class="py-4"><p class="text-gray-600">www\critical-translations.js (Line 74:2 - Line 88:21), www\find-missing-translations.js (Line 78:2 - Line 92:24)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn51" onclick="toggleCodeBlock('cloneGroup51', 'expandBtn51', 'collapseBtn51')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup51"><code class="language-javascript text-sm text-gray-800">&amp;&amp; current; i++) {
    if (current.id) {
      context.unshift(`#${current.id}`);
    } else if (current.className) {
      context.unshift(`.${current.className.split(' ')[0]}`);
    } else {
      context.unshift(current.tagName ? current.tagName.toLowerCase() : 'unknown');
    }
    current = current.parentElement;
  }
  
  return context.join(' &gt; ');
}

function generateCriticalKeys</code></pre></div><div class="py-4"><p class="text-gray-600">www\critical-translations.js (Line 98:7 - Line 108:38), www\find-missing-translations.js (Line 101:7 - Line 111:5)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn52" onclick="toggleCodeBlock('cloneGroup52', 'expandBtn52', 'collapseBtn52')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup52"><code class="language-javascript text-sm text-gray-800">.substring(0, 30); // Limit length
    
    // Make sure it's unique
    let originalKey = key;
    let counter = 1;
    while (keys.some(k =&gt; k.key === key)) {
      key = `${originalKey}_${counter}`;
      counter++;
    }
    
    // Add priority based on element type</code></pre></div><div class="py-4"><p class="text-gray-600">www\critical-translations.js (Line 158:46 - Line 166:4), www\find-missing-translations.js (Line 144:62 - Line 152:8)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn53" onclick="toggleCodeBlock('cloneGroup53', 'expandBtn53', 'collapseBtn53')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup53"><code class="language-javascript text-sm text-gray-800">);
  keys.forEach(item =&gt; {
    console.log(`    ${item.key}: &quot;${item.text}&quot;, // TODO: Translate to Spanish`);
  });
  
  console.log('\n=== HTML ELEMENTS TO UPDATE ===');
  console.log('Add data-i18n attributes to these elements:');
  keys.forEach(item =&gt; {
    console.log(`&lt;${item.tag</code></pre></div><div class="py-4"><p class="text-gray-600">www\comprehensive-translation-fix.js (Line 116:10 - Line 130:58), www\critical-translations.js (Line 28:18 - Line 26:53)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn54" onclick="toggleCodeBlock('cloneGroup54', 'expandBtn54', 'collapseBtn54')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup54"><code class="language-javascript text-sm text-gray-800">.forEach(selector =&gt; {
    const elements = document.querySelectorAll(selector);
    elements.forEach(el =&gt; {
      // Skip if already has data-i18n
      if (el.hasAttribute('data-i18n')) return;
      
      // Skip if no text or just whitespace
      const text = el.textContent?.trim();
      if (!text) return;
      
      // Skip if it's just numbers or symbols
      if (/^[\d\s\-\.]+$/.test(text)) return;
      if (text.length &lt;= 2) return;
      
      // Skip if element has child elements (we want leaf text)</code></pre></div><div class="py-4"><p class="text-gray-600">www\build.js (Line 102:11 - Line 117:21), www\build.js (Line 80:10 - Line 95:20)</p><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2" id="expandBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Show code</button><button class="bg-gray-500 text-white px-1 py-0.5 text-xs rounded focus:outline-none ml-2 hidden" id="collapseBtn55" onclick="toggleCodeBlock('cloneGroup55', 'expandBtn55', 'collapseBtn55')">Hide code</button><pre class="bg-gray-100 border border-gray-200 p-4 rounded mt-2 hidden" id="cloneGroup55"><code class="language-javascript text-sm text-gray-800">));
      
      // Ensure directory exists
      const outputDir = path.dirname(outputPath);
      if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
      }
      
      fs.writeFileSync(outputPath, minified);
      console.log(`✅ ${file} → ${path.relative(__dirname, outputPath)}`);
    } else {
      console.log(`⚠️  ${file} not found, skipping...`);
    }
  });
  
  // Copy other assets</code></pre></div><!-- Add more clone groups for .txt format as needed         // Add more clone groups for .txt format as needed--></div></section><!-- Add more sections for other formats and clone groups as needed--></main><footer class="bg-white shadow mt-8 py-4"><div class="container mx-auto px-4 text-center"><p class="text-sm text-gray-600">This report is generated by jscpd, an open-source copy/paste detector.</p><p class="text-sm text-gray-600">jscpd is licensed under the MIT License.</p><a class="text-blue-500 text-sm" href="https://github.com/kucherenko/jscpd" target="_blank" rel="noopener noreferrer">View jscpd on GitHub</a></div></footer><script src="js/prism.js"></script><script>function toggleCodeBlock(codeBlockId, expandBtnId, collapseBtnId) {
  const codeBlock = document.getElementById(codeBlockId);
  const expandBtn = document.getElementById(expandBtnId);
  const collapseBtn = document.getElementById(collapseBtnId);

  codeBlock.classList.toggle('hidden');
  expandBtn.classList.toggle('hidden');
  collapseBtn.classList.toggle('hidden');
}</script></body></html>