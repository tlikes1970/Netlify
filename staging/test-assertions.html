<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotfix v25.3.1 - Assertions Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Hotfix v25.3.1 - Assertions Test</h1>
    
    <div class="test-section">
        <h2>DOM Assertions</h2>
        <div id="dom-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Auth Assertions</h2>
        <div id="auth-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Data Assertions</h2>
        <div id="data-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Cards Assertions</h2>
        <div id="cards-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Assets Assertions</h2>
        <div id="assets-results"></div>
    </div>

    <script>
        function runAssertions() {
            const results = {
                dom: [],
                auth: [],
                data: [],
                cards: [],
                assets: []
            };

            // DOM Assertions
            try {
                const createPosterCard = typeof window.createPosterCard === "function";
                results.dom.push({
                    test: "createPosterCard function exists",
                    result: createPosterCard,
                    message: createPosterCard ? "✅ createPosterCard function found" : "❌ createPosterCard function missing"
                });

                const posterGrids = document.querySelectorAll(".poster-cards-grid").length >= 1;
                results.dom.push({
                    test: "poster-cards-grid containers exist",
                    result: posterGrids,
                    message: posterGrids ? "✅ Found poster-cards-grid containers" : "❌ No poster-cards-grid containers found"
                });

                const accountButton = document.getElementById('accountButton');
                const greetingName = document.getElementById('greetingName');
                const greetingSnark = document.getElementById('greetingSnark');
                const langToggle = document.getElementById('langToggle');
                
                results.dom.push({
                    test: "Header elements exist",
                    result: !!(accountButton && greetingName && greetingSnark && langToggle),
                    message: `✅ Header elements: accountButton=${!!accountButton}, greetingName=${!!greetingName}, greetingSnark=${!!greetingSnark}, langToggle=${!!langToggle}`
                });
            } catch (e) {
                results.dom.push({
                    test: "DOM assertions",
                    result: false,
                    message: `❌ DOM assertion error: ${e.message}`
                });
            }

            // Auth Assertions
            try {
                const accountBtn = document.getElementById('accountButton');
                const signedOut = accountBtn && accountBtn.textContent.includes('Sign In');
                results.auth.push({
                    test: "Signed-out button text",
                    result: signedOut,
                    message: signedOut ? "✅ Button shows 'Sign In' when signed out" : "❌ Button text incorrect"
                });

                // Check for auth functions
                const hasUpdateAuthUI = typeof window.updateAuthUI === 'function';
                results.auth.push({
                    test: "updateAuthUI function exists",
                    result: hasUpdateAuthUI,
                    message: hasUpdateAuthUI ? "✅ updateAuthUI function found" : "❌ updateAuthUI function missing"
                });
            } catch (e) {
                results.auth.push({
                    test: "Auth assertions",
                    result: false,
                    message: `❌ Auth assertion error: ${e.message}`
                });
            }

            // Data Assertions
            try {
                const hasAppData = window.appData && typeof window.appData === 'object';
                results.data.push({
                    test: "appData exists",
                    result: hasAppData,
                    message: hasAppData ? "✅ appData object found" : "❌ appData object missing"
                });

                const hasDebouncedWrite = typeof window.debouncedWrite === 'function';
                results.data.push({
                    test: "debouncedWrite function exists",
                    result: hasDebouncedWrite,
                    message: hasDebouncedWrite ? "✅ debouncedWrite function found" : "❌ debouncedWrite function missing"
                });

                // Check for Firestore collection errors
                const hasCollectionErrors = window.console && window.console.error && 
                    window.console.error.toString().includes('collection');
                results.data.push({
                    test: "No collection() errors",
                    result: !hasCollectionErrors,
                    message: "✅ No collection() errors detected"
                });
            } catch (e) {
                results.data.push({
                    test: "Data assertions",
                    result: false,
                    message: `❌ Data assertion error: ${e.message}`
                });
            }

            // Cards Assertions
            try {
                const watchingTab = document.querySelector('[data-tab="watching"]');
                if (watchingTab) {
                    // Simulate clicking watching tab
                    watchingTab.click();
                    
                    setTimeout(() => {
                        const watchingGrid = document.querySelector('.poster-cards-grid');
                        results.cards.push({
                            test: "Watching tab shows poster-cards-grid",
                            result: !!watchingGrid,
                            message: watchingGrid ? "✅ poster-cards-grid exists in watching tab" : "❌ poster-cards-grid missing in watching tab"
                        });
                    }, 100);
                } else {
                    results.cards.push({
                        test: "Watching tab exists",
                        result: false,
                        message: "❌ Watching tab not found"
                    });
                }
            } catch (e) {
                results.cards.push({
                    test: "Cards assertions",
                    result: false,
                    message: `❌ Cards assertion error: ${e.message}`
                });
            }

            // Assets Assertions
            try {
                // Test placeholder image
                const img = new Image();
                img.onload = () => {
                    results.assets.push({
                        test: "Poster placeholder loads",
                        result: true,
                        message: "✅ Poster placeholder image loads successfully"
                    });
                    displayResults();
                };
                img.onerror = () => {
                    results.assets.push({
                        test: "Poster placeholder loads",
                        result: false,
                        message: "❌ Poster placeholder image failed to load"
                    });
                    displayResults();
                };
                img.src = '/assets/img/poster-placeholder.svg';
            } catch (e) {
                results.assets.push({
                    test: "Assets assertions",
                    result: false,
                    message: `❌ Assets assertion error: ${e.message}`
                });
                displayResults();
            }

            function displayResults() {
                // Display results
                Object.keys(results).forEach(category => {
                    const container = document.getElementById(`${category}-results`);
                    if (container) {
                        container.innerHTML = results[category].map(test => 
                            `<div class="${test.result ? 'pass' : 'fail'}">${test.message}</div>`
                        ).join('');
                    }
                });
            }
        }

        // Run assertions when page loads
        window.addEventListener('load', runAssertions);
    </script>
</body>
</html>

