<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Card Compaction Test</title>
    <style>
        body { 
            margin: 20px; 
            font-family: Arial, sans-serif; 
            background: #f5f5f5;
        }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .pass { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { margin: 5px; padding: 8px 16px; }
        #viewport-info { font-weight: bold; margin: 10px 0; }
        
        /* Simulate the actual show card structure */
        .show-card {
            background: white;
            border-radius: 8px;
            margin: 10px 0;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .poster {
            width: 80px;
            height: 120px;
            background: #ddd;
            border-radius: 4px;
            object-fit: cover;
        }
        
        .meta {
            flex: 1;
            min-width: 0;
        }
        
        .title {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 8px 0;
        }
        
        .overview {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
        }
        
        /* Our mobile compaction CSS - exactly as implemented */
        @media (max-width: 640px) {
            .mobile-v1 {
                --card-pad-y: 8px;
                --card-pad-x: 12px;
                --card-gap: 8px;
                --poster-w: 64px;
                --actions-w: 44px;
                --meta-title-size: 16px;
                --meta-line: 1.2;
            }

            .mobile-v1 .show-card {
                display: grid;
                grid-template-columns: var(--poster-w) 1fr var(--actions-w);
                align-items: center;
                column-gap: var(--card-gap);
                padding: var(--card-pad-y) var(--card-pad-x);
            }

            .mobile-v1 .show-card .poster,
            .mobile-v1 .show-card img.poster,
            .mobile-v1 .show-card .thumb,
            .mobile-v1 .show-card img.thumb {
                width: var(--poster-w);
                height: calc(var(--poster-w) * 1.5);
                object-fit: cover;
                border-radius: 6px;
                grid-column: 1;
                align-self: start;
            }

            .mobile-v1 .show-card .meta {
                grid-column: 2;
                align-self: start;
                min-width: 0;
            }
            .mobile-v1 .show-card .title {
                font-size: var(--meta-title-size);
                line-height: var(--meta-line);
                margin: 0 0 2px 0;
            }

            .mobile-v1 .show-card .overview {
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 2;
                overflow: hidden;
                margin-top: 2px;
            }

            .mobile-v1 .show-card .meta > * + * {
                margin-top: 2px;
            }

            .mobile-v1 .show-card .actions {
                grid-column: 3;
                width: var(--actions-w);
                min-width: var(--actions-w);
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 6px;
                align-self: start;
            }
            .mobile-v1 .show-card .actions .btn,
            .mobile-v1 .show-card .actions button,
            .mobile-v1 .show-card .actions .icon-btn {
                width: var(--actions-w);
                min-width: var(--actions-w);
                padding: 6px 0;
            }

            .mobile-v1 .show-card > :is(.meta, .actions, .poster) {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <h1>Mobile Card Compaction Test</h1>
    
    <div id="viewport-info">Viewport Width: <span id="viewport-width"></span>px</div>
    
    <div id="test-results"></div>
    
    <div>
        <button onclick="testMobile()">Test Mobile (390px)</button>
        <button onclick="testDesktop()">Test Desktop (1200px)</button>
        <button onclick="toggleMobileV1()">Toggle mobile-v1 class</button>
        <button onclick="runAllTests()">Run All Tests</button>
    </div>

    <!-- Sample show cards -->
    <div class="show-card">
        <div class="poster"></div>
        <div class="meta">
            <div class="title">Breaking Bad</div>
            <div class="overview">A high school chemistry teacher diagnosed with inoperable lung cancer turns to manufacturing and selling methamphetamine in order to secure his family's future. This is a very long description that should be clamped to 2 lines on mobile to demonstrate the line clamping functionality.</div>
        </div>
        <div class="actions">
            <button class="btn">Add</button>
            <button class="btn">Like</button>
        </div>
    </div>

    <div class="show-card">
        <div class="poster"></div>
        <div class="meta">
            <div class="title">The Office</div>
            <div class="overview">A mockumentary about a group of office workers where the workday consists of ego clashes, inappropriate behavior, and tedium. Another long description to test the line clamping feature on mobile devices.</div>
        </div>
        <div class="actions">
            <button class="btn">Add</button>
            <button class="btn">Like</button>
        </div>
    </div>

    <div class="show-card">
        <div class="poster"></div>
        <div class="meta">
            <div class="title">Stranger Things</div>
            <div class="overview">When a young boy vanishes, a small town uncovers a mystery involving secret experiments, terrifying supernatural forces, and one strange little girl.</div>
        </div>
        <div class="actions">
            <button class="btn">Add</button>
            <button class="btn">Like</button>
        </div>
    </div>

    <script>
        function updateViewportInfo() {
            document.getElementById('viewport-width').textContent = window.innerWidth;
        }

        function addTestResult(message, passed) {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'pass' : 'fail'}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function addInfo(message) {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = 'test-result info';
            div.textContent = message;
            results.appendChild(div);
        }

        function testMobile() {
            document.body.style.width = '390px';
            document.body.classList.add('mobile-v1');
            window.dispatchEvent(new Event('resize'));
            updateViewportInfo();
            
            const cards = document.querySelectorAll('.show-card');
            if (cards.length > 0) {
                const firstCard = cards[0];
                const display = getComputedStyle(firstCard).display;
                const gridTemplateColumns = getComputedStyle(firstCard).gridTemplateColumns;
                const height = firstCard.getBoundingClientRect().height;
                
                addTestResult(`Mobile (390px): display=${display}`, display === 'grid');
                addTestResult(`Grid template: ${gridTemplateColumns}`, gridTemplateColumns.includes('64px'));
                addTestResult(`Card height: ${Math.round(height)}px (â‰¤160px)`, height <= 160);
            }
        }

        function testDesktop() {
            document.body.style.width = '1200px';
            document.body.classList.remove('mobile-v1');
            window.dispatchEvent(new Event('resize'));
            updateViewportInfo();
            
            const cards = document.querySelectorAll('.show-card');
            if (cards.length > 0) {
                const firstCard = cards[0];
                const display = getComputedStyle(firstCard).display;
                
                addTestResult(`Desktop (1200px): display=${display} - ${display === 'flex' ? 'PASS' : 'FAIL'}`, display === 'flex');
            }
        }

        function toggleMobileV1() {
            document.body.classList.toggle('mobile-v1');
            const hasClass = document.body.classList.contains('mobile-v1');
            addInfo(`mobile-v1 class ${hasClass ? 'added' : 'removed'}`);
        }

        function runAllTests() {
            document.getElementById('test-results').innerHTML = '';
            addInfo('Running all mobile card compaction tests...');
            
            testMobile();
            testDesktop();
            
            addInfo('All tests completed!');
        }

        // Initialize
        updateViewportInfo();
        addInfo('Mobile Card Compaction Test Page Loaded');
        
        // Run initial test
        testMobile();
    </script>
</body>
</html>
