<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flicklet - TV & Movie Tracker v27.12</title>
    <meta
      name="description"
      content="Search, track, and rate shows & films fast."
    />
    <meta name="build" content="v27.12">
    
    <!-- Permissions Policy to prevent compute-pressure violations -->
    <meta http-equiv="Permissions-Policy" content="compute-pressure=(), camera=(), microphone=(), geolocation=()" />
    
    <!-- Cross-Origin-Opener-Policy for Google Auth popup compatibility -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="unsafe-none" />
    
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://apis.google.com https://accounts.google.com https://www.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://api.themoviedb.org https://firebase.googleapis.com https://www.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://accounts.google.com https://www.gstatic.com; frame-src 'self' https://accounts.google.com https://flicklet-71dff.firebaseapp.com;" />
    
    <!-- Additional Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <!-- X-Frame-Options should be set via HTTP headers, not meta tags -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    
    <!-- Main application module -->
    <script type="module" src="/main-advanced.js"></script>
    
    <!-- Base tag for root-relative URLs -->
    <base href="/">
    
    <!-- Icons for different platforms -->
    <link rel="icon" href="/icons/icon-512.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Critical CSS - Inlined for performance -->
    <link rel="stylesheet" href="/styles/critical.css">
    
    <!-- Critical CLS prevention CSS -->
    <style id="critical-cls-guard">
      /* Reserve space for help/top area */
      .search-help{ min-height: clamp(72px, 8vw, 128px); }

      /* Reserve space for the first curated row (prevents late layout jumps) */
      .curated-row:first-of-type{ min-height: clamp(220px, 30vw, 340px); }

      /* Give images in curated rows a stable box without touching layout elsewhere */
      @supports (aspect-ratio: 2 / 3){
        .curated-row img{
          aspect-ratio: 2 / 3;
          height: auto;
          width: 100%;
          object-fit: cover;
          display:block;
          background-color: rgba(0,0,0,0.04);
        }
      }

      /* Optional subtle skeleton if containers are empty at paint (no DOM changes needed) */
      .search-help:empty,
      .curated-row:first-of-type:empty{
        background: linear-gradient(90deg, #f2f2f2 25%, #f8f8f8 37%, #f2f2f2 63%);
        background-size: 400% 100%;
        animation: clsSkeleton 1.2s ease-in-out infinite;
        border-radius: 8px;
      }
      @keyframes clsSkeleton{0%{background-position:100% 0}100%{background-position:0 0}}
    </style>
    
    <!-- Minimal performance guard to prevent overlays -->
    <style id="perf-guards-minimal">
      /* Make sure the help container never overlays or captures clicks */
      .search-help{
        position: static !important;
        min-height: 0 !important;
        padding: 0 !important;
        background: none !important;
        z-index: auto !important;
      }
      /* If any residual text remains, don't let it block interactions */
      .search-help, .search-help *{
        pointer-events: none !important;
      }

      /* Keep first curated row lightweight without interfering with above-the-fold UI */
      .curated-row:first-of-type{
        content-visibility: auto;         /* render only when near viewport */
        contain-intrinsic-size: auto 320px; /* reserve vertical size without forcing layout */
        min-height: 0;                     /* no artificial height on desktop */
      }

      /* Never mask sticky search */
      .top-search{ position: sticky; } /* leave behavior intact; no z-index changes here */
    </style>
    
    <!-- Non-critical CSS - Load asynchronously -->
    <link rel="preload" href="/styles/inline-style-01.css?v=v17.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/inline-style-02.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/components.css?v=v17.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/mobile.css?v=v17.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/main.css?v=v17.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/consolidated-layout.css?v=v17.9" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/action-bar.css?v=v22.21" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/cards.css?v=v24.27" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/styles/modals.css?v=v25.0" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- Fallback for browsers without preload support -->
    <noscript>
      <link rel="stylesheet" href="/styles/inline-style-01.css?v=v17.9">
      <link rel="stylesheet" href="/styles/inline-style-02.css">
      <link rel="stylesheet" href="/styles/components.css?v=v17.9">
      <link rel="stylesheet" href="/styles/mobile.css?v=v17.9">
      <link rel="stylesheet" href="/styles/main.css?v=v17.9">
      <link rel="stylesheet" href="/styles/consolidated-layout.css?v=v17.9">
      <link rel="stylesheet" href="/styles/action-bar.css?v=v22.21">
      <link rel="stylesheet" href="/styles/cards.css?v=v24.27">
    </noscript>

    <!-- Firebase config FIRST (plain script is fine) -->
    <script src="/firebase-config.js?v=v26.8"></script>

    <!-- Firebase modular init SECOND as an ES module -->
    <script type="module" src="/js/firebase-init.js?v=v26.8"></script>
    
    <!-- TMDB API client -->
    <script src="/tmdb-config.js?v=v27.6"></script>
    <script src="/scripts/tmdb.js?v=v27.6"></script>
    
    <!-- Search module -->
    <script src="/js/search.js?v=v27.12"></script>
    
    <!-- Auth and data initialization -->
    <script type="module" src="/js/data-init.js?v=v26.8"></script>
    <script type="module" src="/js/auth.js?v=v26.8"></script>

    <!-- Guarded init: initialize app + Firestore once -->

    <!-- BOOTSTRAP GUARDS (must come before all app scripts) -->

    <!-- Feature flags and safety guard -->

    <!-- Early flags initialization (must be before any row scripts) -->

    <!-- Debug utilities (must load early) -->

    <!-- Emergency function restoration (critical fallbacks) -->
    <!--  --> <!-- DISABLED: Main functions are now working -->
    
    <!-- Syntax error bypass (ensures functionality) -->

    <!-- Home sections configuration (must load early) -->

    <!-- DOM element caching system -->

    <!-- Centralized error handling -->

    <!-- Unified visibility management -->

    <!-- Common utilities (reduced duplication) -->

    <!-- Layout enhancements (skeleton loaders, scroll indicators, accessibility) -->

    <!-- Chrome extension messaging polyfill -->

    <!-- Immediate mobile detection -->

</head>

  <body>

    <!-- Skip Links for Accessibility -->
    <a href="#main" class="skip-link">Skip to main content</a>
    <a href="#search" class="skip-link">Skip to search</a>
    <a href="#navigation" class="skip-link">Skip to navigation</a>

    <!-- Main Container -->
    <div class="main-container" id="appRoot">
      <header class="header" role="banner" data-lang-layout="inline">
        <div class="header-bar">
          <div class="header-left">
            <div id="headerGreeting" class="header-greeting" aria-live="polite"></div>
          </div>
          <div class="header-center">
            <span class="version-display">v27.12</span>
            <h1 class="brand" data-i18n="app_title">Flicklet</h1>
            <span class="tagline" data-i18n="app_subtitle">TV &amp; Movie Tracker</span>
          </div>
          <div class="header-right">
            <button id="accountButton" class="account-btn" aria-live="polite" title="Sign in" onclick="(firebaseAuth?.currentUser ? startSignOut() : startSignIn())">
              👤 <span id="accountButtonLabel">Sign In</span>
            </button>
            <select id="langToggle" class="lang-select select--sm" aria-label="Language" title="Language">
              <option value="en">EN</option>
              <option value="es">ES</option>
            </select>
          </div>
        </div>
        <!-- leave .top-search exactly as-is, below this block -->
      </header>

      <!-- Sticky Top Search -->
      <div class="top-search" id="search-container">

        <div class="search-help" id="searchHelp">
          
        </div>
        <div class="search-row" id="desktop-search-row">
          <input
            id="search"
            type="search"
            class="search-input search-area-input"
            placeholder=""
            data-i18n-placeholder="search_placeholder"
          />
          <select id="genreSelect" class="genre-filter search-area-genre">
            <option value="" data-i18n="all_genres">All Genres</option>
          </select>
          <button id="searchBtn" type="button" class="btn search-btn search-area-search" aria-label="Search for TV shows and movies">
            <span class="icon" aria-hidden="true">🔍</span>
            <span class="label" data-i18n="search">Search</span>
          </button>
          <button id="clearSearchBtn" type="button" class="btn btn--secondary clear-search-btn search-area-clear" aria-label="Clear search results">
            <span class="icon" aria-hidden="true">✖️</span>
            <span class="label" data-i18n="clear">Clear</span>
          </button>
        </div>
        <div
          id="tagFilterRow"
          class="tag-filters"
          aria-label="Tag filters"
        >        </div>
      </div>

      <!-- Tab container moved outside homeSection for proper positioning -->
      <div class="tab-container" id="navigation">
        <button id="homeTab" class="tab active" title="Overview of your TV & movie tracking" aria-label="Home tab - view dashboard and recommendations">🏠 <span data-i18n="home">Home</span></button>
        <button id="watchingTab" class="tab" title="Shows and movies you're currently watching" aria-label="Watching tab - view shows and movies you're currently watching">
          ▶️ <span data-i18n="currently_watching">Currently Watching</span>
          <span class="tab-badge" id="watchingBadge">0</span>
        </button>
        <button id="wishlistTab" class="tab" title="Shows and movies you want to watch later" aria-label="Wishlist tab - view shows and movies you want to watch">
          📖 <span data-i18n="want_to_watch">Want to Watch</span>
          <span class="tab-badge" id="wishlistBadge">0</span>
        </button>
        <button id="watchedTab" class="tab" title="Shows and movies you've already finished" aria-label="Watched tab - view shows and movies you've completed">
          ✅ <span data-i18n="already_watched">Already Watched</span>
          <span class="tab-badge" id="watchedBadge">0</span>
        </button>
        <button id="discoverTab" class="tab" title="Get personalized recommendations based on your taste" aria-label="Discover tab - find new shows and movies">✨ <span data-i18n="discover">Discover</span></button>
      </div>

      <!-- Search Results Container - Now positioned after tabs -->
      <div id="searchResults" class="search-results" style="display: none;">
        <h4>🎯 <span data-i18n="search_results">Search Results</span> <span class="count" id="resultsCount">0</span></h4>
        <div id="searchResultsList" class="list-container"></div>
      </div>

      <!-- Home - Immovable Layout Contract -->
      <div id="homeSection" class="tab-section active">
        <!-- Quote Bar - Hard-baked between Sticky Search and Group 1 -->
        <div id="quote-bar" class="quote-bar" role="region" aria-label="Quote of the moment" data-state="loading" style="display: none;">
          <div class="quote-marquee">
            <span class="quote-text" id="quoteText" data-i18n="loading_inspirational_quote">Loading inspirational quote...</span>
          </div>
        </div>

        <!-- Group 1 - Your Shows -->
        <div id="group-1-your-shows" class="home-group">
          <div class="group-header">
            <h2 class="group-title" data-i18n="your_shows">Your Shows</h2>
          </div>
          
          <!-- Currently Watching (row): always present -->
          <section id="currentlyWatchingPreview" class="home-preview-row" aria-label="Currently Watching Preview">
            <div class="preview-row-header">
              <h3 class="preview-row-title" data-i18n="currently_watching_section">👁️ Currently Watching</h3>
            </div>
            <div class="preview-row-container cw-row">
              <div class="preview-row-scroll row-inner" id="currentlyWatchingScroll">
                <!-- Cards will be populated by JavaScript -->
                <div class="placeholder-message" id="cw-placeholder" style="display: none;">
                  Add something to your Currently Watching list and it'll show up here.
                </div>
              </div>
            </div>
          </section>

          <!-- Group divider -->
          <div class="group-divider"></div>

          <!-- Next Up This Week (row): if data → carousel; if none → collapsed one-line placeholder -->
          <section id="next-up-row" class="home-preview-row" data-feature="homeRowNextUp" style="display: none;">
            <div class="preview-row-header">
              <h3 class="preview-row-title" data-i18n="next_up_this_week">📅 Next Up This Week</h3>
            </div>
            <div class="preview-row-container">
              <div class="next-up-scroll row-inner preview-row-scroll">
                <!-- tiles injected here -->
                <div class="placeholder-message" id="nextup-placeholder" style="display: none;" data-i18n="no_upcoming_episodes">
                  No upcoming episodes this week.
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Group 2 - Community -->
        <div id="group-2-community" class="home-group">
          <div class="group-header">
            <h2 class="group-title" data-i18n="community">Community</h2>
          </div>
          
          <!-- Community Content - Two Column Layout -->
          <div class="community-content">
            <!-- Left: Empty Player Box -->
            <div class="community-left">
              <div class="player-placeholder">
                <div class="placeholder-content">
                  <h3 data-i18n="community_player">Community Player</h3>
                  <p data-i18n="community_player_placeholder">Video content will appear here</p>
                </div>
              </div>
            </div>
            
            <!-- Right: Game Cards Section -->
            <div class="community-right">
              <section id="home-games" class="home-games">
                <article class="card card--game" id="flickwordTile" data-module="flickword" role="region" tabindex="0" aria-haspopup="dialog" aria-controls="modal-flickword" aria-labelledby="flickword-title">
                  <div class="card__header">
                    <h3 class="card__title" id="flickword-title" data-i18n="flickword">🎯 FlickWord</h3>
                    <div class="card__tools">
                      <div class="game-stats">
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="streak">Streak</span>
                          <span class="stat-value" data-fw-streak>0</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="best">Best</span>
                          <span class="stat-value" data-fw-best>0</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="win_percent">Win %</span>
                          <span class="stat-value" data-fw-win>—</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="card__body card__body--scroll">
                    <p class="card__description" data-i18n="flickword_tagline">Wordle-style daily word play</p>
                    <div aria-live="polite" class="sr-only" data-status-live></div>
                  </div>
                  
                  <div class="card__actions">
                    <button class="btn btn--primary" data-action="start-flickword" data-i18n="play_now">Play Now</button>
                  </div>
                </article>

                <article class="card card--game" id="triviaTile" data-module="trivia" role="region" tabindex="0" aria-haspopup="dialog" aria-controls="modal-trivia" aria-labelledby="trivia-title">
                  <div class="card__header">
                    <h3 class="card__title" id="trivia-title" data-i18n="daily_trivia">🧠 Daily Trivia</h3>
                    <div class="card__tools">
                      <div class="game-stats">
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="streak">Streak</span>
                          <span class="stat-value" data-tv-streak>1</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="best">Best</span>
                          <span class="stat-value" data-tv-best>5</span>
                        </div>
                        <div class="stat-item">
                          <span class="stat-label" data-i18n="accuracy">Accuracy</span>
                          <span class="stat-value" data-tv-acc>—</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="card__body card__body--scroll">
                    <p class="card__description" data-i18n="daily_trivia_tagline">Fresh question, new bragging rights</p>
                    <div aria-live="polite" class="sr-only" data-status-live></div>
                  </div>
                  
                  <div class="card__actions">
                    <button class="btn btn--primary" data-action="start-trivia" data-i18n="play_now">Play Now</button>
                  </div>
                </article>
              </section>
            </div>
          </div>
        </div>

        <!-- Group 3 - For You -->
        <div id="group-3-for-you" class="home-group">
          <div class="group-header">
            <h2 class="group-title" data-i18n="for_you">For You</h2>
          </div>
          
          <!-- Personalized genre rows from Settings -->
          <section id="personalized-section" class="home-preview-row" style="display: none;">
            <div class="preview-row-header">
              <h3 class="preview-row-title">🎨 <span data-i18n="personalized_recommendations">Personalized Recommendations</span></h3>
              <p class="section-subtitle" data-i18n="based_on_watching_history">Based on your watching history and preferences</p>
            </div>
            <div class="preview-row-container">
              <div class="section-content" id="personalized-content">
                <!-- Personalized content will be populated here -->
              </div>
            </div>
          </section>

          <!-- Group divider -->
          <div class="group-divider"></div>

          <!-- Curated rows count per user setting -->
          <section id="curated-section" class="home-preview-row">
            <div class="preview-row-header">
              <h3 class="preview-row-title" data-i18n="curated_sections">🎯 Curated Sections</h3>
            </div>
            <div class="preview-row-container">
              <div id="curatedSections" class="home-section" style="display: none;">
                <!-- Curated content will be populated here -->
              </div>
            </div>
          </section>
        </div>

        <!-- Group 4 - In Theaters Near You -->
        <div id="group-4-theaters" class="home-group">
          <div class="group-header">
            <h2 class="group-title" data-i18n="in_theaters">In Theaters</h2>
          </div>
          
          <section id="theaters-section" class="home-preview-row" style="display: none;">
            <div class="preview-row-header">
              <h3 class="preview-row-title">🎬 <span data-i18n="in_theaters_near_you">In Theaters Near You</span></h3>
              <p class="section-subtitle" data-i18n="current_theatrical_releases">Current theatrical releases</p>
            </div>
            <div class="preview-row-container">
              <div class="section-content" id="theaters-content">
                <!-- Theater content will be populated here -->
                <div class="theaters-fallback" id="theaters-fallback" style="display: none;" data-i18n="location_prompt">
                  Turn on location to see movies playing near you.
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Group 5 - Feedback -->
        <div id="group-5-feedback" class="home-group">
          <div class="group-header">
            <h2 class="group-title" data-i18n="feedback">Feedback</h2>
          </div>
          
          <section id="feedbackSection" class="home-preview-row">
            <div class="preview-row-header">
              <h3 class="preview-row-title" data-i18n="share_your_thoughts">💬 Share Your Thoughts</h3>
              <p class="section-subtitle" data-i18n="help_improve_feedback">Help us improve Flicklet with your feedback</p>
            </div>
            <div class="preview-row-container">
              <div class="feedback-content">
                <div class="feedback-card">
                  <div class="feedback-actions">
                    <button class="btn btn--primary" onclick="openSettingsToFeedback()" data-i18n="report_bug">
                      🐛 Report a Bug
                    </button>
                    <button class="btn btn--secondary" onclick="openSettingsToFeedback()" data-i18n="suggest_feature">
                      💡 Suggest a Feature
                    </button>
                    <button class="btn btn--secondary" onclick="openSettingsToFeedback()" data-i18n="general_feedback">
                      💬 General Feedback
                    </button>
                    <button class="btn btn--secondary" onclick="openSettingsToFeedback()" data-i18n="submit_video">
                      📹 Submit Video
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>

      <main id="main" role="main">

      <!-- Watching -->
      <div id="watchingSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ▶️ <span data-i18n="currently_watching">Currently Watching</span>
              <span class="count" id="watchingCount">0</span>
            </h3>
          </div>
          <div id="watchingList" class="list-container"></div>
        </div>
      </div>

      <!-- Wishlist -->
      <div id="wishlistSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              📖 <span data-i18n="want_to_watch">Want to Watch</span>
              <span class="count" id="wishlistCount">0</span>
            </h3>
          </div>
          <div id="wishlistList" class="list-container"></div>
        </div>
      </div>

      <!-- Watched -->
      <div id="watchedSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ✅ <span data-i18n="already_watched">Already Watched</span>
              <span class="count" id="watchedCount">0</span>
            </h3>
          </div>
          <div id="watchedList" class="list-container"></div>
        </div>
      </div>

      <!-- Discover -->
              <div id="discoverSection" class="tab-section" style="display: none">
          <div class="section">
            <h3>✨ <span data-i18n="discover">Discover</span></h3>
            <p data-i18n="discover_description">Recommendations based on your likes and ratings.</p>
            <div id="discoverList" class="list-container"></div>
          </div>
        </div>

      <!-- Settings / Profile -->
              <div id="settingsSection" class="tab-section" style="display: none">
              <div class="settings-tabs" role="tablist" aria-label="Settings Sections">
                <button role="tab" aria-selected="true" class="active" data-target="#general"><span data-i18n="general">General</span></button>
                <button role="tab" aria-selected="false" data-target="#notifications"><span data-i18n="notifications">Notifications</span></button>
                <button role="tab" aria-selected="false" data-target="#layout"><span data-i18n="layout">Layout</span></button>
                <button role="tab" aria-selected="false" data-target="#data"><span data-i18n="data">Data</span></button>
                <button role="tab" aria-selected="false" data-target="#pro"><span data-i18n="pro">Pro</span></button>
                <button role="tab" aria-selected="false" data-target="#about"><span data-i18n="about">About</span></button>
              </div>

              <div class="settings-container">
                <!-- General Section -->
                <section id="general" class="settings-section active">
                  <div class="settings-subsection">
                    <h3 class="settings-title">⚙️ <span data-i18n="general">General</span></h3>
                    <p class="settings-description" data-i18n="general_description">Manage your account and basic preferences</p>
                    
                    <!-- Display Name -->
                    <div class="settings-control-group">
                      <label for="displayNameInput" class="settings-label" data-i18n="display_name">Display Name</label>
                      <div class="settings-input-group">
                        <input
                          id="displayNameInput"
                          class="settings-input"
                          placeholder="Enter your name"
                        />
                        <button id="saveNameBtn" class="btn btn--primary" onclick="saveDisplayName()">
                          💾 <span data-i18n="save">Save</span>
                        </button>
                      </div>
                      <p class="settings-hint">Your name will appear in the header and personalize your experience</p>
                    </div>
                  </div>

                  <div class="settings-subsection">
                    <h4 class="settings-subtitle">📊 <span data-i18n="my_statistics">My Statistics</span></h4>
                    <p class="settings-hint">View your watching statistics and achievements</p>
                    <div id="statsContent" class="settings-stats">
                      <div class="loading" data-i18n="loading_stats">Loading stats...</div>
                    </div>
                  </div>

                  <div class="settings-subsection">
                    <h4 class="settings-subtitle">🚫 <span data-i18n="not_interested_management">Not Interested Management</span></h4>
                    <p class="settings-description" data-i18n="not_interested_description">Manage shows and movies you've marked as not interested</p>
                    <div class="settings-control-group">
                      <button id="manageNotInterestedBtn" class="btn" onclick="openNotInterestedModal()">
                        🚫 <span data-i18n="manage_not_interested_list">Manage Not Interested List</span>
                      </button>
                      <p class="settings-hint">View and remove items from your "Not Interested" list to see them in recommendations again</p>
                    </div>
                  </div>
                </section>

                <!-- Notifications Section -->
                <section id="notifications" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">🔔 <span data-i18n="notifications">Notifications</span></h3>
                    <p class="settings-description" data-i18n="notifications_description">Choose which types of notifications you'd like to receive</p>
                    
                    <!-- Episode Alerts -->
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifEpisodes" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="episode_alerts">Upcoming episode alerts</span>
                      </label>
                      <p class="settings-hint">Get notified when new episodes of shows you're watching are about to air</p>
                    </div>

                    <!-- Weekly Discover -->
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifDiscover" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="weekly_discover">Weekly discover picks</span>
                      </label>
                      <p class="settings-hint">Receive weekly recommendations for new shows and movies based on your preferences</p>
                    </div>

                    <!-- Monthly Digest -->
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifDigest" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="monthly_digest">Monthly stats digest</span>
                      </label>
                      <p class="settings-hint">Get a monthly summary of your watching statistics and achievements</p>
                    </div>
                  </div>

                  <!-- Pro Notifications -->
                  <div class="settings-subsection">
                    <h4 class="settings-subtitle" data-i18n="pro_notifications">⭐ Pro Notifications</h4>
                    <p class="settings-description" data-i18n="advanced_notification_features">Advanced notification features for Pro users</p>
                    
                    <!-- Advanced Notifications (PRO) -->
                    <div class="settings-control-group">
                      <h5 class="settings-label">🔔 Advanced Notifications (PRO)</h5>
                      <p class="settings-hint">Configure advanced notification settings with custom lead times and list monitoring</p>
                      <div class="settings-block card-surface" style="display: flex; flex-direction: column; gap: 15px; padding: 15px;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                          <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="advOn" disabled aria-disabled="true">
                            <span>Enable advanced notifications</span>
                          </label>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                          <label for="advLead" style="font-weight: 500;">Lead time (hours):</label>
                          <select id="advLead" disabled aria-disabled="true" aria-label="Notification lead time" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                            <option value="6">6</option>
                            <option value="12">12</option>
                            <option value="24" selected>24</option>
                            <option value="48">48</option>
                            <option value="custom">Custom…</option>
                          </select>
                          <input type="number" id="advLeadCustom" min="1" step="1" value="24" disabled aria-disabled="true" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; width: 80px;">
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                          <label for="advLists" style="font-weight: 500;">Monitor lists:</label>
                          <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <label style="display: flex; align-items: center; gap: 4px;">
                              <input type="checkbox" id="advListWatching" checked disabled aria-disabled="true">
                              <span>Currently Watching</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                              <input type="checkbox" id="advListWishlist" disabled aria-disabled="true">
                              <span>Want to Watch</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 4px;">
                              <input type="checkbox" id="advListWatched" disabled aria-disabled="true">
                              <span>Already Watched</span>
                            </label>
                          </div>
                        </div>
                        <div class="meta-muted" role="note">🔒 Pro feature - upgrade to unlock advanced notifications</div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Layout Section -->
                <section id="layout" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">🎨 <span data-i18n="layout_settings">Layout Settings</span></h3>
                    <p class="settings-description" data-i18n="layout_description">Customize how your lists and cards are displayed</p>
                    
                    <!-- Core Layout Features -->
                    <h4 class="settings-subtitle" data-i18n="core_features">📋 Core Features</h4>
                    <p class="settings-description" data-i18n="basic_layout_customization">Basic layout customization available to all users</p>
                    
                    <!-- Condensed Mode -->
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="condensedMode" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="condensed_list_view">Condensed list view (more items per screen)</span>
                      </label>
                      <p class="settings-hint" data-i18n="show_more_items_per_screen">Show more items per screen by reducing card spacing and padding</p>
                    </div>

                    <!-- Show Posters -->
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="showPosters" class="settings-checkbox" checked />
                        <span class="settings-checkbox-text" data-i18n="show_posters">Show movie/TV show posters</span>
                      </label>
                      <p class="settings-hint" data-i18n="display_poster_images">Display poster images for each show and movie in your lists</p>
                    </div>

                    <!-- Theme Toggle -->
                    <div class="settings-control-group">
                      <div class="settings-toggle-group">
                        <label class="settings-label" data-i18n="theme_preference">Theme Preference</label>
                        <div class="theme-toggle-container">
                          <button id="themeToggleBtn" class="btn btn--secondary theme-toggle-btn" data-action="toggle-theme">
                            <span id="themeToggleIcon">🌙</span>
                            <span id="themeToggleText" data-i18n="dark_mode">Dark Mode</span>
                          </button>
                          <p class="settings-hint" data-i18n="theme_toggle_hint">Click to switch between light and dark themes</p>
                        </div>
                      </div>
                    </div>

                    <!-- Home Page Lists Count -->
                    <div class="settings-control-group">
                      <label for="settingCuratedRows" class="settings-label" data-i18n="home_page_lists">Home Page TV/Movie Lists</label>
                      <div class="settings-input-group">
                        <input
                          type="number"
                          id="settingCuratedRows"
                          name="curatedRows"
                          min="1"
                          max="3"
                          value="3"
                          class="settings-input settings-input-number"
                        />
                        <span class="settings-hint">(1-3)</span>
                        <span id="curatedRowsStatus" class="settings-status">Auto-saves</span>
                      </div>
                      <p class="settings-hint" data-i18n="number_of_curated_sections">Number of curated recommendation sections to show on the home page</p>
                    </div>

                    <!-- Currently Watching Preview Limit -->
                    <div class="settings-control-group">
                      <label for="settingCurrentlyWatchingLimit" class="settings-label" data-i18n="currently_watching_preview_limit">Currently Watching Preview Limit</label>
                      <div class="settings-input-group">
                        <input
                          type="number"
                          id="settingCurrentlyWatchingLimit"
                          name="currentlyWatchingLimit"
                          min="5"
                          max="20"
                          value="12"
                          class="settings-input settings-input-number"
                        />
                        <span class="settings-hint">(5-20)</span>
                        <span id="currentlyWatchingLimitStatus" class="settings-status">Auto-saves</span>
                      </div>
                      <p class="settings-hint" data-i18n="number_of_currently_watching">Number of currently watching shows to display on the home page preview</p>
                    </div>

                    <!-- Episode Tracking Toggle -->
                    <div class="settings-control-group settings-control-group--feature">
                      <div class="settings-feature-card">
                        <div class="settings-feature-header">
                          <label class="settings-checkbox-label settings-checkbox-label--feature">
                            <input type="checkbox" id="enableEpisodeTracking" class="settings-checkbox settings-checkbox--feature" />
                            <span class="settings-checkbox-text settings-checkbox-text--feature" data-i18n="enable_episode_tracking">🎬 Enable Episode Tracking</span>
                          </label>
                          <div class="settings-feature-badge" data-i18n="recommended">Recommended</div>
                        </div>
                        <p class="settings-hint settings-hint--feature" data-i18n="allow_tracking_of_individual">Track individual episodes for TV series with detailed progress monitoring (opt-in per series)</p>
                        <div class="settings-feature-details">
                          <p class="settings-feature-benefit" data-i18n="episode_tracking_benefits">• Track your progress through each season<br>• Get notifications for new episodes<br>• See detailed watching statistics</p>
                        </div>
                      </div>
                    </div>

                  </div>

                  <!-- Pro Layout Features -->
                  <div class="settings-subsection">
                    <h4 class="settings-subtitle" data-i18n="pro_layout_features">⭐ Pro Layout Features</h4>
                    <p class="settings-description" data-i18n="advanced_layout_and_theming">Advanced layout and theming features for Pro users</p>
                    
                    <!-- Theme Packs -->
                    <div class="settings-control-group">
                      <h5 class="settings-label" data-i18n="theme_packs">🎨 Theme Packs</h5>
                      <p class="settings-hint" data-i18n="choose_a_visual_theme">Choose a visual theme for your Flicklet experience. Pro users get access to premium themes.</p>
                      <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                        <label for="themePackSelect" style="font-weight: 500;" data-i18n="theme">Theme:</label>
                        <select id="themePackSelect" aria-label="Choose theme" style="padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px;">
                          <option value="classic" selected>Classic</option>
                          <option value="dark" disabled aria-disabled="true">Dark Pro 🔒</option>
                          <option value="neon" disabled aria-disabled="true">Neon Pro 🔒</option>
                          <option value="minimal" disabled aria-disabled="true">Minimal Pro 🔒</option>
                        </select>
                        <div class="meta-muted" role="note" data-i18n="pro_unlocks_more_themes">🔒 Pro unlocks more themes</div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Data Section -->
                <section id="data" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">💾 <span data-i18n="data_management">Data Management</span></h3>
                    <p class="settings-description" data-i18n="data_description">Export, import, or reset your data</p>
                    
                    <!-- Core Data Features -->
                    <h4 class="settings-subtitle" data-i18n="core_features">📋 Core Features</h4>
                    <p class="settings-description" data-i18n="basic_data_management">Basic data management features available to all users</p>
                    
                    <!-- Export JSON -->
                    <div class="settings-control-group">
                      <button id="exportBtn" class="btn btn--secondary" aria-label="Export data to JSON">
                        📤 <span data-i18n="export_json">Export JSON</span>
                      </button>
                      <p class="settings-hint" data-i18n="download_a_complete_backup">Download a complete backup of your lists and settings as a JSON file</p>
                    </div>

                    <!-- Import JSON -->
                    <div class="settings-control-group">
                      <input type="file" id="importInput" accept=".json,application/json" hidden />
                      <button id="importBtn" class="btn btn--secondary" aria-label="Import data from JSON">
                        📥 <span data-i18n="import_json">Import JSON</span>
                      </button>
                      <p class="settings-hint" data-i18n="restore_your_data">Restore your data from a previously exported Flicklet backup file</p>
                    </div>

                    <!-- Not Interested Management -->
                    <div class="settings-control-group">
                      <h4 class="settings-subtitle">🚫 Not Interested List</h4>
                      <p class="settings-description">Manage items you don't want to see in recommendations</p>
                      
                      <div class="not-interested-controls">
                        <button id="viewNotInterestedBtn" class="btn btn--secondary">
                          👁️ View Not Interested Items
                        </button>
                        <button id="clearNotInterestedBtn" class="btn btn--danger">
                          🗑️ Clear All
                        </button>
                      </div>
                      
                      <div id="notInterestedList" class="not-interested-list" style="display: none;">
                        <div class="not-interested-list__header">
                          <h5>Items you're not interested in:</h5>
                          <button id="closeNotInterestedBtn" class="btn btn--sm btn--secondary">×</button>
                        </div>
                        <div id="notInterestedItems" class="not-interested-items">
                          <!-- Items will be populated here -->
                        </div>
                      </div>
                      
                      <p class="settings-hint">Items marked as "Not Interested" won't appear in your Discover recommendations</p>
                    </div>

                    <!-- Share Lists -->
                    <div class="settings-control-group">
                      <button id="shareOpenBtn" class="btn btn--secondary" data-action="share-lists" data-share-title="Flicklet — My List" data-share-url="" title="Share your lists" aria-label="Share your TV and movie lists">
                        🔗 <span data-i18n="share_lists">Share Lists</span>
                      </button>
                      <p class="settings-hint" data-i18n="generate_a_shareable_text">Generate a shareable text list of your TV shows and movies to send to friends</p>
                    </div>

                    <!-- Reset All Data -->
                    <div class="settings-control-group">
                      <button id="resetBtn" class="btn btn--danger" aria-label="Reset all data (requires confirmation)">
                        🗑️ <span data-i18n="reset_all_data">Reset All Data</span>
                      </button>
                      <p class="settings-hint" data-i18n="permanently_delete_all">⚠️ Permanently delete all your lists, settings, and data. This cannot be undone.</p>
                    </div>
                  </div>

                  <!-- Pro Data Features -->
                  <div class="settings-subsection">
                    <h4 class="settings-subtitle" data-i18n="pro_data_features">⭐ Pro Data Features</h4>
                    <p class="settings-description" data-i18n="advanced_data_management">Advanced data management features for Pro users</p>
                    
                    <!-- Export CSV (Pro) -->
                    <div class="settings-control-group">
                      <button class="btn" data-pro="required" data-pro-mode="hide" data-pro-feature="export-csv">
                        📊 <span data-i18n="export_csv_pro">Export CSV (Pro)</span>
                      </button>
                      <p class="settings-hint" data-i18n="export_your_data_csv">Export your data in CSV format for use in spreadsheets (Pro feature)</p>
                    </div>
                  </div>
                </section>

                <!-- Pro Section -->
                <section id="pro" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">⭐ <span data-i18n="pro_features">Pro Features</span></h3>
                    <p class="settings-description" data-i18n="pro_description">
                      Unlock advanced features and premium content with Flicklet Pro
                    </p>
                    
                    <!-- Preview Pro Features -->
                    <div class="settings-control-group">
                      <button id="previewProBtn" class="btn btn--primary" onclick="toggleProPreview()">
                        ⭐ <span data-i18n="preview_pro_features">Preview Pro Features</span>
                      </button>
                      <p class="settings-hint" data-i18n="pro_hint">Toggle Pro features on/off to see what's available without purchasing</p>
                    </div>

                    <!-- Extra Trivia (Pro) -->
                    <div class="settings-control-group">
                      <button class="btn" data-pro="required" data-pro-mode="disable" data-pro-feature="extra-trivia">
                        🧠 <span data-i18n="extra_trivia_pro">Extra Trivia (Pro)</span>
                      </button>
                      <p class="settings-hint" data-i18n="access_additional_trivia">Access additional trivia questions and behind-the-scenes content (Pro feature)</p>
                    </div>

                    <!-- Export CSV (Pro) -->
                    <div class="settings-control-group">
                      <button id="exportCsvBtn" class="btn" data-pro="required" data-pro-mode="disable" data-pro-feature="export-csv" onclick="exportToCSV()">
                        📊 <span data-i18n="export_csv_pro">Export CSV (Pro)</span>
                      </button>
                      <p class="settings-hint" data-i18n="export_your_data_csv">Export your data in CSV format for use in spreadsheets (Pro feature)</p>
                    </div>

                    <!-- Pro Features List -->
                    <div class="settings-control-group">
                      <h4 class="settings-subtitle">✨ <span data-i18n="pro_features_include">Pro Features Include:</span></h4>
                      <p class="settings-hint">Advanced features and premium content available with Flicklet Pro subscription</p>
                      <div id="proFeaturesList" class="settings-pro-features">
                        <!-- Dynamic Pro features list will be rendered here -->
                      </div>
                    </div>
                  </div>
                </section>

                <!-- About Section -->
                <section id="about" class="settings-section">
                  <!-- About Unique4U -->
                  <div class="settings-subsection">
                    <h3 class="settings-title" data-i18n="about_unique4u">🏠 About Unique4U</h3>
                    <p class="settings-description" data-i18n="were_not_here_to_reinvent">
                      We're not here to reinvent the wheel — we're here to make the wheel less squeaky. At Unique4U, our rule is simple: keep it simple. The world already has enough apps that feel like a second job to use. We'd rather give you tools that just… work.
                    </p>
                    <p class="settings-description" data-i18n="everything_we_build">
                      Everything we build has its own personality, but they all live under one roof: a people-first, all-inclusive, slightly offbeat house we call Unique4U. If it's fun, useful, and a little different from the pack — it belongs here.
                    </p>
                  </div>

                  <!-- About the Creators -->
                  <div class="settings-subsection">
                    <h3 class="settings-title" data-i18n="about_the_creators">👥 About the Creators</h3>
                    <p class="settings-description" data-i18n="were_pam_and_travis">
                      We're Pam and Travis. Think of us as casual builders with a shared allergy to overcomplication. We make things because we need them, and we figure you probably do too.
                    </p>
                    <p class="settings-description" data-i18n="pam_once_trained_dolphins">
                      Pam once trained dolphins (true story) and also happens to be really good with numbers. Travis studied English and Philosophy, which means he can overthink and explain it in writing, then somehow turn that into practical business know-how. Together, we're like a mash-up of "creative meets operations" — and that combo lets us build apps that are simple, useful, and not boring.
                    </p>
                  </div>

                  <!-- About the App -->
                  <div class="settings-subsection">
                    <h3 class="settings-title" data-i18n="about_the_app">📱 About the App</h3>
                    <p class="settings-description" data-i18n="heres_the_deal">
                      Here's the deal: you want to remember what you're watching without needing a PhD in App Navigation. We built this because we got tired of two bad options — messy notes on our phones or bloated apps that make you log your "episode 7 mid-season thoughts." (Hard pass.)
                    </p>
                    <p class="settings-description">
                      <strong>Data Attribution:</strong> This product uses the TMDB API but is not endorsed or certified by TMDB.
                    </p>
                    <p class="settings-description" data-i18n="so_we_made_this_instead">
                      So we made this instead:
                    </p>
                    <ul style="margin: 16px 0; padding-left: 20px;" class="u-fg">
                      <li style="margin-bottom: 8px;"><strong>Stupidly easy.</strong> Open it, add your show, done.</li>
                      <li style="margin-bottom: 8px;"><strong>Always free at the core.</strong> No paywalls for the basics.</li>
                      <li style="margin-bottom: 8px;"><strong>Friend-proof sharing.</strong> Copy your list and drop it in a text when someone asks, "What should I watch?"</li>
                    </ul>
                    <p class="settings-description" data-i18n="if_you_watch_tv">
                      If you watch TV or movies and don't want to make it a hobby just to track them, this app's for you. Simple lists, zero drama.
                    </p>
                  </div>

                  <!-- Feedback Form -->
                  <div class="settings-subsection">
                    <h3 class="settings-title">💬 <span data-i18n="share_your_thoughts">Share Your Thoughts</span></h3>
                    <p class="settings-description" data-i18n="feedback_working">
                      Share your thoughts! Give us app feedback, tell us what's working (or not), 
                      share a quote for our rotation, make a confession, submit a video (describe your video idea and we'll get back to you), or just vent. We're listening!
                    </p>
                    
                    <form name="feedback" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="settings-form" action="/thank-you" onsubmit="console.log('🔍 Form onsubmit called'); return false;">
                      <input type="hidden" name="form-name" value="feedback" />
                      <input type="hidden" name="theme" id="feedbackThemeInput" />
                      <div style="display: none;">
                        <label>Don't fill this out if you're human: <input name="bot-field" /></label>
                      </div>
                      
                      <!-- Feedback Form -->
                      <div class="settings-control-group">
                        <label for="feedbackMessage" class="settings-label" data-i18n="your_message">Your Message</label>
                        <textarea
                          id="feedbackMessage"
                          name="message"
                          class="settings-textarea"
                          placeholder="Share your thoughts, feedback, quotes, or just vent! We're listening."
                          rows="3"
                          required
                        ></textarea>
                        <p class="settings-hint">Your feedback helps us improve Flicklet. All messages are read and appreciated!</p>
                        <button type="submit" class="btn btn--primary">
                          📤 <span data-i18n="share_it">Share It!</span>
                        </button>
                      </div>
                    </form>
                  </div>
                </section>
              </div>

          <!-- Share Selection Modal -->
          <div id="shareSelectionModal" class="modal-backdrop" style="display: none; z-index: 10000; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);">
            <div class="modal share-modal" style="max-width: 800px; max-height: 80vh; z-index: 10001; position: relative; background: white; border-radius: 8px; padding: 20px; margin: 20px auto; pointer-events: auto;">
              <h3>🔗 <span data-i18n="share_selected">Share Selected Items</span></h3>
              
              <!-- Select All Controls -->
              <div class="select-all-controls card-surface" style="margin-bottom: 20px; padding: 15px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; pointer-events: auto;">
                    <input type="checkbox" id="selectAllWatching" style="pointer-events: auto; cursor: pointer;" />
                    <strong>📺 <span data-i18n="currently_watching">Currently Watching</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; pointer-events: auto;">
                    <input type="checkbox" id="selectAllWishlist" style="pointer-events: auto; cursor: pointer;" />
                    <strong>📖 <span data-i18n="want_to_watch">Want to Watch</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; pointer-events: auto;">
                    <input type="checkbox" id="selectAllWatched" style="pointer-events: auto; cursor: pointer;" />
                    <strong>✅ <span data-i18n="already_watched">Already Watched</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; pointer-events: auto;">
                    <input type="checkbox" id="selectAllEverything" style="pointer-events: auto; cursor: pointer;" />
                    <strong>🌟 <span data-i18n="select_all_everything">Select Everything</span></strong>
                  </label>
                </div>
              </div>

              <!-- Items Lists -->
              <div class="share-items-container" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px; pointer-events: auto;">
                <!-- Currently Watching -->
                <div class="share-list-section" style="margin-bottom: 20px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px;">
                  <h4 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">📺 <span data-i18n="currently_watching">Currently Watching</span></h4>
                  <div id="shareWatchingList" class="share-items-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;"></div>
                </div>
                
                <!-- Want to Watch -->
                <div class="share-list-section" style="margin-bottom: 20px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px;">
                  <h4 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">📖 <span data-i18n="want_to_watch">Want to Watch</span></h4>
                  <div id="shareWishlistList" class="share-items-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;"></div>
                </div>
                
                <!-- Already Watched -->
                <div class="share-list-section" style="margin-bottom: 20px; padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px;">
                  <h4 style="margin: 0 0 10px 0; font-size: 16px; font-weight: bold;">✅ <span data-i18n="already_watched">Already Watched</span></h4>
                  <div id="shareWatchedList" class="share-items-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;"></div>
                </div>
              </div>

                            <!-- Action Buttons -->
              <div class="modal-actions" style="display: flex; gap: 10px; justify-content: center; pointer-events: auto;">
                <button id="generateShareLinkBtn" class="btn btn--success" style="display: none; pointer-events: auto; cursor: pointer;" onclick="generateShareLinkFromSelected()">
                  📋 <span data-i18n="generate_share_link">Select what to share</span>
                </button>
                <button id="copyShareBtn" class="btn btn--primary" style="display: none; pointer-events: auto; cursor: pointer;" onclick="copyShareList()">
                  📋 Copy
                </button>
                <button id="closeShareModalBtn" class="btn btn--secondary" style="pointer-events: auto; cursor: pointer;" onclick="closeShareSelectionModal()">
                  ✖️ <span data-i18n="close">Close</span>
                </button>
              </div>
            </div>
          </div>
  
          </div>
      </div>

      <!-- FABs - Will be moved to active tab dock by JavaScript -->
      <button id="settingsTab" class="fab-left" data-tab="settings" aria-label="Settings" data-requires-auth>⚙️ <span data-i18n="settings">Settings</span></button>
      <div class="fab-stack">
        <button id="darkModeToggle" class="fab" aria-label="Dark">
          <span id="themeIcon">🌙</span>
        </button>
        <button id="mardiToggle" class="fab" aria-label="Mardi">🎭</button>
      </div>
    </div>

    <!-- Firebase (compat for simplicity) -->
      </main>

    <!-- Firebase must load BEFORE app.js -->
    <!-- ==== SCRIPT ORDER: libraries → config → init your app scripts === -->

<!-- Firebase libs (compat for simplicity) -->

<!-- Firebase v9 CDN Bridge -->

<!-- Auth Diagnostics (temporary) -->

<!-- Initialize Firebase (single, robust initialization) -->

<!-- Persistence is now handled in the main Firebase initialization above -->

    <!-- Config & core helpers (must be available to everything below) -->

    <!-- TMDB Image Utilities (must load before components that use it) -->

    <!-- Component modules (must load before functions that use them) -->

    <!-- Data initialization (localStorage first, then Firestore sync) -->

    <!-- Home wiring system (deterministic rendering) -->

    <!-- Settings wiring system (deterministic settings binding) -->

    <!-- Core functionality (assumes utils/app exist) -->

    <!-- Clean Unified Poster Card System v26.0 -->

    <!-- Utility modules -->
    
    <!-- Performance monitoring -->

    <!-- tmdbGet shim to prevent runtime errors -->

    <!-- Home layout -->

    <!-- Home Layout Guardrails - Immovable Contract Enforcement -->

    <!-- Router -->

    <!-- Feature modules (safe to assume utils/app are ready) -->

    <!-- CURATED_ROWS: defer heavy work until idle (improves mobile TBT) -->
    <script type="module">
      const idle = (fn)=>('requestIdleCallback'in window)?requestIdleCallback(fn,{timeout:1500}):setTimeout(fn,400);
      idle(()=> import('./scripts/curated-rows.js').then(m=>m.init?.()).catch(console.warn));
    </script>

    <!-- Personalized Rows System -->

    <!-- Centralized Add Handler (must load before other handlers) -->

    <!-- UI orchestration (must be last) -->

    <!-- Global Card Actions System -->
    
    <!-- CSV Export System -->

    <!-- Enhanced Share System -->

    <!-- Pro Preview System -->

    <!-- Notifications Test System -->

    <!-- Enhanced Quotes System -->

    <!-- Settings Tie-ins System -->

    <!-- Community Player System -->

    <!-- Community Games -->

    <!-- FlickWord Modal Functions -->

    <!-- Game Cards Modal System -->

    <!-- Daily Trivia Bridge -->

    <!-- Modal Iframe Sizing -->

    <!-- CLEANUP: All test and duplicate scripts removed for production -->
    
    <!-- Fallback search initialization -->

    <!-- Feedback Link Handler -->

    <!-- Episode Tracking Toggle Handler -->

    <!-- Curated Rows Count Setting Handler -->

    <!-- Currently Watching Limit Setting Handler -->

    <!-- Global modal mount, never hidden by tab switching -->
    <div id="modal-root" data-modal-root style="position:relative; z-index:0;"></div>
    
    <!-- FlickWord Modal -->
    <div id="flickwordModal" class="modal" style="display: none;">
      <div class="modal-backdrop" onclick="closeFlickWordModal()"></div>
      <div class="modal-dialog flickword-modal">
        <div class="modal-header">
          <h3 data-i18n="flickword">🎯 FlickWord</h3>
          <button class="modal-close" onclick="closeFlickWordModal()" data-i18n="close_game">×</button>
        </div>
        <div class="modal-content">
          <iframe 
            id="flickwordFrame" 
            src="/features/flickword-v2.html" 
            style="width: 100%; height: 500px; border: none; border-radius: 8px;"
            title="FlickWord Game"
            sandbox="allow-scripts"
          ></iframe>
        </div>
        <div class="modal-actions">
          <button class="btn btn--secondary" onclick="closeFlickWordModal()">Close Game</button>
        </div>
      </div>
    </div>

    <!-- Game Modals -->
    <div class="game-modal" id="modal-flickword" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-flickword-title">
      <div class="gm-overlay" data-close></div>
      <div class="gm-dialog" role="document">
        <header class="gm-header">
          <h3 id="modal-flickword-title" data-i18n="flickword">FlickWord</h3>
          <button class="gm-close" type="button" aria-label="Close" data-close>&times;</button>
        </header>
        <main class="gm-body">
          <iframe 
            id="flickword-game-frame" 
            src="/features/flickword-v2.html" 
            style="width: 100%; height: 100%; border: none; border-radius: 8px;"
            title="FlickWord Game"
            sandbox="allow-scripts"
          ></iframe>
        </main>
      </div>
    </div>

    <div class="game-modal" id="modal-trivia" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modal-trivia-title">
      <div class="gm-overlay" data-close></div>
      <div class="gm-dialog" role="document">
        <header class="gm-header">
          <h3 id="modal-trivia-title" data-i18n="daily_trivia">Daily Trivia</h3>
          <button class="gm-close" type="button" aria-label="Close" data-close>&times;</button>
        </header>
        <main class="gm-body">
          <div id="dailytrivia-game" class="gm-placeholder">[ Daily Trivia game mounts here ]</div>
        </main>
      </div>
    </div>
	
	<!-- Notifications regions (required by notifications.js) -->
<div id="toastRegion" role="status" aria-live="polite" aria-atomic="true" class="toast-region"></div>
<div id="bannerRegion" role="alert" aria-live="assertive" aria-atomic="true" class="banner-region"></div>

          <!-- Verification Script - Remove after testing -->
          </body>
</html>