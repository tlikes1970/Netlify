<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Flicklet - TV & Movie Tracker</title>
    <meta
      name="description"
      content="Search, track, and rate shows & films fast."
    />
    
    <!-- Icons for different platforms -->
    <link rel="icon" href="icons/icon-512.png" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />
    <link rel="manifest" href="manifest.json" />

    <link rel="stylesheet" href="styles/inline-style-01.css?v=desktop-fix2">
    <link rel="stylesheet" href="styles/inline-style-02.css">
    <link rel="stylesheet" href="styles/components.css?v=pro-gate-1">
    <link rel="stylesheet" href="styles/mobile.css?v=mp2.2d">

    <!-- Feature flags and safety guard -->
    <script src="js/flags.js"></script>
    
    <!-- Immediate mobile detection -->
    <script>
      (function() {
        // Check if this is a mobile device
        const isMobileDevice = /iPhone|iPad|iPod|Android|Mobile|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isMobileSize = window.innerWidth <= 768;
        
        if (isMobileDevice && isMobileSize && document.body) {
          document.body.classList.add('mobile-v1');
          console.log('üì± Mobile class applied immediately - iPhone detected');
        }
      })();
    </script>

</head>

  <body>

    <!-- Main Container -->
    <div class="main-container" id="appRoot">
      <header class="header" role="banner" data-lang-layout="inline">
        <!-- New left-side container for username and snarky phrase -->
        <div id="usernameSnarkContainer" style="text-align: left; min-width: 200px;">
          <div id="dynamicUsername" style="font-size: 18px; font-weight: bold; color: #9c27b0; margin-bottom: 4px;">Welcome!</div>
          <div id="dynamicSnark" style="font-size: 14px; color: #7f8c8d; font-style: italic;">Ready to track your shows</div>
        </div>
        
        <div class="header-center">
          <h1 id="welcomeText" class="title" data-i18n="app_title">Flicklet</h1>
          <div id="proBadge" class="pro-badge" style="display: none;">PRO</div>
          <div id="snarkySubtitle" class="subtitle" data-i18n="subtitle">TV & Movie Tracker</div>
          <div id="bingeBanner" class="binge-banner" aria-live="polite"></div>
        </div>
        <div class="user-section">
          <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
            <div id="accountHint" style="font-size: 11px; color: #7f8c8d; text-align: center; opacity: 0.8;"></div>
            <button
              id="accountBtn"
              class="btn secondary"
              title="Sign in / Account"
              aria-label="Account - sign in or manage your account"
            >
              üë§ <span data-i18n="sign_in_account">Sign In</span>
            </button>
            <button id="shareOpenBtn" class="btn secondary" data-share-title="Flicklet ‚Äî My List" data-share-url="" title="Share this page" aria-label="Share this page">
              üîó <span>Share</span>
            </button>
            <select id="langToggle" aria-label="Language" title="Language">
              <option value="en">EN</option>
              <option value="es">ES</option>
            </select>
          </div>
        </div>
      </header>


      <!-- Sticky Top Search -->
      <div class="top-search">

        <div class="search-help">
          <small>üí° <span data-i18n="search_tips">Search tips: Use * for wildcards (e.g., "marvel*" for Marvel shows)</span></small>
          <span class="onboarding-hint">
            <span class="tooltip">Search for any TV show or movie. Try typing "breaking" or "marvel*" to see how wildcards work!</span>
          </span>
          <span class="keyboard-hint">
            <span class="tooltip">
              <strong>Keyboard Shortcuts:</strong><br>
              ‚Ä¢ <kbd>Ctrl/Cmd + K</kbd> - Focus search<br>
              ‚Ä¢ <kbd>Ctrl/Cmd + T</kbd> - Toggle theme<br>
              ‚Ä¢ <kbd>Ctrl/Cmd + M</kbd> - Toggle Mardi Gras<br>
              ‚Ä¢ <kbd>1-5</kbd> - Switch tabs<br>
              ‚Ä¢ <kbd>Esc</kbd> - Clear search
            </span>
          </span>
        </div>
        <div class="search-row">
          <input
            id="searchInput"
            class="search-input search-area-input"
            placeholder=""
            data-i18n-placeholder="search_placeholder"
          />
          <div class="search-controls">
            <select id="genreFilter" class="genre-filter search-area-genre">
              <option value="" data-i18n="all_genres">All Genres</option>
            </select>
            <button id="searchBtn" class="btn search-btn search-area-search" aria-label="Search for TV shows and movies">
              <span class="icon" aria-hidden="true">üîç</span>
              <span class="label" data-i18n="search">Search</span>
            </button>
            <button id="clearSearchBtn" class="btn secondary clear-search-btn search-area-clear" aria-label="Clear search results">
              <span class="icon" aria-hidden="true">‚úñÔ∏è</span>
              <span class="label" data-i18n="clear">Clear</span>
            </button>
            
            <!-- Search Tips Toggle -->
            <div id="searchTips" class="search-tips">
              <button class="tips-trigger" id="tipsTrigger"
                      type="button"
                      aria-label="Search tips"
                      aria-expanded="false"
                      aria-controls="tipsPop">?</button>

              <!-- Popover lives next to trigger, hidden by default -->
              <div class="tips-pop" id="tipsPop" role="dialog" aria-modal="false" hidden>
                <div class="tips-head">
                  <div class="tips-title">Search tips</div>
                  <button class="tips-close" id="tipsClose" aria-label="Close">√ó</button>
                </div>
                <ul class="tips-list">
                  <li><code>"exact phrase"</code> finds an exact title.</li>
                  <li><code>alien year:2025</code> filters by year.</li>
                  <li><code>genre:sci-fi</code> narrows by genre.</li>
                  <li><code>status:watching</code> your current list.</li>
                  <li><code>rating:‚â•4</code> your rating or higher.</li>
                  <li><code>is:movie</code> or <code>is:show</code>.</li>
                </ul>
                <div class="tips-actions">
                  <label class="tips-dontshow">
                    <input id="tipsDontShow" type="checkbox"> Don't show again
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div
          id="tagFilterRow"
          class="tag-filters"
          aria-label="Tag filters"
        >        </div>
      </div>

      <div class="tab-container">
        <button id="homeTab" class="tab active" title="Overview of your TV & movie tracking" aria-label="Home tab - view dashboard and recommendations">üè† <span data-i18n="home">Home</span></button>
        <button id="watchingTab" class="tab" title="Shows and movies you're currently watching" aria-label="Watching tab - view shows and movies you're currently watching">
          ‚ñ∂Ô∏è <span data-i18n="currently_watching">Currently Watching</span>
          <span class="tab-badge" id="watchingBadge">0</span>
        </button>
        <button id="wishlistTab" class="tab" title="Shows and movies you want to watch later" aria-label="Wishlist tab - view shows and movies you want to watch">
          üìñ <span data-i18n="want_to_watch">Want to Watch</span>
          <span class="tab-badge" id="wishlistBadge">0</span>
        </button>
        <button id="watchedTab" class="tab" title="Shows and movies you've already finished" aria-label="Watched tab - view shows and movies you've completed">
          ‚úÖ <span data-i18n="already_watched">Already Watched</span>
          <span class="tab-badge" id="watchedBadge">0</span>
        </button>
        <button id="discoverTab" class="tab" title="Get personalized recommendations based on your taste" aria-label="Discover tab - find new shows and movies">‚ú® <span data-i18n="discover">Discover</span></button>
      </div>

          <!-- Curated Sections -->
    <section id="curatedSections" class="curated-sections" aria-label="Curated lists">
      <!-- Populated by curated-rows.js -->
    </section>
    
    <!-- Curated Sections Indicator -->
    <div id="curatedSectionsIndicator" class="curated-indicator" style="text-align: center; font-size: 0.9em; color: #666; margin: 10px 0; padding: 5px; background: #f5f5f5; border-radius: 4px;">
      <!-- Populated by curated-rows.js -->
    </div>

    <!-- Trivia (daily) -->
    <section id="triviaTile" class="trivia-card" aria-labelledby="triviaTitle">
      <div class="trivia-head">
        <h2 id="triviaTitle">Trivia</h2>
        <div class="trivia-stats" aria-live="polite" aria-atomic="true"></div>
      </div>
      <div class="trivia-body">
        <div class="trivia-question" id="triviaQuestion"></div>
        <ul class="trivia-choices" id="triviaChoices" role="listbox"></ul>
        <div class="trivia-feedback" id="triviaFeedback" aria-live="polite"></div>
        <div class="trivia-actions">
          <button class="btn" id="triviaNextBtn" hidden>Next</button>
        </div>
      </div>
    </section>
	
	<!-- Spotlight video (placeholder; module will populate if enabled) -->
<section id="videoSpotlight" class="home-section" hidden></section>

<!-- FlickWord quote/cta (placeholder; module will populate if enabled) -->
<section id="quote-flickword-container" class="home-section" hidden></section>


    <!-- Daily Video Spotlight -->
    <section id="videoSpotlight" class="spotlight-card" aria-labelledby="spotlightTitle">
      <div class="spotlight-head">
        <h2 id="spotlightTitle">Daily Video Spotlight</h2>
        <div class="spotlight-date" aria-live="polite" aria-atomic="true"></div>
      </div>

      <div class="spotlight-media" id="spotlightMedia" role="region" aria-label="Featured video"></div>

      <div class="spotlight-meta">
        <div class="spotlight-title" id="spotlightItemTitle"></div>
        <div class="spotlight-desc" id="spotlightDesc"></div>
        <div class="spotlight-actions">
          <button class="btn" id="spotlightPlayBtn">Play</button>
          <button class="btn" id="spotlightMuteBtn" aria-pressed="true">Unmute</button>
        </div>
      </div>
    </section>

    <!-- Series Organization -->
    <section id="seriesOrg" class="series-block" aria-label="Series organization">
      <!-- JS will render here. To force a specific series, add data-series-id="157239" (Alien: Earth example) -->
    </section>

      <!-- Quote of the Day and FlickWord Container -->
      <div class="quote-flickword-container">
        <div class="left-column">
          <div id="quoteCard" class="quote-card">
            <h3 class="quote-title">üí≠ <span data-i18n="quote_of_the_day">Quote of the Day</span></h3>
            <div class="quote-content" id="dailyQuote">
              <p class="quote-text">"The best way to predict the future is to create it."</p>
              <p class="quote-author">- Peter Drucker</p>
            </div>
          </div>
          <div id="randomQuoteCard" class="random-quote-card">
            <h3 class="quote-title">üé≤ <span data-i18n="random_quote">Random Quote</span></h3>
            <div class="quote-content" id="randomQuote">
              <p class="quote-text">"One does not simply watch one episode."</p>
              <p class="quote-author">- Some dude</p>
            </div>
          </div>
        </div>
        <div id="flickwordCard" class="flickword-card">
          <h3 class="flickword-title">üéØ <span data-i18n="flickword_daily_challenge">FlickWord Daily Challenge</span></h3>
          <div class="flickword-timer-section">
            <div class="flickword-countdown" id="fwCountdown">00:00:00</div>
            <div class="flickword-motivation" id="flickwordMotivation"><span data-i18n="hours_left_motivation">Hours left to play today's game!</span></div>
          </div>
          <div class="flickword-stats">
            <div class="stat-item">
              <span class="stat-label">üî• <span data-i18n="streak">STREAK</span></span>
              <span class="stat-value" id="fwStreak">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üèÜ <span data-i18n="best">BEST</span></span>
              <span class="stat-value" id="fwBest">-</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üìä <span data-i18n="played">PLAYED</span></span>
              <span class="stat-value" id="fwPlayed">0</span>
            </div>
          </div>
          <div class="flickword-actions">
            <button id="fwPlayBtn" class="btn primary" data-i18n="play_todays_word">Play Today's Word</button>
          </div>
        </div>
      </div>

      <!-- FlickWord Modal -->
      <div id="fwModal" class="fw-modal" style="display: none;">
        <div class="fw-modal-content">
          <div class="fw-modal-header" id="fwModalHeader">
            <div class="fw-modal-title">FlickWord</div>
            <div class="fw-modal-controls">
              <button id="fwMinimize" class="fw-control-btn minimize" title="Minimize">‚àí</button>
              <button id="fwMaximize" class="fw-control-btn maximize" title="Maximize">‚ñ°</button>
              <button id="fwClose" class="fw-control-btn close" title="Close">&times;</button>
            </div>
          </div>
          <iframe id="fwFrame" src="" frameborder="0"></iframe>
        </div>
      </div>

      <!-- Results -->
      <div id="searchResults" class="section" style="display: none">
                  <h3>
            üéØ <span data-i18n="search_results">Search Results</span> <span class="count" id="resultsCount">0</span>
          </h3>
        <div id="searchResultsList" class="list-container"></div>
      </div>

      <!-- Home -->
      <div id="homeSection" class="tab-section">
        <div class="stats">
          <div class="stat" id="bingeMeter"></div>
        </div>
        
        <!-- Stats Section -->
        <div id="statsBasicBody" data-i18n="loading">Loading‚Ä¶</div>
        <div id="statsPro" style="display: none;">
          <div id="statsProBody"></div>
        </div>
      </div>

      <main id="main" role="main">

      <!-- Watching -->
      <div id="watchingSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ‚ñ∂Ô∏è <span data-i18n="currently_watching">Currently Watching</span>
              <span class="count" id="watchingCount">0</span>
            </h3>
          </div>
          <div id="watchingList" class="list-container"></div>
        </div>
      </div>

      <!-- Wishlist -->
      <div id="wishlistSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              üìñ <span data-i18n="want_to_watch">Want to Watch</span>
              <span class="count" id="wishlistCount">0</span>
            </h3>
          </div>
          <div id="wishlistList" class="list-container"></div>
        </div>
      </div>

      <!-- Watched -->
      <div id="watchedSection" class="tab-section" style="display: none">
        <div class="section">
          <div class="section-header">
            <h3>
              ‚úÖ <span data-i18n="already_watched">Already Watched</span>
              <span class="count" id="watchedCount">0</span>
            </h3>
          </div>
          <div id="watchedList" class="list-container"></div>
        </div>
      </div>

      <!-- Discover -->
              <div id="discoverSection" class="tab-section" style="display: none">
          <div class="section">
            <h3>‚ú® <span data-i18n="discover">Discover</span></h3>
            <p data-i18n="discover_description">Recommendations based on your likes and ratings.</p>
            <div id="discoverList" class="list-container"></div>
          </div>
        </div>

      <!-- Settings / Profile -->
              <div id="settingsSection" class="tab-section" style="display: none">
              <div class="settings-tabs" role="tablist" aria-label="Settings Sections">
                <button role="tab" aria-selected="true" class="active" data-target="#general">General</button>
                <button role="tab" aria-selected="false" data-target="#notifications">Notifications</button>
                <button role="tab" aria-selected="false" data-target="#layout">Layout</button>
                <button role="tab" aria-selected="false" data-target="#data">Data</button>
                <button role="tab" aria-selected="false" data-target="#pro">Pro</button>
                <button role="tab" aria-selected="false" data-target="#about">About</button>
              </div>

              <div class="settings-container">
                <!-- General Section -->
                <section id="general" class="settings-section active">
                  <div class="settings-subsection">
                    <h3 class="settings-title">‚öôÔ∏è <span data-i18n="general">General</span></h3>
                    <p class="settings-description" data-i18n="general_description">Manage your account and basic preferences</p>
                    
                    <div class="settings-control-group">
                      <label for="displayNameInput" class="settings-label" data-i18n="display_name">Display Name</label>
                      <div class="settings-input-group">
                        <input
                          id="displayNameInput"
                          class="settings-input"
                          placeholder="Enter your name"
                        />
                        <button id="saveNameBtn" class="btn primary" onclick="saveDisplayName()">
                          üíæ <span data-i18n="save">Save</span>
                        </button>
                      </div>
                    </div>
                  </div>

                  <div class="settings-subsection">
                    <h4 class="settings-subtitle">üìä <span data-i18n="my_statistics">My Statistics</span></h4>
                    <div id="statsContent" class="settings-stats">
                      <div class="loading">Loading stats...</div>
                    </div>
                  </div>

                  <div class="settings-subsection">
                    <h4 class="settings-subtitle">üö´ <span data-i18n="not_interested_management">Not Interested Management</span></h4>
                    <p class="settings-description" data-i18n="not_interested_description">Manage shows and movies you've marked as not interested</p>
                    <button id="manageNotInterestedBtn" class="btn" onclick="openNotInterestedModal()">
                      üö´ <span data-i18n="manage_not_interested_list">Manage Not Interested List</span>
                    </button>
                  </div>
                </section>

                <!-- Notifications Section -->
                <section id="notifications" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">üîî <span data-i18n="notifications">Notifications</span></h3>
                    <p class="settings-description" data-i18n="notifications_description">Choose which types of notifications you'd like to receive</p>
                    
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifEpisodes" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="episode_alerts">Upcoming episode alerts</span>
                      </label>
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifDiscover" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="weekly_discover">Weekly discover picks</span>
                      </label>
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="notifDigest" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="monthly_digest">Monthly stats digest</span>
                      </label>
                    </div>
                  </div>
                </section>

                <!-- Layout Section -->
                <section id="layout" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">üé® <span data-i18n="layout_settings">Layout Settings</span></h3>
                    <p class="settings-description" data-i18n="layout_description">Customize how your lists and cards are displayed</p>
                    
                    <div class="settings-control-group">
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="condensedMode" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="condensed_list_view">Condensed list view (more items per screen)</span>
                      </label>
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="showPosters" class="settings-checkbox" checked />
                        <span class="settings-checkbox-text" data-i18n="show_posters">Show movie/TV show posters</span>
                      </label>
                      <label class="settings-checkbox-label">
                        <input type="checkbox" id="darkMode" class="settings-checkbox" />
                        <span class="settings-checkbox-text" data-i18n="dark_mode">Dark mode (auto-detect system preference)</span>
                      </label>
                    </div>

                    <div class="settings-control-group">
                      <label for="settingCuratedRows" class="settings-label" data-i18n="home_page_lists">Home Page TV/Movie Lists</label>
                      <div class="settings-input-group">
                        <input
                          type="number"
                          id="settingCuratedRows"
                          name="curatedRows"
                          min="1"
                          max="3"
                          value="3"
                          class="settings-input settings-input-number"
                        />
                        <span class="settings-hint">(1-3)</span>
                        <span id="curatedRowsStatus" class="settings-status">Auto-saves</span>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- Data Section -->
                <section id="data" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">üíæ <span data-i18n="data_management">Data Management</span></h3>
                    <p class="settings-description" data-i18n="data_description">Export, import, or reset your data</p>
                    
                    <div class="settings-button-group">
                      <button id="exportBtn" class="btn secondary" aria-label="Export data to JSON">
                        üì§ <span data-i18n="export_json">Export JSON</span>
                      </button>
                      <input type="file" id="importInput" accept=".json,application/json" hidden />
                      <button id="importBtn" class="btn secondary" aria-label="Import data from JSON">
                        üì• <span data-i18n="import_json">Import JSON</span>
                      </button>
                      <button class="btn" data-pro="required" data-pro-mode="disable" data-pro-feature="extra-trivia">
                        üß† <span data-i18n="extra_trivia_pro">Extra Trivia (Pro)</span>
                      </button>
                      <button class="btn" data-pro="required" data-pro-mode="hide" data-pro-feature="export-csv">
                        üìä <span data-i18n="export_csv_pro">Export CSV (Pro)</span>
                      </button>
                      <button id="resetBtn" class="btn danger" aria-label="Reset all data (requires confirmation)">
                        üóëÔ∏è <span data-i18n="reset_all_data">Reset All Data</span>
                      </button>
                    </div>
                    
                    <p class="settings-hint" data-i18n="data_hint">
                      Export saves <code>flicklet-export.json</code> to your device's Downloads/Files. 
                      Import accepts a valid Flicklet export.
                    </p>
                  </div>
                </section>

                <!-- Pro Section -->
                <section id="pro" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">‚≠ê <span data-i18n="pro_features">Pro Features</span></h3>
                    <p class="settings-description" data-i18n="pro_description">
                      Unlock advanced features and premium content with Flicklet Pro
                    </p>
                    
                    <div class="settings-control-group">
                      <button id="previewProBtn" class="btn primary" onclick="toggleProPreview()">
                        ‚≠ê <span data-i18n="preview_pro_features">Preview Pro Features</span>
                      </button>
                      <p class="settings-hint" data-i18n="pro_hint">Toggle Pro features on/off to see what's available</p>
                    </div>

                    <div class="settings-control-group">
                      <h4 class="settings-subtitle">‚ú® <span data-i18n="pro_features_include">Pro Features Include:</span></h4>
                      <div id="proFeaturesList" class="settings-pro-features">
                        <!-- Dynamic Pro features list will be rendered here -->
                      </div>
                    </div>
                  </div>
                </section>

                <!-- About Section -->
                <section id="about" class="settings-section">
                  <div class="settings-subsection">
                    <h3 class="settings-title">üí¨ <span data-i18n="share_your_thoughts">Share Your Thoughts</span></h3>
                    <p class="settings-description" data-i18n="feedback_working">
                      Share your thoughts! Give us app feedback, tell us what's working (or not), 
                      share a quote for our rotation, make a confession, or just vent. We're listening!
                    </p>
                    
                    <form name="feedback" method="POST" data-netlify="true" netlify-honeypot="bot-field" class="settings-form" action="/thank-you">
                      <input type="hidden" name="form-name" value="feedback" />
                      <input type="hidden" name="theme" id="feedbackThemeInput" />
                      <div style="display: none;">
                        <label>Don't fill this out if you're human: <input name="bot-field" /></label>
                      </div>
                      
                      <div class="settings-control-group">
                        <label for="feedbackMessage" class="settings-label" data-i18n="your_message">Your Message</label>
                        <textarea
                          id="feedbackMessage"
                          name="message"
                          class="settings-textarea"
                          placeholder="Share your thoughts, feedback, quotes, or just vent! We're listening."
                          rows="3"
                          required
                        ></textarea>
                        <button type="submit" class="btn primary">
                          üì§ <span data-i18n="share_it">Share It!</span>
                        </button>
                      </div>
                    </form>
                  </div>
                </section>
              </div>

          <!-- Share Selection Modal -->
          <div id="shareSelectionModal" class="modal-backdrop" style="display: none;">
            <div class="modal share-modal" style="max-width: 800px; max-height: 80vh;">
              <h3>üîó <span data-i18n="share_selected">Share Selected Items</span></h3>
              
              <!-- Select All Controls -->
              <div class="select-all-controls" style="margin-bottom: 20px; padding: 15px; background: var(--card); border-radius: 8px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                  <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="selectAllWatching" />
                    <strong>üì∫ <span data-i18n="currently_watching">Currently Watching</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="selectAllWishlist" />
                    <strong>üìñ <span data-i18n="want_to_watch">Want to Watch</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="selectAllWatched" />
                    <strong>‚úÖ <span data-i18n="already_watched">Already Watched</span></strong>
                  </label>
                  <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="selectAllEverything" />
                    <strong>üåü <span data-i18n="select_all_everything">Select All Everything</span></strong>
                  </label>
                </div>
              </div>

              <!-- Items Lists -->
              <div class="share-items-container" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Currently Watching -->
                <div class="share-list-section">
                  <h4>üì∫ <span data-i18n="currently_watching">Currently Watching</span></h4>
                  <div id="shareWatchingList" class="share-items-list"></div>
                </div>
                
                <!-- Want to Watch -->
                <div class="share-list-section">
                  <h4>üìñ <span data-i18n="want_to_watch">Want to Watch</span></h4>
                  <div id="shareWishlistList" class="share-items-list"></div>
                </div>
                
                <!-- Already Watched -->
                <div class="share-list-section">
                  <h4>‚úÖ <span data-i18n="already_watched">Already Watched</span></h4>
                  <div id="shareWatchedList" class="share-items-list"></div>
                </div>
              </div>

                            <!-- Action Buttons -->
              <div class="modal-actions" style="display: flex; gap: 10px; justify-content: center;">
                <button id="generateShareLinkBtn" class="btn success" style="display: none;" onclick="generateShareLinkFromSelected()">
                  üìã <span data-i18n="generate_share_link">Select what to share</span>
                </button>
                <button id="copyShareBtn" class="btn primary" style="display: none;" onclick="copyShareList()">
                  üìã Copy
                </button>
                <button id="closeShareModalBtn" class="btn secondary">
                  ‚úñÔ∏è <span data-i18n="close">Close</span>
                </button>
              </div>
            </div>
          </div>
  
          </div>
      </div>
    </div>

    <!-- Firebase (compat for simplicity) -->
      </main>

    <!-- Floating Action Buttons - Outside main container -->
    <button id="mardiToggle" class="fab" aria-label="Mardi">üé≠</button>
    <button id="darkModeToggle" class="fab" aria-label="Dark">
      <span id="themeIcon">üåô</span>
    </button>
    <button id="settingsTab" class="fab-left" data-tab="settings" aria-label="Settings">‚öôÔ∏è</button>

    <!-- Firebase must load BEFORE app.js -->
        <!-- ==== SCRIPT ORDER: libraries ‚Üí core ‚Üí features ‚Üí UI glue ==== -->

    <!-- Firebase libs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
	
	<!-- Your project config (REQUIRED) -->
<script src="firebase-config.js"></script>

    <!-- Config & core helpers (must be available to everything below) -->
    <script src="tmdb-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/flags.js"></script>
    <script src="js/app.js"></script>
    <script src="js/bootstrap.js"></script>

    <!-- Core functionality (assumes utils/app exist) -->
    <script src="scripts/auth.js"></script>
    <script src="scripts/notifications.js"></script>
    <script src="js/functions.js"></script>

    <!-- Feature modules (safe to assume utils/app are ready) -->
    <script src="scripts/curated-rows.js"></script>
    <script src="scripts/curated-seed.js"></script>
    <script src="scripts/spotlight.js"></script>
    <script src="scripts/list-actions.js"></script>
    <script src="scripts/share-modal.js"></script>
    <script src="scripts/search-tips.js"></script>
    <script src="scripts/series-org.js"></script>
    <script src="scripts/trivia.js"></script>
    <script src="scripts/tmdb-seed.js"></script>
    <script src="scripts/pro-gate.js"></script>
    <script src="js/language-manager.js"></script>
    <script src="js/i18n.js"></script>

    <!-- UI orchestration (must be last) -->
    <script src="scripts/inline-script-01.js"></script>
    <script src="scripts/inline-script-02.js"></script>
    <script src="scripts/inline-script-03.js"></script>

    
    <!-- Curated Rows Count Setting Handler -->
    <script>
    (function(){
      console.log('üîß Curated rows setting handler starting...');
      
      let input = null;
      let debounceTimer;
      
      // Function to find and setup the input
      function setupInput() {
        // If already set up, don't do it again
        if (input && input.dataset.setupComplete) {
          console.log('üîß Input already set up, skipping');
          return true;
        }
        
        input = document.querySelector('#settingCuratedRows, [name="curatedRows"]');
        console.log('üîß Input found:', !!input, input);
        if (!input) {
          console.warn('üîß Curated rows input not found, will retry...');
          return false;
        }
        
        // Load saved value
        const stored = localStorage.getItem('flicklet:curated:rows');
        console.log('üîß Stored value:', stored);
        if (stored) input.value = stored;
        
        // Function to apply the setting
        function applySetting() {
          console.log('üîß applySetting called with value:', input.value);
          const n = Math.max(1, Math.min(10, Number(input.value)||3));
          console.log('üîß Setting curated rows to:', n);
          localStorage.setItem('flicklet:curated:rows', String(n));
          document.dispatchEvent(new CustomEvent('curated:rerender'));
          console.log('üîß Dispatched curated:rerender event');
          
          // Show immediate feedback
          if (window.showNotification) {
            window.showNotification(`‚úÖ Showing ${n} TV/Movie list${n>1?'s':''}`, 'success');
          }
          
          // Visual feedback on the input
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = '#f0fdf4';
          
          // Update status indicator
          const status = document.getElementById('curatedRowsStatus');
          if (status) {
            status.textContent = '‚úÖ Saved';
            status.style.color = '#10b981';
            setTimeout(() => {
              status.textContent = 'Auto-saves';
              status.style.color = '';
            }, 2000);
          }
          
          setTimeout(() => {
            input.style.borderColor = '';
            input.style.backgroundColor = '';
          }, 1000);
        }
        
        // Debounced function for input events
        function debouncedApply() {
          console.log('üîß debouncedApply called');
          clearTimeout(debounceTimer);
          debounceTimer = setTimeout(applySetting, 300);
        }
        
        // Apply immediately on change/blur, debounced on input
        input.addEventListener('input', debouncedApply);
        input.addEventListener('change', applySetting);
        input.addEventListener('blur', applySetting);
        
        // Test if input is responsive
        input.addEventListener('click', () => console.log('üîß Input clicked'));
        input.addEventListener('focus', () => console.log('üîß Input focused'));
        
        console.log('üîß Event listeners attached to input');
        
        // Mark as set up to prevent duplicate setup
        input.dataset.setupComplete = 'true';
        
        // Test the input
        setTimeout(() => {
          if (input.offsetParent === null) {
            console.log('üîß Input is hidden - user needs to go to Settings > Layout tab to see it');
          } else {
            console.log('üîß Input is visible and ready');
          }
        }, 1000);
        
        return true;
      }
      
      // Try to setup immediately
      if (!setupInput()) {
        // If not found, retry every 500ms for up to 10 seconds
        let retries = 0;
        const retryInterval = setInterval(() => {
          retries++;
          console.log('üîß Retrying to find input, attempt:', retries);
          if (setupInput() || retries >= 20) {
            clearInterval(retryInterval);
            if (retries >= 20) {
              console.warn('üîß Failed to find input after 20 attempts');
            }
          }
        }, 500);
      }
      
      // Also listen for when the Layout tab becomes active
      document.addEventListener('DOMContentLoaded', () => {
        // Listen for tab changes to re-setup the input if needed
        const layoutSection = document.querySelector('#layout');
        if (layoutSection) {
          // Use MutationObserver to detect when the section becomes active
          const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                const isActive = layoutSection.classList.contains('active');
                if (isActive && !input) {
                  console.log('üîß Layout section became active, re-setting up input');
                  setupInput();
                }
              }
            });
          });
          
          observer.observe(layoutSection, { attributes: true, attributeFilter: ['class'] });
        }
        
        // Also listen for the settings tabs initialization
        const checkForTabs = setInterval(() => {
          if (document.querySelector('.settings-tabs button[data-target="#layout"]')) {
            console.log('üîß Settings tabs found, setting up layout tab listener');
            clearInterval(checkForTabs);
            
            const layoutTab = document.querySelector('.settings-tabs button[data-target="#layout"]');
            if (layoutTab) {
              layoutTab.addEventListener('click', () => {
                console.log('üîß Layout tab clicked, ensuring input is set up');
                setTimeout(() => {
                  if (!input) {
                    console.log('üîß Input not found, setting up...');
                    setupInput();
                  } else {
                    console.log('üîß Input already exists, checking visibility...');
                    console.log('üîß Input visible?', input.offsetParent !== null);
                    console.log('üîß Input parent visible?', input.parentElement?.offsetParent !== null);
                    console.log('üîß Input parent classes:', input.parentElement?.className);
                    console.log('üîß Input parent parent classes:', input.parentElement?.parentElement?.className);
                    
                    // Test if we can trigger the input change manually
                    console.log('üîß Testing manual input change...');
                    input.value = '1';
                    input.dispatchEvent(new Event('change'));
                  }
                }, 100);
              });
            }
          }
        }, 500);
        
        // Stop checking after 10 seconds
        setTimeout(() => clearInterval(checkForTabs), 10000);
      });
      
    })();
    </script>
    
    <!-- Global modal mount, never hidden by tab switching -->
    <div id="modal-root" data-modal-root style="position:relative; z-index:0;"></div>
	
	<!-- Notifications regions (required by notifications.js) -->
<div id="toastRegion" role="status" aria-live="polite" aria-atomic="true" class="toast-region"></div>
<div id="bannerRegion" role="alert" aria-live="assertive" aria-atomic="true" class="banner-region"></div>

  </body>
</html>