<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase B Verification - TV Tracker</title>
    <style>
        body {
            font-family: Inter, system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-weight: 500;
        }
        .test-pass { background: #d1fae5; color: #065f46; }
        .test-fail { background: #fee2e2; color: #991b1b; }
        .test-warning { background: #fef3c7; color: #92400e; }
        .test-info { background: #dbeafe; color: #1e40af; }
        .summary {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .metric:last-child { border-bottom: none; }
        .metric-value {
            font-weight: 600;
        }
        .metric-pass { color: #059669; }
        .metric-fail { color: #dc2626; }
        .metric-warning { color: #d97706; }
    </style>
</head>
<body>
    <h1>Phase B Verification Tests</h1>
    <p>Testing staging-clean/www improvements on localhost:8080</p>
    
    <div class="test-container">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>
    
    <div class="summary">
        <h2>Summary</h2>
        <div id="summary-metrics"></div>
    </div>

    <script>
        const testResults = [];
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        let warningTests = 0;

        function addTest(name, passed, message, details = '') {
            totalTests++;
            if (passed) passedTests++;
            else if (message.includes('WARNING')) warningTests++;
            else failedTests++;
            
            testResults.push({ name, passed, message, details });
        }

        function logResult(name, passed, message, details = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'test-pass' : (message.includes('WARNING') ? 'test-warning' : 'test-fail')}`;
            resultDiv.innerHTML = `
                <strong>${passed ? '‚úÖ' : (message.includes('WARNING') ? '‚ö†Ô∏è' : '‚ùå')} ${name}</strong><br>
                ${message}
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            document.getElementById('test-results').appendChild(resultDiv);
        }

        async function runTests() {
            console.log('üß™ Starting Phase B Verification Tests...');
            
            try {
                // Test 1: Version Number
                console.log('Testing version number...');
                const response = await fetch('http://localhost:8080/index.html');
                const html = await response.text();
                
                if (html.includes('v23.84')) {
                    addTest('Version Number', true, 'Version updated to v23.84-PHASE-B-COMPLETE');
                    logResult('Version Number', true, 'Version updated to v23.84-PHASE-B-COMPLETE');
                } else {
                    addTest('Version Number', false, 'Version not updated - still shows older version');
                    logResult('Version Number', false, 'Version not updated - still shows older version');
                }

                // Test 2: Critical CSS Inlined
                console.log('Testing critical CSS...');
                if (html.includes('/* Critical CSS - Above the fold styles */')) {
                    addTest('Critical CSS', true, 'Critical CSS properly inlined in head');
                    logResult('Critical CSS', true, 'Critical CSS properly inlined in head');
                } else {
                    addTest('Critical CSS', false, 'Critical CSS not found inlined');
                    logResult('Critical CSS', false, 'Critical CSS not found inlined');
                }

                // Test 3: Async CSS Loading
                console.log('Testing async CSS loading...');
                const asyncCssCount = (html.match(/rel="preload".*as="style".*onload/g) || []).length;
                if (asyncCssCount >= 6) {
                    addTest('Async CSS Loading', true, `Found ${asyncCssCount} async CSS files`);
                    logResult('Async CSS Loading', true, `Found ${asyncCssCount} async CSS files`);
                } else {
                    addTest('Async CSS Loading', false, `Only found ${asyncCssCount} async CSS files (expected 6+)`);
                    logResult('Async CSS Loading', false, `Only found ${asyncCssCount} async CSS files (expected 6+)`);
                }

                // Test 4: Script Deferring
                console.log('Testing script deferring...');
                const deferredScripts = (html.match(/<script.*defer/g) || []).length;
                if (deferredScripts >= 5) {
                    addTest('Script Deferring', true, `Found ${deferredScripts} deferred scripts`);
                    logResult('Script Deferring', true, `Found ${deferredScripts} deferred scripts`);
                } else {
                    addTest('Script Deferring', false, `Only found ${deferredScripts} deferred scripts (expected 5+)`);
                    logResult('Script Deferring', false, `Only found ${deferredScripts} deferred scripts (expected 5+)`);
                }

                // Test 5: Contrast Tokens
                console.log('Testing contrast tokens...');
                const cssResponse = await fetch('http://localhost:8080/styles/components.css');
                const css = await cssResponse.text();
                
                const contrastIssues = [];
                if (!css.includes('--muted: #374151')) contrastIssues.push('--muted not updated to #374151');
                if (!css.includes('--text-secondary: #374151')) contrastIssues.push('--text-secondary not found');
                if (!css.includes('--badge-text: #1f2937')) contrastIssues.push('--badge-text not found');
                if (!css.includes('--meta-text: #374151')) contrastIssues.push('--meta-text not found');
                
                if (contrastIssues.length === 0) {
                    addTest('Contrast Tokens', true, 'All contrast tokens updated for WCAG AA compliance');
                    logResult('Contrast Tokens', true, 'All contrast tokens updated for WCAG AA compliance');
                } else {
                    addTest('Contrast Tokens', false, `Contrast issues: ${contrastIssues.join(', ')}`);
                    logResult('Contrast Tokens', false, `Contrast issues: ${contrastIssues.join(', ')}`);
                }

                // Test 6: Mobile Font Sizes
                console.log('Testing mobile font sizes...');
                const mobileCssResponse = await fetch('http://localhost:8080/styles/mobile.css');
                const mobileCss = await mobileCssResponse.text();
                
                if (mobileCss.includes('font-size: 16px !important') && mobileCss.includes('font-size: 12px !important')) {
                    addTest('Mobile Font Sizes', true, 'Mobile font size enforcement added (16px base, 12px clamped)');
                    logResult('Mobile Font Sizes', true, 'Mobile font size enforcement added (16px base, 12px clamped)');
                } else {
                    addTest('Mobile Font Sizes', false, 'Mobile font size enforcement not found');
                    logResult('Mobile Font Sizes', false, 'Mobile font size enforcement not found');
                }

                // Test 7: ARIA Hygiene
                console.log('Testing ARIA hygiene...');
                if (!css.includes('aria-live: polite')) {
                    addTest('ARIA Hygiene', true, 'Prohibited aria-live removed from CSS');
                    logResult('ARIA Hygiene', true, 'Prohibited aria-live removed from CSS');
                } else {
                    addTest('ARIA Hygiene', false, 'Prohibited aria-live still found in CSS');
                    logResult('ARIA Hygiene', false, 'Prohibited aria-live still found in CSS');
                }

                // Test 8: Build System
                console.log('Testing build system...');
                const buildResponse = await fetch('http://localhost:8080/build.js');
                if (buildResponse.ok) {
                    addTest('Build System', true, 'Production build script created');
                    logResult('Build System', true, 'Production build script created');
                } else {
                    addTest('Build System', false, 'Build script not found');
                    logResult('Build System', false, 'Build script not found');
                }

                // Test 9: Focus Styles
                console.log('Testing focus styles...');
                if (css.includes(':focus-visible') && css.includes('outline: 2px solid')) {
                    addTest('Focus Styles', true, 'Enhanced focus-visible styles found');
                    logResult('Focus Styles', true, 'Enhanced focus-visible styles found');
                } else {
                    addTest('Focus Styles', false, 'Enhanced focus styles not found');
                    logResult('Focus Styles', false, 'Enhanced focus styles not found');
                }

                // Test 10: Performance Optimizations
                console.log('Testing performance optimizations...');
                const perfChecks = [];
                if (html.includes('rel="preload"')) perfChecks.push('CSS preloading');
                if (html.includes('defer')) perfChecks.push('Script deferring');
                if (html.includes('/* Critical CSS')) perfChecks.push('Critical CSS inlining');
                
                if (perfChecks.length >= 3) {
                    addTest('Performance Optimizations', true, `Found: ${perfChecks.join(', ')}`);
                    logResult('Performance Optimizations', true, `Found: ${perfChecks.join(', ')}`);
                } else {
                    addTest('Performance Optimizations', false, `Only found: ${perfChecks.join(', ')}`);
                    logResult('Performance Optimizations', false, `Only found: ${perfChecks.join(', ')}`);
                }

            } catch (error) {
                console.error('Test error:', error);
                addTest('Connection', false, `Failed to connect to localhost:8080: ${error.message}`);
                logResult('Connection', false, `Failed to connect to localhost:8080: ${error.message}`);
            }

            // Generate summary
            generateSummary();
        }

        function generateSummary() {
            const summaryDiv = document.getElementById('summary-metrics');
            
            const metrics = [
                { label: 'Total Tests', value: totalTests, class: 'test-info' },
                { label: 'Passed', value: passedTests, class: passedTests > 0 ? 'metric-pass' : 'metric-fail' },
                { label: 'Failed', value: failedTests, class: failedTests > 0 ? 'metric-fail' : 'metric-pass' },
                { label: 'Warnings', value: warningTests, class: warningTests > 0 ? 'metric-warning' : 'metric-pass' },
                { label: 'Success Rate', value: `${Math.round((passedTests / totalTests) * 100)}%`, class: (passedTests / totalTests) >= 0.8 ? 'metric-pass' : 'metric-fail' }
            ];

            metrics.forEach(metric => {
                const metricDiv = document.createElement('div');
                metricDiv.className = 'metric';
                metricDiv.innerHTML = `
                    <span>${metric.label}</span>
                    <span class="metric-value ${metric.class}">${metric.value}</span>
                `;
                summaryDiv.appendChild(metricDiv);
            });

            // Overall status
            const overallStatus = failedTests === 0 ? 'PASS' : 'FAIL';
            const statusDiv = document.createElement('div');
            statusDiv.className = 'metric';
            statusDiv.innerHTML = `
                <span><strong>Overall Status</strong></span>
                <span class="metric-value ${overallStatus === 'PASS' ? 'metric-pass' : 'metric-fail'}">${overallStatus}</span>
            `;
            summaryDiv.appendChild(statusDiv);

            console.log(`\nüìä Phase B Verification Complete:`);
            console.log(`‚úÖ Passed: ${passedTests}/${totalTests}`);
            console.log(`‚ùå Failed: ${failedTests}/${totalTests}`);
            console.log(`‚ö†Ô∏è  Warnings: ${warningTests}/${totalTests}`);
            console.log(`üìà Success Rate: ${Math.round((passedTests / totalTests) * 100)}%`);
            console.log(`üéØ Overall: ${overallStatus}`);
        }

        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>
