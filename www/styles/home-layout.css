/* Home Layout System - Token-Driven, Container Query, RTL-Safe */
/* Load AFTER main.css to override layout rules */

/* ===== CSS ARCHITECTURE GUARD ===== */
/*
 * SINGLE SOURCE OF TRUTH: This file contains ALL home page layout rules
 * 
 * CRITICAL RULES:
 * 1. NO other CSS file should contain home layout rules
 * 2. All home page styling must be defined here
 * 3. Use design tokens (--home-gutter, --rail-col-w, etc.)
 * 4. Follow the established pattern: Frame → Panels → Rails → Cards → Actions
 * 
 * FORBIDDEN: Adding home layout rules to main.css, components.css, or mobile.css
 * 
 * If you need to modify home layout:
 * 1. Edit this file ONLY
 * 2. Use proper CSS specificity
 * 3. Test that no other file conflicts
 * 4. Update this comment if architecture changes
 */

/* === DESIGN TOKENS === */
:root {
  /* Frame gutters */
  --home-gutter: 32px;
  
  /* Home loading states */
  --home-min-height: 400px;
  
  /* Rail sizing */
  --rail-col-w: 260px;
  --rail-col-w-sm: 200px;
  --rail-gap: 16px;
  
  /* Breakpoints (canonical) */
  --bp-xs: 480px;
  --bp-sm: 640px;
  --bp-md: 768px;
  --bp-lg: 1024px;
  --bp-xl: 1280px;
}

/* === SEARCH CONTAINER FIX === */
/* ✅ Fix: ensure search bar stays visible and sticky on home tab */
#appRoot.has-search #search-container,
#appRoot.has-search .top-search,
body.has-search #search-container,
body.has-search .top-search {
  display: block !important;
  position: sticky !important;
  top: 0 !important;
  z-index: 1000 !important;
  height: auto;
  min-height: 48px;
}

/* === FRAME NORMALIZATION === */
/* Wrappers: width 100%, no padding */
#homeSection, 
.home-content, 
main#panels { 
  box-sizing: border-box; 
  width: 100%; 
  max-width: none; 
  min-height: var(--home-min-height); /* Prevent layout shift during loading */
}

/* Smooth section appearance */
#homeSection .section {
  transition: opacity 0.2s ease-in-out;
}

/* Top-level group wrappers: fill width; zero inner L/R padding */
#group-1-your-shows.home-group,
#group-2-community.home-group,
#group-3-for-you.home-group,
#group-4-theaters.home-group,
#group-5-feedback.home-group {
  box-sizing: border-box;
  width: 100%;
  max-width: none;
  margin-inline: 0;
  padding-inline: 0; /* kill double gutters */
}

/* === PANELS OWN THE SINGLE GUTTER === */
/* Apply 32px left/right padding to all Home panels */
#homeSection .home-preview-row,
#homeSection .section-content,
#group-1-your-shows section,
#group-2-community section {
  padding-left: var(--home-gutter, 32px);
  padding-right: var(--home-gutter, 32px);
}

/* === RAILS: GRID COLUMN-FLOW WITH ZERO PADDING === */
/* Deepest rails are grid with column flow, zero padding, scroll on X only */
:is(#group-1-your-shows,
    #group-2-community,
    #group-3-for-you,
    #group-4-theaters,
    #group-5-feedback)
  :is(.preview-row-container, .preview-row-scroll, .row-inner, #currentlyWatchingScroll, .curated-row) {
  box-sizing: border-box;
  display: grid;
  grid-auto-flow: column;                   /* lay items left→right (RTL flips logically) */
  grid-auto-columns: var(--rail-col-w);
  gap: var(--rail-gap);
  padding: 0;                               /* zero rail padding */
  min-width: 0;
  overflow-x: auto;                         /* scroll on X only */
  overflow-y: hidden;
  scroll-snap-type: inline mandatory;
}

/* === DEEP RAIL GRID RULES === */
/* Cover both variants we saw: #currentlyWatchingScroll and .preview-row-scroll */
#homeSection #currentlyWatchingScroll,
#homeSection .preview-row-scroll {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--rail-col-w, 224px);
  gap: var(--rail-gap, 12px);
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: inline mandatory;
  padding: 0;
}

#homeSection #currentlyWatchingScroll > *,
#homeSection .preview-row-scroll > * { 
  scroll-snap-align: start; 
}

/* Responsive rail sizing */
@media (max-width: var(--bp-md)) {
  :is(#group-1-your-shows,
      #group-2-community,
      #group-3-for-you,
      #group-4-theaters,
      #group-5-feedback)
    :is(.preview-row-container, .preview-row-scroll, .row-inner, #currentlyWatchingScroll, .curated-row) {
    grid-auto-columns: var(--rail-col-w-sm);
  }
}

/* === CARD SNAP TARGETS === */
/* Cards snap cleanly and don't exceed panel width */
#homeSection .card { 
  scroll-snap-align: start; 
  min-width: 0; 
}

#homeSection .card img, 
#homeSection .card picture { 
  display: block; 
  max-width: 100%; 
}

/* === ACTION BUTTONS: 2x2 GRID, NO LABEL CLIPPING === */
/* Actions: container-query first, flex fallback; no mid-word splits */
#homeSection :is(.actions, .card-actions) {
  display: grid;
  grid-template-columns: 1fr;          /* default: single column */
  gap: 8px;
  padding-block: 8px;
  align-items: center;
}

/* Container query: 2 columns when card is wide enough */
@container (min-width: 260px) {
  #homeSection :is(.actions, .card-actions) { 
    grid-template-columns: repeat(2, 1fr); 
  }
}

#homeSection :is(.actions, .card-actions) :is(button, [role="button"], a.button) {
  width: 100%;
  min-height: 36px;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  justify-content: center;
}

/* Container query fallback for older browsers */
@supports not (container-type: inline-size) {
  #homeSection :is(.actions, .card-actions) { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 8px; 
  }
  
  #homeSection :is(.actions, .card-actions) > * { 
    flex: 1 1 150px; 
    min-height: 36px; 
  }
}

/* === COMMUNITY GRID NORMALIZATION === */
/* Community = 2 columns (Player | Games container) with verified layout */

/* 1. COMMUNITY GRID - Override main.css conflicting rules */
#group-2-community .community-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-auto-rows: 1fr;        /* ensures balanced columns */
  align-items: start;
  height: auto;
  min-height: 0;
  overflow: visible;
  gap: 24px;
  width: 100%;
}

/* 2. COMMUNITY LEFT (player) */
#group-2-community .community-left {
  position: sticky;
  top: 0;
  align-self: start;
  height: auto;
  min-height: 0;
}

/* 3. COMMUNITY RIGHT (games container) - Override main.css conflicting rules */
#group-2-community .community-right {
  display: block;
  height: auto;
  min-height: 0;
  align-items: start;
  flex: none;
  max-width: none;
  min-width: 0;
  width: 100%;
  overflow: visible;
  align-self: stretch;
}

/* 4. HOME GAMES CARDS */
#group-2-community #home-games {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: none;
  align-items: start;
  gap: 12px;
}

#group-2-community #home-games .card--game {
  max-height: 220px;
}

/* 5. OVERRIDE CONFLICTING RULES FROM MAIN.CSS */
/* Fix cards being cut off by removing min-height constraints */
#group-2-community .community-section {
  min-height: 0 !important;
  height: auto !important;
  overflow: visible !important;
}

#group-2-community .community-right .community-section {
  min-height: 0 !important;
  height: auto !important;
  overflow: visible !important;
  padding: 16px !important;
  display: flex !important;
  flex-direction: column !important;
}

/* === SAFETY & RTL SUPPORT === */
/* Safety: prevent content from forcing tracks wider than panels */
#homeSection .preview-row-scroll * { 
  min-width: 0; 
}

/* RTL scroll behavior */
#homeSection .preview-row-scroll {
  scroll-behavior: smooth;
}

/* RTL-aware scroll indicators (if you have them) */
#homeSection .preview-row-scroll::before,
#homeSection .preview-row-scroll::after {
  content: '';
  position: absolute;
  top: 0;
  bottom: 0;
  width: 20px;
  pointer-events: none;
  z-index: 1;
}

#homeSection .preview-row-scroll::before {
  left: 0;
  background: linear-gradient(to right, var(--bg, #fff), transparent);
}

#homeSection .preview-row-scroll::after {
  right: 0;
  background: linear-gradient(to left, var(--bg, #fff), transparent);
}

/* RTL flip scroll indicators */
[dir="rtl"] #homeSection .preview-row-scroll::before {
  left: auto;
  right: 0;
  background: linear-gradient(to left, var(--bg, #fff), transparent);
}

[dir="rtl"] #homeSection .preview-row-scroll::after {
  right: auto;
  left: 0;
  background: linear-gradient(to right, var(--bg, #fff), transparent);
}

/* === DARK MODE ADJUSTMENTS === */
/* Dark mode adjustments for preview row */
#group-1-your-shows .dark-mode .home-preview-row {
  background: none;
  border: none;
  border-radius: 0;
  padding: 0;
  box-shadow: none;
}

/* === COLLAPSED SECTIONS === */
/* Collapsed section styling for empty "Next Up" */
.home-preview-row.collapsed {
  padding: 8px 16px;
  min-height: auto;
}

.home-preview-row.collapsed .preview-row-container {
  display: none;
}

.home-preview-row.collapsed .preview-row-header {
  margin-bottom: 0;
}

.home-preview-row.collapsed .preview-row-title {
  font-size: 1rem;
  font-weight: 500;
  opacity: 0.7;
}

/* === HOME WRAPPER CONTRACT === */
/* Enforce 32px gutters on all home panels - highest specificity */
#homeSection .home-preview-row,
#homeSection .section-content,
#homeSection .panel,
#homeSection .home-group section,
#homeSection #up-next-row {
  padding-left: 32px;
  padding-right: 32px;
  display: block;
}

/* #home-games is a grid container, not a panel - don't force block display */
#homeSection #home-games {
  padding-left: 32px;
  padding-right: 32px;
  /* Keep display: grid for games layout */
}

/* === HOME ACTIONS: CANONICAL 2x2 GRID === */
/* Force all actions within home to use grid layout */
#homeSection .actions,
#homeSection .card-actions,
#homeSection .preview-card .actions,
#homeSection .unified-card .actions,
#homeSection .curated-card .actions {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

/* === YOUR SHOWS WRAPPER & RAIL CONTRACT === */
/* 1) Your Shows wrapper must be neutral */
#group-1-your-shows.home-group {
  display: block;          /* not flex */
  padding-left: var(--home-gutter, 32px);
  padding-right: var(--home-gutter, 32px);
  box-sizing: border-box;
}

/* 2) Rail contract: horizontal grid that grows to content */
#homeSection .home-preview-row .preview-row-container {
  /* host that owns scrolling; keep your overflow-x: auto elsewhere if set */
  overflow-x: auto;
  overflow-y: hidden;
}

#homeSection .home-preview-row .preview-row-scroll.row-inner,
#homeSection .home-preview-row .cw-row #currentlyWatchingScroll,
#homeSection .home-preview-row .up-next-scroll {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--rail-col-w, 224px);
  gap: var(--rail-gap, 12px);

  /* the key: allow rail to expand beyond one column */
  width: max-content;         /* expands to sum of columns */
  min-width: 100%;            /* never smaller than viewport */
}

/* ===== Home Frame Contract (Groups 1,3,4,5) ===== */
:root { --home-gutter: 32px; }

/* 1) Group wrappers must be neutral blocks with standard gutters */
#group-1-your-shows.home-group,
#group-3-for-you.home-group,
#group-4-theaters.home-group,
#group-5-feedback.home-group {
  display: block;
  padding-left: var(--home-gutter);
  padding-right: var(--home-gutter);
  box-sizing: border-box;
}

/* 2) Rails: grid that grows to content; scrolled by the outer container */
#group-1-your-shows .home-preview-row .preview-row-container,
#group-3-for-you .home-preview-row .preview-row-container,
#group-4-theaters .home-preview-row .preview-row-container,
#group-5-feedback .home-preview-row .preview-row-container {
  overflow-x: auto;
  overflow-y: hidden;
}

#group-1-your-shows .home-preview-row .preview-row-scroll.row-inner,
#group-1-your-shows .home-preview-row .cw-row #currentlyWatchingScroll,
#group-1-your-shows .home-preview-row .up-next-scroll,
#group-3-for-you  .home-preview-row .preview-row-scroll.row-inner,
#group-4-theaters .home-preview-row .preview-row-scroll.row-inner,
#group-5-feedback .home-preview-row .preview-row-scroll.row-inner {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--rail-col-w, 224px);
  gap: var(--rail-gap, 12px);
  width: max-content;   /* expand to sum of columns */
  min-width: 100%;      /* never smaller than viewport */
}

/* 3) Actions: canonical 2x2 grid in home */
#group-1-your-shows .actions,
#group-1-your-shows .card-actions,
#group-3-for-you  .actions,
#group-3-for-you  .card-actions,
#group-4-theaters .actions,
#group-4-theaters .card-actions,
#group-5-feedback .actions,
#group-5-feedback .card-actions {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 8px;
  grid-auto-rows: minmax(36px, auto);
}

/* 4) Flatten the inner wrapper so buttons become grid items */
#group-1-your-shows .actions > .action-grid-2x2,
#group-1-your-shows .card-actions > .action-grid-2x2,
#group-3-for-you  .actions > .action-grid-2x2,
#group-3-for-you  .card-actions > .action-grid-2x2,
#group-4-theaters .actions > .action-grid-2x2,
#group-4-theaters .card-actions > .action-grid-2x2,
#group-5-feedback .actions > .action-grid-2x2,
#group-5-feedback .card-actions > .action-grid-2x2 {
  display: contents;
}

/* 5) Don't let children force full-width or span both columns by default */
#group-1-your-shows .actions > *,
#group-1-your-shows .card-actions > *,
#group-3-for-you  .actions > *,
#group-3-for-you  .card-actions > *,
#group-4-theaters .actions > *,
#group-4-theaters .card-actions > *,
#group-5-feedback .actions > *,
#group-5-feedback .card-actions > * {
  grid-column: auto !important;
  min-width: 0;
  max-width: none;
  justify-self: stretch;
  align-self: stretch;
}

/* 6) Allow explicit wide actions when intended */
#group-1-your-shows .actions > .span-2,
#group-1-your-shows .card-actions > .span-2,
#group-3-for-you  .actions > .span-2,
#group-3-for-you  .card-actions > .span-2,
#group-4-theaters .actions > .span-2,
#group-4-theaters .card-actions > .span-2,
#group-5-feedback .actions > .span-2,
#group-5-feedback .card-actions > .span-2 {
  grid-column: 1 / -1 !important;
}

/* 7) Optional: keep gutters consistent on mobile (don't shrink unless product demands it) */
@media (max-width: 768px) {
  :root { --home-gutter: 32px; }
}

/* ===== COMMUNITY GROUP PROTECTION ===== */
/* Ensure community group maintains its existing layout while other groups use new contract */
/* Use higher specificity to override conflicting rules without !important */
#homeSection #group-2-community.home-group {
  display: block;
  padding-left: var(--home-gutter, 32px);
  padding-right: var(--home-gutter, 32px);
  box-sizing: border-box;
}

/* Override any conflicting padding rules on community content with higher specificity */
#homeSection #group-2-community.community-v2.home-group .community-content {
  padding-left: 0;
  padding-right: 0;
  /* Keep other properties from community-layout.v2.css */
}

/* Community rails should maintain their existing behavior */
#group-2-community .home-preview-row .preview-row-container {
  overflow-x: auto;
  overflow-y: hidden;
}

#group-2-community .home-preview-row .preview-row-scroll.row-inner,
#group-2-community .home-preview-row .cw-row #currentlyWatchingScroll,
#group-2-community .home-preview-row .up-next-scroll {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--rail-col-w, 224px);
  gap: var(--rail-gap, 12px);
  width: max-content;
  min-width: 100%;
}

/* Community actions should maintain existing layout (not forced to 2x2 grid) */
#group-2-community .actions,
#group-2-community .card-actions {
  /* Let existing rules handle community actions - don't force grid */
}