<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Anti-Jump Fix</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .result { margin: 10px 0; padding: 8px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .test-links { margin: 10px 0; }
        .test-links a { display: inline-block; margin: 5px 10px 5px 0; padding: 8px 12px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; }
        .test-links a:hover { background: #0056b3; }
        .scroll-test { height: 2000px; background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); padding: 20px; margin: 20px 0; }
        .scroll-test h3 { margin-top: 500px; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Anti-Jump Fix Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Feature Flag Status</h3>
        <div id="test1-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Initial Scroll Position</h3>
        <div id="test2-result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Hash Navigation Tests</h3>
        <div id="test3-result"></div>
        <div class="test-links">
            <a href="#section1">Test #section1</a>
            <a href="#section2">Test #section2</a>
            <a href="/">Go to Home (no hash)</a>
            <a href="/#section1">Go to Home with hash</a>
        </div>
    </div>
    
    <div class="test-section">
        <h3>Test 4: Programmatic Scroll Tests</h3>
        <div id="test4-result"></div>
        <button onclick="testScrollTo()">Test window.scrollTo()</button>
        <button onclick="testScrollIntoView()">Test scrollIntoView()</button>
        <button onclick="testFocus()">Test focus()</button>
    </div>
    
    <div class="test-section">
        <h3>Test 5: Scroll Position Monitoring</h3>
        <div id="test5-result"></div>
    </div>

    <!-- Scroll test content -->
    <div class="scroll-test">
        <h3 id="section1">Section 1 - Should not auto-scroll here</h3>
        <p>This is a test section to verify that the app doesn't auto-scroll to anchors on load.</p>
    </div>
    
    <div class="scroll-test">
        <h3 id="section2">Section 2 - Another test section</h3>
        <p>Another test section to verify scroll behavior.</p>
    </div>

    <!-- Load required scripts -->
    <script src="js/flags.js"></script>
    <script src="scripts/flags-init.js"></script>
    <script src="scripts/anti-jump.js"></script>

    <script>
        function addResult(testId, message, type = 'info') {
            const resultDiv = document.getElementById(testId);
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            resultDiv.appendChild(div);
        }

        function testScrollTo() {
            addResult('test4-result', 'Testing window.scrollTo(0, 500)...', 'info');
            try {
                window.scrollTo(0, 500);
                addResult('test4-result', '‚úÖ window.scrollTo() executed', 'success');
            } catch (error) {
                addResult('test4-result', `‚ùå window.scrollTo() error: ${error.message}`, 'error');
            }
        }

        function testScrollIntoView() {
            addResult('test4-result', 'Testing scrollIntoView()...', 'info');
            try {
                const element = document.getElementById('section1');
                if (element) {
                    element.scrollIntoView();
                    addResult('test4-result', '‚úÖ scrollIntoView() executed', 'success');
                } else {
                    addResult('test4-result', '‚ùå No element found for scrollIntoView()', 'error');
                }
            } catch (error) {
                addResult('test4-result', `‚ùå scrollIntoView() error: ${error.message}`, 'error');
            }
        }

        function testFocus() {
            addResult('test4-result', 'Testing focus()...', 'info');
            try {
                const input = document.createElement('input');
                input.style.position = 'absolute';
                input.style.top = '1000px';
                document.body.appendChild(input);
                input.focus();
                document.body.removeChild(input);
                addResult('test4-result', '‚úÖ focus() executed', 'success');
            } catch (error) {
                addResult('test4-result', `‚ùå focus() error: ${error.message}`, 'error');
            }
        }

        function updateScrollPosition() {
            const scrollY = window.scrollY;
            const scrollX = window.scrollX;
            
            if (scrollY === 0 && scrollX === 0) {
                addResult('test5-result', `‚úÖ Perfect! Scroll position: (${scrollX}, ${scrollY})`, 'success');
            } else {
                addResult('test5-result', `‚ö†Ô∏è Not at top! Scroll position: (${scrollX}, ${scrollY})`, 'warning');
            }
        }

        // Wait for scripts to load
        document.addEventListener('DOMContentLoaded', function() {
            // Test 1: Feature Flag Status
            addResult('test1-result', 'üîç Checking route_fix_home_default flag...', 'info');
            
            if (window.FLAGS?.route_fix_home_default) {
                addResult('test1-result', '‚úÖ route_fix_home_default flag is ENABLED', 'success');
            } else {
                addResult('test1-result', '‚ùå route_fix_home_default flag is DISABLED', 'error');
            }
            
            // Test 2: Initial Scroll Position
            addResult('test2-result', 'üîç Checking initial scroll position...', 'info');
            updateScrollPosition();
            
            // Test 3: Hash Navigation Tests
            addResult('test3-result', 'üîç Testing hash navigation...', 'info');
            addResult('test3-result', `Current URL: ${location.href}`, 'info');
            addResult('test3-result', `Current hash: ${location.hash || '(none)'}`, 'info');
            addResult('test3-result', 'Click the test links above to see if they cause unwanted scrolling', 'info');
            
            // Test 4: Programmatic Scroll Tests
            addResult('test4-result', 'üîç Testing programmatic scroll methods...', 'info');
            addResult('test4-result', 'Click the buttons above to test scroll methods', 'info');
            
            // Test 5: Scroll Position Monitoring
            addResult('test5-result', 'üîç Monitoring scroll position...', 'info');
            updateScrollPosition();
            
            // Monitor scroll changes
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    updateScrollPosition();
                }, 100);
            });
            
            // Monitor hash changes
            window.addEventListener('hashchange', function() {
                addResult('test3-result', `Hash changed to: ${location.hash || '(none)'}`, 'info');
                updateScrollPosition();
            });
            
            // Monitor URL changes
            window.addEventListener('popstate', function() {
                addResult('test3-result', `URL changed to: ${location.href}`, 'info');
                updateScrollPosition();
            });
        });
    </script>
</body>
</html>

